<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Resharper on csMACnz&#39;s Blog</title>
    <link>https://blog.csmac.nz/tags/resharper/</link>
    <description>Recent content in Resharper on csMACnz&#39;s Blog</description>
    <image>
      <url>https://blog.csmac.nz/favicon.png</url>
      <title>csMACnz&#39;s Blog</title>
      <link>https://blog.csmac.nz</link>
    </image>
    <ttl>1440</ttl>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-nz</language>
    <lastBuildDate>Sun, 02 Aug 2015 08:37:47 +0000</lastBuildDate><atom:link href="https://blog.csmac.nz/tags/resharper/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>ExternalAnnotations, or how to not depend on jetbrains.annotations.dll</title>
      <link>https://blog.csmac.nz/post/externalannotations-or-how-to-not-depend-on-jetbrains-annotations-dll/</link>
      <pubDate>Sun, 02 Aug 2015 08:37:47 +0000</pubDate>
      
      <guid>https://blog.csmac.nz/post/externalannotations-or-how-to-not-depend-on-jetbrains-annotations-dll/</guid>
      <description>&lt;p&gt;There is some great static analysis stuff that ReSharper does for you.  Specifically around nullability, purity and usage of your code.
From their &lt;em&gt;Code Annotations&lt;/em&gt; page in Visual Studio:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ReSharper Annotations help reduce false positive warnings, explicitly declare purity and nullability in your code, deal with implicit usages of member, support special semantics of APIs in ASP.NET and XAML frameworks and otherwise increase accuracy of ReSharper code inspections.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Right, what I said. This can be seen whenever you get shown a squiggle under a variable or statement telling you that an expression is always true, or when the signature IntelliSense shows you a &lt;code&gt;[NotNull]&lt;/code&gt; annotation beside a parameter or return value.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://res.cloudinary.com/csmacnz/image/upload/v1437808035/NotNullAnnotation_p97mr2.png&#34; alt=&#34;NotNull Annotation Shown by Visual Studio help.&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://res.cloudinary.com/csmacnz/image/upload/v1437807947/NotNullAlwaysTrue_mektau.png&#34; alt=&#34;NotNull allows ReSharper to determine a condition is never false.&#34;&gt;&lt;/p&gt;
&lt;p&gt;The obvious (and recommended)  way is to take a dependency on jetbrains.annotations.dll. They have made this simple by making it &lt;a href=&#34;https://www.nuget.org/packages/JetBrains.Annotations/&#34;&gt;a NuGet package&lt;/a&gt;. If you are adding annotations to your own applications, this is really easy. The problem if you are writing a library for public consumption you don&amp;rsquo;t want to be providing extra dependencies that the end user might not actually want or need. Also, if you don&amp;rsquo;t own the code, then you can&amp;rsquo;t change the source in the first place.&lt;/p&gt;
&lt;p&gt;Luckily there is another way: *&lt;strong&gt;.ExternalAnnotations.xml&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;Say you have a library that you distribute on NuGet. Your package can include a file beside your DLL that contains all the annotations that you would usually apply using attributes. When Visual Studio loads your DLL, ReSharper is able to recognise the XML file beside it, and load that into the system with all your custom annotation there to give a better experience.&lt;/p&gt;
&lt;p&gt;Say you have a library DLL called &lt;code&gt;Beefeater.dll&lt;/code&gt;. You would simply create &lt;a href=&#34;https://github.com/csMACnz/Beefeater/blob/master/src/Beefeater/Beefeater.ExternalAnnotations.xml&#34;&gt;a file&lt;/a&gt; called &lt;code&gt;Beefeater.ExternalAnnotations.xml&lt;/code&gt; that gets packaged into your NuGet file, in the same folder as the DLL. The naming convention is simply &lt;code&gt;*.ExternalAnnotations.xml&lt;/code&gt; where &lt;code&gt;*&lt;/code&gt; matches the name of your library without the &lt;code&gt;.dll&lt;/code&gt; extension. (Notice the not so subtle plug for my library &lt;a href=&#34;https://www.nuget.org/packages/Beefeater&#34;&gt;Beefeater&lt;/a&gt;. More on that in another post.)&lt;/p&gt;
&lt;p&gt;So what do we put in this file?  Well it&amp;rsquo;s based on the &lt;a href=&#34;https://msdn.microsoft.com/en-us/library/b2s063f7.aspx&#34;&gt;XML Documentation&lt;/a&gt; format. You know, the one you use in your comments, that can be exported to produce documentation? If you didn&amp;rsquo;t know, watch out for more on that in a later post as well.  All you really need to know is that it describes the signature of a method and allows you do define attributes against the method, or it&amp;rsquo;s parameters. Wherever you would put the attribute in code, you put it in that place in the file.&lt;/p&gt;
&lt;p&gt;Let&amp;rsquo;s look at a specific example:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cs&#34; data-lang=&#34;cs&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;NotNull&lt;/span&gt;&amp;lt;T&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; NotNull(T &lt;span style=&#34;color:#66d9ef&#34;&gt;value&lt;/span&gt;) : &lt;span style=&#34;color:#66d9ef&#34;&gt;this&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;OptionExtensions&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; Match&amp;lt;TValue&amp;gt;(
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;this&lt;/span&gt; Option&amp;lt;TValue&amp;gt; option, 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      Action&amp;lt;TValue&amp;gt; some, 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      Action none)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-xml&#34; data-lang=&#34;xml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;assembly&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;name=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Beefeater&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;member&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;name=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;M:Beefeater.NotNull`1.#ctor(`0)&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;parameter&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;name=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;value&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;attribute&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ctor=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;M:JetBrains.Annotations.NotNullAttribute.#ctor&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;/&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;/parameter&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;/member&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;member&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;name=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;M:Beefeater.OptionExtensions.Match``1(Beefeater.Option{``0},System.Action{``0},System.Action)&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;parameter&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;name=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;some&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;attribute&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ctor=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;M:JetBrains.Annotations.NotNullAttribute.#ctor&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;/&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;/parameter&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;parameter&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;name=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;none&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;attribute&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ctor=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;M:JetBrains.Annotations.NotNullAttribute.#ctor&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;/&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;/parameter&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;/member&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;member&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;name=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;P:Beefeater.Result`2.Error&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;attribute&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ctor=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;M:JetBrains.Annotations.NotNullAttribute.#ctor&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;/&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;/member&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;/assembly&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We have good examples of a few different features so I will step through them with a bit of an explanation for each.  We start with the assembly, giving its name. Then we list many members inside this tag, one for each method we want to annotate.&lt;/p&gt;
&lt;p&gt;To annotate a constructor, We use the &lt;code&gt;M:&lt;/code&gt; prefix, to define that this is for a method. We add the full namespace to the type, in this case, our class is &lt;code&gt;Beefeater.NotNull&amp;lt;T&amp;gt;&lt;/code&gt;.  Our type is generic, so we use the &lt;code&gt; `1&lt;/code&gt; syntax to declare that the type has a single generic type parameter. If we had 2 parameters we would have used &lt;code&gt; `2&lt;/code&gt;. Because it is a constructor, we use the #ctor to represent its name.  Our constructor takes one parameter, and it is of type &lt;code&gt;T&lt;/code&gt; from the generic, so we use &lt;code&gt; `0&lt;/code&gt; to declare the first (zero-based indexing, of course) of the generic types.&lt;/p&gt;
&lt;p&gt;Next we have a nested parameter tag. This one declares the name of the parameter and contains any attributes applied to that parameter. The attribute has a &lt;code&gt;ctor&lt;/code&gt; attribute where we put the fully qualified name of the constructor we use on that attribute. This is a repeat of the above syntax described for the member name.&lt;/p&gt;
&lt;p&gt;Our second method has a few extra bits of information to know.  Firstly, we are using the name .&lt;code&gt;Match``1&lt;/code&gt; which is the actually method name since it isn&amp;rsquo;t a constructor, and is generic since the method is generic, like the class was last time. Secondly, with parameters that are known types, we use their fully qualified name. We see the last parameter is a &lt;code&gt;System.Action&lt;/code&gt;. The other two are generic types. This took me a while to figure out, but if your method is generic, your parameters are generic, and you need to match these together, you use the &lt;code&gt;{``0}&lt;/code&gt; syntax, to say it has a generic argument, of type &lt;code&gt;`0&lt;/code&gt;, where &lt;code&gt;`0&lt;/code&gt; matches the first argument of the generics from the method (or class).&lt;/p&gt;
&lt;p&gt;The last method shows an attribute on the member. This uses the same attribute tag and works the same way as the other attribute tags previous. We just nest it directly under the member, instead of inside a parameter tag.&lt;/p&gt;
&lt;p&gt;It was helpful to refer to &lt;a href=&#34;https://msdn.microsoft.com/en-us/library/fsbx0t7x%28v=vs.140%29.aspx?f=255&amp;amp;MSPPError=-2147217396&#34;&gt;Processing the XML File&lt;/a&gt; on MSDN to get a feel for what the type and method signatures look like.&lt;/p&gt;
&lt;p&gt;For a list of all the attributes you can use, check out the &lt;a href=&#34;https://www.jetbrains.com/resharper/help/Reference__Code_Annotation_Attributes.html&#34;&gt;ReSharper Reference on Code Annotation Attributes&lt;/a&gt; for a full detailed reference, or the &lt;a href=&#34;https://www.jetbrains.com/resharper/features/code_analysis.html#Annotated_Framework&#34;&gt;ReSharper features&lt;/a&gt; page for a more marketing driven overview description and list of the most significant of the attributes available.&lt;/p&gt;
&lt;p&gt;A more detailed article (without the generic help though) can be found on &lt;a href=&#34;https://www.jetbrains.com/resharper/help/Code_Analysis__External_Annotations.html&#34;&gt;JetBrains help&lt;/a&gt;, which is what got me off the ground with most of what I needed to do.&lt;/p&gt;
&lt;p&gt;I mentioned there are three ways to use ReSharper static analysis. So what it the third? Well, You can write your own attribute classes, and tell ReSharper about them. You need access to the source code to use this approach as well, but it does remove a dependency on ReSharper specifically. I&amp;rsquo;ll leave it to you to decide if this makes sense over the preferred approach of using the DLL provided.&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>