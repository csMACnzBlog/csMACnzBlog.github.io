<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Method calls. Less chaining, more Functional. - csMacnz&#39;s Blog</title><link rel="apple-touch-icon" href="https://csmacnzblog.github.io/images/favicons/apple-touch-icon.png" sizes="180x180">
<link rel="icon" href="https://csmacnzblog.github.io/images/favicons/favicon-32x32.png" sizes="32x32" type="image/png">
<link rel="icon" href="https://csmacnzblog.github.io/images/favicons/favicon-16x16.png" sizes="16x16" type="image/png">
<link rel="manifest" href="https://csmacnzblog.github.io/images/favicons/manifest.json">
<link rel="icon" href="https://csmacnzblog.github.io/images/favicons/favicon.ico">
<meta name="keywords" content="" />
<meta name="description" content="" /><meta itemprop="name" content="Method calls. Less chaining, more Functional.">
<meta itemprop="description" content="It came up in a recent code review that we had a method that did stuff, then called a method that did stuff, that then called a method. Eventually, the last method in the chain bubbled back up and out.
This is a bit of an anti-pattern in my eyes. Essentially you are coupling these methods (functions) together.
As a quick diversion, let&rsquo;s look at the idea of layered architecture."><meta itemprop="datePublished" content="2018-08-20T06:00:00+00:00" />
<meta itemprop="dateModified" content="2018-08-20T06:00:00+00:00" />
<meta itemprop="wordCount" content="849">
<meta itemprop="keywords" content="" /><meta property="og:title" content="Method calls. Less chaining, more Functional." />
<meta property="og:description" content="It came up in a recent code review that we had a method that did stuff, then called a method that did stuff, that then called a method. Eventually, the last method in the chain bubbled back up and out.
This is a bit of an anti-pattern in my eyes. Essentially you are coupling these methods (functions) together.
As a quick diversion, let&rsquo;s look at the idea of layered architecture." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://csmacnzblog.github.io/post/method-calls-less-chaining-more-functional/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2018-08-20T06:00:00+00:00" />
<meta property="article:modified_time" content="2018-08-20T06:00:00+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Method calls. Less chaining, more Functional."/>
<meta name="twitter:description" content="It came up in a recent code review that we had a method that did stuff, then called a method that did stuff, that then called a method. Eventually, the last method in the chain bubbled back up and out.
This is a bit of an anti-pattern in my eyes. Essentially you are coupling these methods (functions) together.
As a quick diversion, let&rsquo;s look at the idea of layered architecture."/>
<link rel=stylesheet href="https://csmacnzblog.github.io/css/bundle.min.ce383e7297312216c2d2ced30574d5a9ae83c451db9f064a454509955ae2462d.css" integrity="sha256-zjg&#43;cpcxIhbC0s7TBXTVqa6DxFHbnwZKRUUJlVriRi0=" crossorigin="anonymous"><script src="https://csmacnzblog.github.io/js/bundle.min.ad6d83537f5b4374c837a12a76422496582e04d1dde91bbb443641ec12c506c6.js" integrity="sha256-rW2DU39bQ3TIN6EqdkIkllguBNHd6Ru7RDZB7BLFBsY=" crossorigin="anonymous"></script>
</head><body><header><nav class="navbar navbar-expand-xl fixed-top">
  <div class="container">
    <a class="navbar-brand" href="https://csmacnzblog.github.io">
      <img class="logo" alt="Logo" src="https://csmacnzblog.github.io/images/logo.webp" loading="lazy"></a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav me-1 mb-2 mb-lg-0"><form class="search-bar d-flex ms-1" action="https://csmacnzblog.github.io/search">
  <div class="input-group input-group-sm">
    <button class="btn btn-search disabled position-absolute left-0" type="submit"><i class="fas fa-fw fa-search"></i></button>
    <input class="form-control rounded-pill" id="searchQuery" name="q" type="search" aria-label="Search">
  </div>
</form></ul><ul class="navbar-nav me-1 mb-2 mb-lg-0 me-1 ms-auto"><li class="nav-item">
  <a class="nav-link" data-bs-toggle="offcanvas" href="#offcanvasSettings" role="button"
    aria-controls="offcanvasSettings">
    <i class="fas fa-fw fa-sliders-h"></i> Settings
  </a>
</li>

<div class="offcanvas offcanvas-end surface h-100" tabindex="-1" id="offcanvasSettings"
  aria-labelledby="offcanvasSettingsLabel">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title" w id="offcanvasSettingsLabel"><i class="fas fa-fw fa-sliders-h"></i> Settings</h5>
    <a role="button" data-bs-dismiss="offcanvas" aria-label="Close">
      <span class="fas fa-2x fa-fw fa-times"></span>
    </a>
  </div>
  <div class="offcanvas-body"><section class="setting">
  <form class="row">
    <div class="col-auto">
      <label><i class="fas fa-fw fa-adjust"></i> Mode</label>
    </div>
    <div class="col-auto ms-auto">
      <div class="form-check form-switch">
        <input class="form-check-input" type="checkbox" id="modeSwitcher">
      </div>
    </div>
  </form>
</section>
<section class="setting palettes">
  <form class="row">
    <div class="col-auto">
      <label><i class="fas fa-fw fa-palette"></i> Palette</label>
    </div>
    <div class="col-auto ms-auto">
      <span id="btnPalette" class="btn btn-sm"><i class="fas fa-eye-dropper"></i></span>
    </div>
  </form>
  <div class="container mt-2 visually-hidden" id="palettePicker">
    <div class="btn-group"><button type="button" id="palette-blue" title="Blue" 
          class="btn btn-sm palette bg-blue d-flex align-items-center justify-content-center">
        </button><button type="button" id="palette-blue-gray" title="Blue Gray" 
          class="btn btn-sm palette bg-blue-gray d-flex align-items-center justify-content-center">
        </button><button type="button" id="palette-brown" title="Brown" 
          class="btn btn-sm palette bg-brown d-flex align-items-center justify-content-center">
        </button><button type="button" id="palette-cyan" title="Cyan" 
          class="btn btn-sm palette bg-cyan d-flex align-items-center justify-content-center">
        </button><button type="button" id="palette-green" title="Green" 
          class="btn btn-sm palette bg-green d-flex align-items-center justify-content-center">
        </button><button type="button" id="palette-indigo" title="Indigo" 
          class="btn btn-sm palette bg-indigo d-flex align-items-center justify-content-center">
        </button><button type="button" id="palette-orange" title="Orange" 
          class="btn btn-sm palette bg-orange d-flex align-items-center justify-content-center">
        </button><button type="button" id="palette-pink" title="Pink" 
          class="btn btn-sm palette bg-pink d-flex align-items-center justify-content-center">
        </button><button type="button" id="palette-purple" title="Purple" 
          class="btn btn-sm palette bg-purple d-flex align-items-center justify-content-center">
        </button><button type="button" id="palette-red" title="Red" 
          class="btn btn-sm palette bg-red d-flex align-items-center justify-content-center">
        </button><button type="button" id="palette-teal" title="Teal" 
          class="btn btn-sm palette bg-teal d-flex align-items-center justify-content-center">
        </button><button type="button" id="palette-yellow" title="Yellow" 
          class="btn btn-sm palette bg-yellow d-flex align-items-center justify-content-center">
        </button></button>
    </div>
  </div>
</section></div>
</div></ul>
    </div>
  </div>
</nav>
</header>
<main role="main" class="container">
      <div class="row content">
<div class="col-lg-8">
  <div class="container"><nav class="row" aria-label="breadcrumb">
  <ol class="breadcrumb surface"><li class="breadcrumb-item"><a href="https://csmacnzblog.github.io/">Home</a></li><li class="breadcrumb-item"><a href="https://csmacnzblog.github.io/post/">Posts</a></li><li class="breadcrumb-item active">Method calls. Less chaining, more Functional.</li></ol>
</nav><article class="post row surface"><div class="post-toolbox">
  <div class="col-12 d-none d-lg-block">
    <a id="sidebarToggler" class="fas fa-fw fa-2x fa-expand-alt" role="button"></a>
  </div>
</div>
<h1 class="post-title my-3">Method calls. Less chaining, more Functional.</h1><div class="post-meta mb-3">
  <span class="post-date me-2">
    <i class="fas fa-fw fa-calendar-alt"></i>Aug 20, 2018
  </span>
  <span class="post-reading-time me-2">
    <i class="fas fa-fw fa-coffee"></i>4 min read
  </span>
</div>
<a id="btnTOC" class="fas fa-fw fa-2x fa-list-alt position-fixed" data-bs-toggle="offcanvas" href="#offcanvasTOC" aria-controls="offcanvasTOC" role="button">
</a>

<div class="offcanvas offcanvas-end surface" tabindex="-1" id="offcanvasTOC" aria-labelledby="offcanvasTOCLabel">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title" id="offcanvasTOCLabel">Table Of Contents</h5>
    <a role="button" data-bs-dismiss="offcanvas" aria-label="Close">
      <span class="fas fa-2x fa-fw fa-times"></span>
    </a>
  </div>
  <div class="offcanvas-body">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#dont-mix-level-of-abstraction">Don&rsquo;t mix level of abstraction</a></li>
        <li><a href="#pure-functions">Pure Functions</a></li>
        <li><a href="#conclusion">Conclusion</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div><div class="post-content mb-3"><p>It came up in a recent code review that we had a method that did stuff, then called a method that did stuff, that then called a method. Eventually, the last method in the chain bubbled back up and out.</p>
<p>This is a bit of an anti-pattern in my eyes. Essentially you are coupling these methods (functions) together.</p>
<p>As a quick diversion, let&rsquo;s look at the idea of layered architecture.</p>
<pre><code>   UI
   |
   v
 Domain
   |
   v
DataAccess
   |
   v
SqlServer
</code></pre><p>As we know, in this architecture we have coupled out UI indirectly to our database.  We know this is a bad design, and we use Dependency Inversion to solve it.</p>
<p>Now we look at a code example as described above:
(don&rsquo;t trust this code as correct, I wrote it without a compiler and made up a bunch of method names)</p>
<pre><code>public List&lt;string&gt; GetList(string filter, OrderBy ordering)
{
    return BuildRequest(filter, ordering);
}

private List&lt;string&gt; BuildRequest(string filter, OrderBy ordering)
{
    var request = new HttpRequest();
    request.Url = $&quot;/list?filter={Escape(filter)}&amp;order=Map(ordering)&quot;;
    request.Method = &quot;GET&quot;;
    request.Auth = LoadAuth(User.Guest);
    
    return GetResults(request);
}

private List&lt;string&gt; GetResults(HttpRequest request)
{
    var client = new HttpClient();
    var response = client.MakeRequest(request);
    
    return ParseResponse(response);
}

private List&lt;string&gt; ParseResponse(HttpResponse response)
{
    var rawContent = response.ReadContent();
    var resultList = JsonParse&lt;List&lt;string&gt;&gt;(rawContent);
    
    return resultList;
}
</code></pre><p>So what&rsquo;s the problem? Well like above with our layer dependency, we have method dependency.</p>
<pre><code>GetList =&gt; BuildRequest =&gt; GetResults =&gt; ParseResponse
</code></pre><p>While this might seem fine to you perhaps, it means we can&rsquo;t actually test any of these methods in isolation. It may not seem like it would be that useful in this contrived example, but you can imagine cases where it might.</p>
<p>For readability, it also makes it hard to see the structure of execution, because it is hidden in the implementation details.</p>
<p>In contrast, let&rsquo;s flatten the structure and make our methods more like pure functions.</p>
<pre><code>public List&lt;string&gt; GetList(string filter, OrderBy ordering)
{
    var request = BuildRequest(filter, ordering);
    var response = GetResponse(request);
    var result = ParseResponse(response);
    
    return result;
}

private HttpRequest BuildRequest(string filter, OrderBy ordering)
{
    var request = new HttpRequest();
    request.Url = $&quot;/list?filter={Escape(filter)}&amp;order=Map(ordering)&quot;;
    request.Method = &quot;GET&quot;;
    request.Auth = LoadAuth(User.Guest);
    
    return request;
}

private HttpResponse GetResponse(HttpRequest request)
{
    var client = new HttpClient();
    var response = client.MakeRequest(request);
    
    return response;
}

private List&lt;string&gt; ParseResponse(HttpResponse response)
{
    var rawContent = response.ReadContent();
    var resultList = JsonParse&lt;List&lt;string&gt;&gt;(rawContent);
    
    return resultList;
}
</code></pre><p>The only method that didn&rsquo;t change was the last one. But doesn&rsquo;t that already help readability?  From the top method, we can clearly see the workflow of the public method, without diving into the implementation details of each method.</p>
<p>As an added benefit, some of these methods are now more generic. We could reuse the <code>GetResponse</code> method in future public methods without modification. We could also potentially reuse <code>ParseResponse</code> with Generics as a minor modification if we wanted.</p>
<p>Let&rsquo;s talk about a couple of the techniques I used above:</p>
<h3 id="dont-mix-level-of-abstraction">Don&rsquo;t mix level of abstraction</h3>
<p>When you write code, try to build it with layers of abstraction in mind.  You want to have a high-level part of your system. This could be a set of classes (say controllers, or CommandActions), or a layer of methods (perhaps the public ones) that are at a higher level of &ldquo;what&rdquo; is happening. These will call into more concretely named classes and methods that are named after the &ldquo;what&rdquo; and implement the &ldquo;how&rdquo;.</p>
<p>Some more reading on levels of abstraction with <a href="https://markhneedham.com/blog/2009/06/12/coding-single-level-of-abstraction-principle/" target="_blank">Mark Needham&rsquo;s Coding: Single Level of Abstraction Principle</a>
 article, <a href="https://medium.com/@yukas/single-level-of-abstraction-1e2bb6a645d7" target="_blank">Yuri Kasperovich&rsquo;s Single level of abstraction
</a>
 and <a href="https://hackernoon.com/object-oriented-tricks-6-slap-your-functions-a13d25a7d994" target="_blank">Arun Sasidharan&rsquo;s Object Oriented Tricks: #6 SLAP your functions</a>
.</p>
<h3 id="pure-functions">Pure Functions</h3>
<p>Functional programming has a concept of <a href="https://en.wikipedia.org/wiki/Pure_function" target="_blank">Pure Functions</a>
. Basically, you have two types of functions: pure and impure.  Pure functions are deterministic, that for any input you will always get the exact same output. Think mathematical functions for instance.  Impure functions, on the other hand, can produce a different result if called again. Usually, the impurity comes from an internal dependency that the function is calling.  The other big difference is that Pure functions are side-effect free, while impure functions can cause side-effects.</p>
<p>There is an interesting property of transitivity about these two types of functions.  Function calls an impure function, then that function is therefore impure. Impure functions can call pure functions, but pure functions cannot call pure functions, without that making them become impure. Simple. (I think?)</p>
<p>Why is this relevant?  Well in our original example of function chaining, we only had one pure function: <code>ParseResponse</code>. This was the only deterministic function in our class. In our second example, the only <em>impure</em> function was <code>GetResponse</code>, which by transitivity means that <code>GetList</code> is also impure, but the rest are pure functions.</p>
<p>I don&rsquo;t know about you, but I find it much easier to unit test deterministic code rather than a non-deterministic code.</p>
<p>There are techniques such as dependency inversion that allows you to turn impure functions into pure functions, but I don&rsquo;t know enough to go into detail. (something, something, <a href="https://en.wikipedia.org/wiki/Monad_%28functional_programming%29#The_I.2FO_monad" target="_blank">I/O Monad</a>
)</p>
<h3 id="conclusion">Conclusion</h3>
<p>A small refactoring technique, but helpful to make your code more readable, deterministically testable and pure (not to mention easier to name).</p>
</div><hr /><div class="post-navs d-flex mb-3 justify-content-between">
  <div class="post-nav w-50"><div class="prev-post btn btn-sm">
      <a href="https://csmacnzblog.github.io/post/untitled/">A fake FileSystem abstraction you can trust.</a>
    </div></div>
  <div class="post-nav flex-row-reverse"><div class="next-post btn btn-sm">
      <a href="https://csmacnzblog.github.io/post/time-tracking-analysis/">Time-tracking Analysis - Parsing and Presenting a Heatmap of your working week from Toggl Data</a>
    </div></div>
</div></article><div class="post-comments surface row"></div></div>
</div><aside class="col-lg-4 sidebar d-flex">
  <div class="container"><section class="recent-posts row surface">
  <h4>Recent Posts</h4>
  <ul><li><a href="https://csmacnzblog.github.io/post/terraform-newrelic-provider-facepalm/">Failed to query available provider packages - Terraform NewRelic Provider :facepalm:</a></li><li><a href="https://csmacnzblog.github.io/post/kotlin-teamcity-and-reflection/">Kotlin, TeamCity and reflection</a></li><li><a href="https://csmacnzblog.github.io/post/bluetooth-devices-keep-disconnecting/">Bluetooth Devices keep disconnecting</a></li><li><a href="https://csmacnzblog.github.io/post/nullable-and-notnull-serialisation-properties/">Nullable and notnull Serialisation Properties</a></li><li><a href="https://csmacnzblog.github.io/post/we-are-all-10x/">We are all 10x engineers, but I don&#39;t think it means what you think it means</a></li></ul>
</section><section class="taxonomy-categories row surface">
      <h4>
        <a href="https://csmacnzblog.github.io/categories">Categories</a>
      </h4>
      <div><a href="https://csmacnzblog.github.io/categories/c#/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="c#">
          c# <span class="badge rounded-pill">37</span>
        </a><a href="https://csmacnzblog.github.io/categories/dotnetcore/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="dotnetcore">
          dotnetcore <span class="badge rounded-pill">35</span>
        </a><a href="https://csmacnzblog.github.io/categories/tips-and-tricks/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="Tips and Tricks">
          Tips and Tricks <span class="badge rounded-pill">30</span>
        </a><a href="https://csmacnzblog.github.io/categories/editorial/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="Editorial">
          Editorial <span class="badge rounded-pill">26</span>
        </a><a href="https://csmacnzblog.github.io/categories/continuous-delivery/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="Continuous Delivery">
          Continuous Delivery <span class="badge rounded-pill">13</span>
        </a><a href="https://csmacnzblog.github.io/categories/software-development/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="software development">
          software development <span class="badge rounded-pill">13</span>
        </a><a href="https://csmacnzblog.github.io/categories/projects/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="Projects">
          Projects <span class="badge rounded-pill">12</span>
        </a><a href="https://csmacnzblog.github.io/categories/conference/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="Conference">
          Conference <span class="badge rounded-pill">9</span>
        </a><a href="https://csmacnzblog.github.io/categories/git/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="git">
          git <span class="badge rounded-pill">8</span>
        </a><a href="https://csmacnzblog.github.io/categories/visual-studio/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="Visual Studio">
          Visual Studio <span class="badge rounded-pill">8</span>
        </a></div>
    </section><section class="taxonomy-tags row surface">
      <h4>
        <a href="https://csmacnzblog.github.io/tags">Tags</a>
      </h4>
      <div><a href="https://csmacnzblog.github.io/tags/c#/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="c#">
          c# <span class="badge rounded-pill">37</span>
        </a><a href="https://csmacnzblog.github.io/tags/dotnetcore/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="dotnetcore">
          dotnetcore <span class="badge rounded-pill">35</span>
        </a><a href="https://csmacnzblog.github.io/tags/tips-and-tricks/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="Tips and Tricks">
          Tips and Tricks <span class="badge rounded-pill">30</span>
        </a><a href="https://csmacnzblog.github.io/tags/editorial/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="Editorial">
          Editorial <span class="badge rounded-pill">26</span>
        </a><a href="https://csmacnzblog.github.io/tags/continuous-delivery/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="Continuous Delivery">
          Continuous Delivery <span class="badge rounded-pill">13</span>
        </a><a href="https://csmacnzblog.github.io/tags/software-development/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="software development">
          software development <span class="badge rounded-pill">13</span>
        </a><a href="https://csmacnzblog.github.io/tags/projects/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="Projects">
          Projects <span class="badge rounded-pill">12</span>
        </a><a href="https://csmacnzblog.github.io/tags/conference/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="Conference">
          Conference <span class="badge rounded-pill">9</span>
        </a><a href="https://csmacnzblog.github.io/tags/git/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="git">
          git <span class="badge rounded-pill">8</span>
        </a><a href="https://csmacnzblog.github.io/tags/visual-studio/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="Visual Studio">
          Visual Studio <span class="badge rounded-pill">8</span>
        </a></div>
    </section></div>
</aside>
</div>
    </main><footer class="footer mt-auto py-3 text-center container"><nav class="social-links nav my-2 justify-content-center"></nav>
<div class="copyright mb-2">
  
</div>
<div class="powered-by mb-2">
  Powered by <a href="https://gohugo.io" target="_blank">Hugo</a> and the <a href="https://github.com/razonyang/hugo-theme-bootstrap" target="_blank">Bootstrap</a> theme.
</div></footer>
<a id="btnScrollToTop" class="btn-scroll-to-top">
  <i class="fas fa-fw fa-chevron-circle-up fa-2x"></i>
</a>
</body>
</html>
