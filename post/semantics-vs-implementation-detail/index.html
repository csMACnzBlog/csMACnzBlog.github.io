<!DOCTYPE html>
<html lang="en">
    <head>

        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name='author' content='Mark Clearwater, csmacnz@csmac.co.nz'>
        <meta name='language' content='EN'>
        <meta name='medium' content='blog'>

    
        <title>Semantics vs implementation detail - csMACnz&#39;s Blog</title>
        <meta name="description" content="When we write out classes and variables, we are pretty good at naming them for what they represent. What I mean by this, is that when we declare a customer first name variable, we don&rsquo;t call it firstNameString, or …">
        <meta name='keywords' content='csMACnz, Patterns, Editorial'>

        
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Semantics vs implementation detail"/>
        <meta property="og:description" content="When we write out classes and variables, we are pretty good at naming them for what they represent. What I mean by this, is that when we declare a customer first name variable, we don&rsquo;t call it firstNameString, or …"/>
        <meta property="og:site_name" content="csMACnz&#39;s Blog"/>
        <meta property="og:url" content="https://blogmigration.csmac.nz/post/semantics-vs-implementation-detail/"/>
        <meta property="og:image" content="http://csmac.nz/Content/icon/icon.png"/>

        
        <meta name="twitter:card" content="summary"/>
        <meta name="twitter:title" content="Semantics vs implementation detail"/>
        <meta name="twitter:description" content="When we write out classes and variables, we are pretty good at naming them for what they represent. What I mean by this, is that when we declare a customer first name variable, we don&rsquo;t call it firstNameString, or …"/>
        <meta name="twitter:image" content="http://csmac.nz/Content/icon/icon.png"/>
        <meta name="twitter:site" content="@csMACnz"/>
        <meta name="twitter:creator" content="@csMACnz"/>
    

        <link rel="apple-touch-icon-precomposed" href="/images/icon/apple-touch-icon-precomposed.png">
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/icon/apple-touch-icon-72x72-precomposed.png">
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/icon/apple-touch-icon-114x114-precomposed.png">
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/icon/apple-touch-icon-144x144-precomposed.png">
        <link rel="icon" type="image/png" href="/images/icon/icon.png" />
        <link rel='me' type='text/html' href='https://github.com/csMACnz'>

        <script>
            var d_id  = 'csmacnz',
                g_id  = 'UA-18464866-2',
                g_url = 'auto';
        </script>

        <link rel="stylesheet" type="text/css" href="/css/style.css" />
        <link rel="stylesheet" type="text/css" href="/css/blogstyle.css" />

        <link rel="alternate stylesheet" title="dark-code" type="text/css" href="/css/solarized_dark.css" disabled>
        <link rel="stylesheet" title="light-code" type="text/css" href="/css/github-gist.css" disabled>

        
        
        <script type="application/ld+json">
        {
            "@context" : "https://schema.org",
            "@type" : "Article",
            "publisher": {
                "@type": "Organization",
                "name": "csMACnz&#x27;s Blog",
                "logo": "https:\/\/blogmigration.csmac.nz\/images\/icon\/apple-touch-icon-144x144-precomposed.png"
            },
            "author": {
                "@type": "Person",
                "name": "Mark Clearwater",
                "image": {
                    "@type": "ImageObject",
                    "url": "//www.gravatar.com/avatar/c97410951ec3738a3fd4a2dfb17a5d9c?d=404&s=250",
                    "width": 440,
                    "height": 295
                },
                "url": "https:\/\/blogmigration.csmac.nz",
                "sameAs": [
                    "http://csmac.nz"
                ]
            },
            "articleSection" : "post",
            "name" : "Semantics vs implementation detail",
            "headline" : "Semantics vs implementation detail",
            "url" : "https:\/\/blogmigration.csmac.nz\/post\/semantics-vs-implementation-detail\/",
            "datePublished": "2015-01-11T16:36:29.000Z",
            "dateModified" : "2015-01-11T16:36:29.000Z",
            "keywords" : [ "Patterns", "Editorial" ]
            "description" : "When we write out classes and variables, we are pretty good at naming them for what they represent. What I mean by this, is that when we declare a customer first name variable, we don\u0026rsquo;t call it firstNameString, or cfnString, and we have also lost the bad habit of firstNameStr or strFirstName. The implementation detail simply doesn\u0026rsquo;t matter. Semantically, it represents the customer\u0026rsquo;s first name, so we use customerFirstName. Or if we are clearly in the context of the customer we can simply use firstName or customer.",
            "mainEntityOfPage": {
                "@type": "WebPage",
                "@id": "https:\/\/blogmigration.csmac.nz"
            }
            "inLanguage" : "en-US",
            "author" : "Mark Clearwater",
            "creator" : "Mark Clearwater",
            "accountablePerson" : "Mark Clearwater",
            "copyrightHolder" : "Mark Clearwater",
            "copyrightYear" : "2015",
            "wordCount" : "1314",
        }
        </script>
        
        
        
    </head>
    <body class="blog">
        <div class="page-area">

            <header class="header-area">
                <h1 class="header-area-title">csMACnz</h1>
            </header>
            <nav class="navigation-area header-bar-parent">
                <div class="header-bar header-bar-blog">
                    <ul class="menu">
                        <li class="menu-item"><a class="menu-item-content" href="http://csmac.nz">Home</a></li>
                        <li class="menu-item"><a class="menu-item-content" href="http://csmac.nz/BaconVaders">Bacon Vaders</a></li>
                        <li class="menu-item"><a class="menu-item-content CurrentButton" href="/">Blog</a></li>
                    </ul>
                </div>
            </nav>

            <div id="content" class="content-area">

<!--Page Content Begins-->

<article>
    <div class="content-box" itemscope itemtype="http://schema.org/Article">
    
        <span class="post-meta"><time datetime="2015-01-11"  itemprop="datePublished">11 Jan 15</time> on <a href="/tags/patterns">Patterns</a>,  <a href="/tags/editorial">Editorial</a></span>
    
        <h1 class="post-title" itemprop="headline">Semantics vs implementation detail</h1>
    
        <section class="post-content"  itemprop="articleBody">
            <p>When we write out classes and variables, we are pretty good at naming them for what they represent. What I mean by this, is that when we declare a customer first name variable, we don&rsquo;t call it <code>firstNameString</code>, or <code>cfnString</code>, and we have also lost the bad habit of <code>firstNameStr</code> or <code>strFirstName</code>.  The implementation detail simply doesn&rsquo;t matter. Semantically, it represents the customer&rsquo;s first name, so we use <code>customerFirstName</code>. Or if we are clearly in the context of the customer we can simply use <code>firstName</code> or <code>customer.FirstName</code>.</p>
<p>By describing things by what they represent and not how they are represented, we make them more resistant to implementation changes, and we also make it clearer what it is we expect from their use. Why then do we not treat types the same way?</p>
<p>Well we do, you might say. Sure we name our classes well. We have <code>Customer</code>, which is an class which has a name that matches it&rsquo;s semantic meaning. But why does it have a constructor signature like this?</p>
<pre><code class="language-cs">public Customer(string firstName, string surname, string preferredName, int age, decimal weight, decimal height) {...}
</code></pre>
<p>Can you tell from this constructor what each positional parameter represents? What if we did the following, is it still obvious?</p>
<pre><code class="language-cs">public Customer(string a, string b, string c, int d, decimal e, decimal f) {...}
</code></pre>
<p>Ok so my example is contrived, but my point is simple. Positional parameters of value types are indistinguishable to the compiler, which neither knows nor cares what they mean, just that the types match so it can compile.  If you called this method using <code>new Customer(&quot;Jones&quot;, &quot;Bobby&quot;, &quot;Robert&quot;, 24, 1.68m, 91.3m)</code> the compiler doesn&rsquo;t care that you created the lightest giant in the world called Jones Bobby with a nickname of Robert, how is it to know that&rsquo;s not what you meant?  What we need is a way to add semantic meaning to the positional parameters, which adds extra meaning to the data being passed around, and helps us avoid this transposition of errors, among other things.</p>
<p>I have come across several names for this technique, <em>Tiny Types</em>, <em>Value Types</em>, <em>Micro Types</em> and <em>Semantic Types</em>.  I think my favourite is Semantic Types personally, but in discussion with others you may come across all of these and more.  The point is that we create new types in our system that might be domain specific, or may be valid across various disparate systems.  These types encapsulate the implementation types used to represent the data and stand in their place as an immutable value object.</p>
<p>It is worth noting that Enumerations are a kind of tiny type, but you do get some interesting behaviour with these sometimes when the int implementation leaks out, especially when casting and serialisation is involved.</p>
<p>Lets go back to our example and see what the end result looks like, and work backwards with an implementation. Here is our constructor in more detail this time.</p>
<pre><code class="language-cs">public Customer
{
    ... [Auto properties probably here]
    
    public Customer(FirstName firstName, FamilyName familyName, PreferredName preferredName, 
                    Age age, Weight weight, Height height)
    {
    ...
    }
}
</code></pre>
<p>Ok now lets look at what we have here.  The types of the parameters are objects that encapsulate the data they represent. Now whether you split your names like this or have a <em>Name</em> type that represents this as a whole is up to you, but the point is that you can&rsquo;t mix us the height with the weight since the types won&rsquo;t match, and it won&rsquo;t compile.</p>
<p>There are other benefits other then transposing parameters.  Overloads that expect different types of data can be created instead of having unique names just for overloading what string represents. If you use calculations on the data, you won&rsquo;t add or subtract things that are not compatible accidentally, like our height and our weight.  Even something as simple as wrapping your entity keys in semantic types means you can&rsquo;t pass a <code>CustomerKey</code> into a method like <code>public Document[] GetForms(AccountKey key)</code> because the compiler will catch it for you.  If you need to change your representation, this is also easy, without having to update all references to the implementation type everywhere, say if you need to add precision to your int by using decimal.</p>
<p>Lets take a look now at what implementing a tiny type might look like.  Basically its an object. It will have a property to expose the primitive implementation, since at some point this will have to interface with something outside your control (see suggested exercises for more on this).  You will also need to overload the equality operations to ensure you can compare these objects without any issue.</p>
<pre><code class="language-cs">public class Height: IEquatable&lt;Height&gt;
{
    private readonly decimal _value;

    public Height(decimal dataValue)
    {
        _value = dataValue;
    }

    public decimal Value { get { return _value; } }

    public override bool Equals(System.Object obj)
    {
        // If parameter is null return false.
        if (obj == null)
        {
            return false;
        }

        // If parameter cannot be cast to Height return false.
        Height h = obj as Height;
        if ((System.Object)h == null)
        {
            return false;
        }

        // Return true if the fields match:
        return Value == h.Value;
    }

    public bool Equals(Height h)
    {
        // If parameter is null return false:
        if ((object)h == null)
        {
            return false;
        }

        // Return true if the fields match:
        return Value == h.Value;
    }

    public override int GetHashCode()
    {
        return Value.GetHashCode();
    }

    public static bool operator ==(Height a, Height b)
    {
        // If both are null, or both are same instance, return true.
        if (System.Object.ReferenceEquals(a, b))
        {
            return true;
        }

        // If one is null, but not both, return false.
        if (((object)a == null) || ((object)b == null))
        {
            return false;
        }

        // Return true if the fields match:
        return a.Value == b.Value;
    }

    public static bool operator !=(Height a, Height b)
    {
        return !(a == b);
    }
}
</code></pre>
<p>(If your interest, my implementation is based on <a href="http://msdn.microsoft.com/en-us/library/ms173147%28v=vs.80%29.aspx">this msdn guide</a>.)</p>
<p>There&rsquo;s a lot of code here, so lets look at it in pieces. First its a class with a property value that we can set in the constructor.  We make it a getter only with a read only backing field, making it immutable.</p>
<pre><code class="language-cs">public class Height: IEquatable&lt;Height&gt;
{
    private readonly decimal _value;

    public Height(decimal dataValue)
    {
        _value = dataValue;
    }

    public decimal Value { get { return _value; } }
    ...
</code></pre>
<p>To make sure we can compare our tiny types in a standard way, we implement a bunch of the comparable implementation details. Specifically we override GetHashCode and Equals.  We also overload the == and != operator to make it even easier to use correctly, and lastly we implement IEquatable&lt;Height&gt; so we can compare two instances of the same type without all the object reference stuff all the time.</p>
<p>Obviously you could take this approach and build out a generic base class with most of the common logic.  Here is a list of things you might want to try out to get your head around the approach of building these types of objects on your own.</p>
<ul>
<li>Implement a generic base class representing a single primitive value wrapped in a Semantic Type.</li>
<li>Create a T4 template that can read in settings about the name and type and produce classes like these without generics.</li>
<li>Implement domain specific validations, so your semantic types only support a sub-set of the valid value types (think about email addresses and the string type for instance)</li>
<li>Make a more complex Semantic Type that has more than one backing field (represent a fraction, or a Point in 3d space for instance)</li>
<li>Can you get your object to automatically expose it&rsquo;s internal value for you using custom cast operators, instead of using a Value property?</li>
</ul>
<p>I may look at creating demos on these points, but for now enjoy playing with how these things come together and I hope to see more people using these in projects in the future.</p>
<p>(See it compare <a href="https://dotnetfiddle.net/wvpxGJ">here</a>)</p>
</section>
        
        <section class="share">
            Share: 
            <a class="icon-twitter" href="http://twitter.com/share?text=Semantics%20vs%20implementation%20detail&url=https%3a%2f%2fblogmigration.csmac.nz%2fpost%2fsemantics-vs-implementation-detail%2f"
                onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                <span>Twitter</span>
            </a>
            |
            <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fblogmigration.csmac.nz%2fpost%2fsemantics-vs-implementation-detail%2f"
                onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                <span>Facebook</span>
            </a>
        </section>
    </div>
    <div class="content-box">
        
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            var disqus_shortname = d_id; 
            var disqus_title = 'Semantics vs implementation detail';
            
             
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    
    </div>
</article>

<!--Page Content Ends-->

            </div><aside class="sidebar-area">

<!--Sidebar Content Begins-->

                <div class="header-bar-parent sidebar-item">
                    <div class="header-bar header-bar-twitter">Twitter</div>
                    
                    <a class="twitter-timeline" style="display: block; text-align: center;" href="https://twitter.com/csmacnz" data-widget-id="523634688984772608">Tweets by @@csmacnz</a>
                    <script>!function (d, s, id) { var js, fjs = d.getElementsByTagName(s)[0], p = /^http:/.test(d.location) ? 'http' : 'https'; if (!d.getElementById(id)) { js = d.createElement(s); js.id = id; js.src = p + "://platform.twitter.com/widgets.js"; fjs.parentNode.insertBefore(js, fjs); } }(document, "script", "twitter-wjs");</script>
                    
                </div>


                <div class="header-bar-parent sidebar-item">
                    <div class="header-bar header-bar-rss">Subscribe</div>
                    
                    <a href="/rssfeeds/" title="csMACnz's Blog">RSS Feeds</a>
                    <a href="http://add.my.yahoo.com/rss?url=http://feeds.feedburner.com/csmacnzBlog" title="csMACnz&amp;#039;s Blog"><img src="http://us.i1.yimg.com/us.yimg.com/i/us/my/addtomyyahoo4.gif" alt="" style="border:0"/></a>
                    <a href="http://feedly.com/#subscription/feed/http://feeds.feedburner.com/csmacnzBlog" title="csMACnz&amp;#039;s Blog"><img src="http://s3.feedly.com/feedburner/feedly.png" alt="" style="border:0"/></a>
                    <a href="http://www.netvibes.com/subscribe.php?url=http://feeds.feedburner.com/csmacnzBlog"><img src="http://www.netvibes.com/img/add2netvibes.gif" width="91" height="17" alt="Add to netvibes" style="border:0" /></a>
                    <a href="http://feeds.feedburner.com/csmacnzBlog"><img src="http://feeds.feedburner.com/~fc/csmacnzBlog?bg=fabb45&amp;fg=4B4B4B&amp;anim=1" height="26" width="88" style="border:0" alt="" /></a>
                    <br />
                    <a href="https://www.patreon.com/csMACnz" target="_blank"><img src="/images/patreon.png" /></a>
                    
                    
                </div>


                <div class="header-bar-parent sidebar-item">
                    <div class="header-bar header-bar-xbox">Gamercard</div>
                    

                    <div>
                        <a href="https://www.exophase.com/xbox/user/csMACnz/"><img width="288px" src="https://card.exophase.com/1/1476805.png"></a>
                        <a href="http://steamcommunity.com/id/csMACnz/" target="_blank"><img src="https://www.steamsignature.com/status/english/76561197994712512.png" alt="" title="csMACnz's Steam Profile" /></a>
                    </div>
                    
                </div>


                <div class="header-bar-parent sidebar-item">
                    <div class="header-bar header-bar-ads">Advertisement</div>
                    
                    <div>
                        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4517187877737982"
                            crossorigin="anonymous"></script>
                        
                        <ins class="adsbygoogle"
                            style="display:block"
                            data-ad-client="ca-pub-4517187877737982"
                            data-ad-slot="3618449993"
                            data-ad-format="auto"
                            data-full-width-responsive="true"></ins>
                        <script>
                            (adsbygoogle = window.adsbygoogle || []).push({});
                        </script>
                    </div>
                    
                </div>

<!--Sidebar Content Ends-->

            </aside>

            <footer class="footer-area">

            <p>
                Designed and Maintained by Mark Clearwater; Last updated August 2021.
                <!-- This used to be something useful, now it is just a hack I left it to make layout easier but also as a fun reminder for me of what it used to be -->
                <br /><a class="footer-link" >¯\_(ツ)_/¯</a>
            </p>

            </footer>
        </div>

<!--body scripts Begins-->

        
        <script src="/js/highlight.pack.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>

        <script src="/js/codetoggle.js"></script> 

        
        <script>
            var _gaq = [['_setAccount', g_id], ['_trackPageview']];
            (function (d, t) {
                var g = d.createElement(t), s = d.getElementsByTagName(t)[0];
                g.src = ('https:' == location.protocol ? '//ssl' : '//www') + '.google-analytics.com/ga.js';
                s.parentNode.insertBefore(g, s);
            }(document, 'script'));
        </script>

        <script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>

<!--body scripts Ends-->


<!-------------------------------->
<!--                            -->
<!--  _(\    |@@|               -->
<!-- (__/\__ \--/ __            -->
<!--    \___|----|  |   __      -->
<!--        \ }{ /\ )_ / _\     -->
<!--        /\__/\ \__O (__     -->
<!--       (--/\--)    \__/     -->
<!--       _)(  )(_             -->
<!--      `---''---`            -->
<!--                            -->
<!-- https://github.com/csMACnz -->
<!-------------------------------->

    </body>
</html>
