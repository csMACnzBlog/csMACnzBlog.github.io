<!DOCTYPE html>
<html lang="en">
    <head>

        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name='author' content='Mark Clearwater, csmacnz@csmac.co.nz'>
        <meta name='language' content='EN'>
        <meta name='medium' content='blog'>

    
        <title>More small classes - csMACnz&#39;s Blog</title>
        <meta name="description" content="Its a pretty common rule of thumb to avoid monoliths and write more small classes. Think about the solid principles.  Single responsibility per class. This implies less in it. Smaller. Open for extension closed for …">
        <meta name='keywords' content='csMACnz, Patterns'>

        
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="More small classes"/>
        <meta property="og:description" content="Its a pretty common rule of thumb to avoid monoliths and write more small classes. Think about the solid principles.  Single responsibility per class. This implies less in it. Smaller. Open for extension closed for …"/>
        <meta property="og:site_name" content="csMACnz&#39;s Blog"/>
        <meta property="og:url" content="https://blogmigration.csmac.nz/post/more-small-classes/"/>
        <meta property="og:image" content="https://csmac.nz/Content/icon/icon.png"/>

        
        <meta name="twitter:card" content="summary"/>
        <meta name="twitter:title" content="More small classes"/>
        <meta name="twitter:description" content="Its a pretty common rule of thumb to avoid monoliths and write more small classes. Think about the solid principles.  Single responsibility per class. This implies less in it. Smaller. Open for extension closed for …"/>
        <meta name="twitter:image" content="https://csmac.nz/Content/icon/icon.png"/>
        <meta name="twitter:site" content="@csMACnz"/>
        <meta name="twitter:creator" content="@csMACnz"/>
    

        <link rel="apple-touch-icon-precomposed" href="/images/icon/apple-touch-icon-precomposed.png">
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/icon/apple-touch-icon-72x72-precomposed.png">
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/icon/apple-touch-icon-114x114-precomposed.png">
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/icon/apple-touch-icon-144x144-precomposed.png">
        <link rel="icon" type="image/png" href="/images/icon/icon.png" />
        <link rel='me' type='text/html' href='https://github.com/csMACnz'>

        <script>
            var d_id  = 'csmacnz',
                g_id  = 'UA-18464866-2',
                g_url = 'auto';
        </script>

        <link rel="stylesheet" type="text/css" href="/css/style.css" />
        <link rel="stylesheet" type="text/css" href="/css/blogstyle.css" />

        <link rel="alternate stylesheet" title="dark-code" type="text/css" href="/css/solarized_dark.css" disabled>
        <link rel="stylesheet" title="light-code" type="text/css" href="/css/github-gist.css" disabled>

        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4517187877737982"
        crossorigin="anonymous"></script>

        
        
        <script type="application/ld+json">
        {
            "@context" : "https://schema.org",
            "@type" : "Article",
            "publisher": {
                "@type": "Organization",
                "name": "csMACnz&#x27;s Blog",
                "logo": "https:\/\/blogmigration.csmac.nz\/images\/icon\/apple-touch-icon-144x144-precomposed.png"
            },
            "author": {
                "@type": "Person",
                "name": "Mark Clearwater",
                "image": {
                    "@type": "ImageObject",
                    "url": "//www.gravatar.com/avatar/c97410951ec3738a3fd4a2dfb17a5d9c?d=404&s=250",
                    "width": 440,
                    "height": 295
                },
                "url": "https:\/\/blogmigration.csmac.nz",
                "sameAs": [
                    "https://csmac.nz"
                ]
            },
            "articleSection" : "post",
            "name" : "More small classes",
            "headline" : "More small classes",
            "url" : "https:\/\/blogmigration.csmac.nz\/post\/more-small-classes\/",
            "datePublished": "2015-06-21T08:49:59.000Z",
            "dateModified" : "2015-06-21T08:49:59.000Z",
            "keywords" : [ "Patterns" ]
            "description" : "Its a pretty common rule of thumb to avoid monoliths and write more small classes. Think about the solid principles.\n Single responsibility per class. This implies less in it. Smaller. Open for extension closed for modification. Take out the things that will change. Smaller. Liskov substitution principle says substitutability is the way to go. Easier to ensure when your class is smaller. Interface segregation. Smaller interfaces. Dependencies being passed in means less surface area accessible or exposed.",
            "mainEntityOfPage": {
                "@type": "WebPage",
                "@id": "https:\/\/blogmigration.csmac.nz"
            }
            "inLanguage" : "en-US",
            "author" : "Mark Clearwater",
            "creator" : "Mark Clearwater",
            "accountablePerson" : "Mark Clearwater",
            "copyrightHolder" : "Mark Clearwater",
            "copyrightYear" : "2015",
            "wordCount" : "1020",
        }
        </script>
        
        
        
    </head>
    <body class="blog">
        <div class="page-area">

            <header class="header-area">
                <h1 class="header-area-title">csMACnz</h1>
            </header>
            <nav class="navigation-area header-bar-parent">
                <div class="header-bar header-bar-blog">
                    <ul class="menu">
                        <li class="menu-item"><a class="menu-item-content" href="https://csmac.nz">Home</a></li>
                        <li class="menu-item"><a class="menu-item-content" href="https://csmac.nz/BaconVaders">Bacon Vaders</a></li>
                        <li class="menu-item"><a class="menu-item-content CurrentButton" href="/">Blog</a></li>
                    </ul>
                </div>
            </nav>

            <div id="content" class="content-area">

<!--Page Content Begins-->

<article>
    <div class="content-box" itemscope itemtype=" https://schema.org/Article">
    
        <span class="post-meta"><time datetime="2015-06-21"  itemprop="datePublished">21 Jun 15</time> on <a href="/tags/patterns">Patterns</a></span>
    
        <h1 class="post-title" itemprop="headline">More small classes</h1>
    
        <section class="post-content"  itemprop="articleBody">
            <p>Its a pretty common rule of thumb to avoid monoliths and write more small classes. Think about the solid principles.</p>
<ul>
<li>Single responsibility per class. This implies less in it. Smaller.</li>
<li>Open for extension closed for modification. Take out the things that will change. Smaller.</li>
<li>Liskov substitution principle says substitutability is the way to go. Easier to ensure when your class is smaller.</li>
<li>Interface segregation. Smaller interfaces.</li>
<li>Dependencies being passed in means less surface area accessible or exposed. Smaller.</li>
</ul>
<p>Ok, some of that might be a stretch, but as a stand-alone rule of thumb, <strong>more small classes</strong> is a key tenant that helps you meet most if not all of the above principles.</p>
<p>Here is an example from work today that I think shows the simplicity of this principle, that is often missed or overlooked.</p>
<h3 id="the-problem">The Problem</h3>
<p>We have a class FooService. Now this class is responsible for getting us some Foo. (really need to find a picture of what a Foo actually looks like, the internet thinks it looks like <a href="http://images.google.com/search?tbm=isch&amp;q=Foo">a Dave Grohl</a>).</p>
<pre><code class="language-cs">public class FooService : IFooService
{
    public Foo GetFoo(CustomerId id)
    {
        Foo foo;
        ... //Actual implementation logic
        return foo
    }
}
</code></pre>
<p>The implementation is not important. It might be a database call, or a restful call, a reading from a hardware device, whatever.</p>
<p>Now we have this requirement that we are calling the Service from several places (properly injected and scoped of course) but we realise that we are calling it several times per request scope (lets assume this is MVC). We want to be able to reuse the result across the request scope, but not any wider.</p>
<h3 id="solution-decision">Solution Decision</h3>
<p>One thing we could do, is make a call at the start of the scope, and pass the result along to where it is needed. The problem there would be that we are a modular system and we have 4-5 calls between us and the place we need the value. Also they are down two different use case paths, and everything is constructor injected.  Lets try another approach. Caching.</p>
<p>Caching is a great way to reuse a result temporarily. In fact I would argue that&rsquo;s exactly what its for. So let&rsquo;s start with the naive version.</p>
<h3 id="solution-implementation-the-wrong-way">Solution Implementation: the wrong way</h3>
<p>Lets add caching to our class. Should be fairly simple, something like this:</p>
<pre><code class="language-cs">public class FooService : IFooService
{
    Dictionary&lt;CustomerId, Foo&gt; _cache = new Dictionary&lt;CustomerId, Foo&gt;();
    public Foo GetFoo(CustomerId id)
    {
        Foo foo;

        if(_cache.ContainsKey(id){
            return _cache[id];
        }

        ... //Actual implementation logic

        _cache[id] = foo;

        return foo
    }
}
</code></pre>
<p>Looks fine right? Sure thing, but we should take care of the scope in our container so it gets correctly set to request scope.</p>
<pre><code class="language-cs">Bind&lt;IFooService&gt;().To&lt;FooService&gt;().InRequestScope();
</code></pre>
<p>Something resembling a container setup. Cool.</p>
<p>Why is this the wrong approach?  I have two specific issues with this code.</p>
<ul>
<li>We have two concerns to our class now. <em>Retrieving</em> and <em>Caching</em>.</li>
<li>We separated two parts of our cache configuration, the <em>Where</em> from the <em>Scope</em>, across the system.</li>
</ul>
<p>The first concern is the main point of the article. Subtle violations occur without even realising it (I&rsquo;m guilty of this as much as anyone). We need to constantly ask ourselves what the concerns of a class are, to slowing build up a knowledge of known cases to be on the lookout for. This class has two concerns. We <em>can</em> separate them, and Ill show how easy that is to do next.</p>
<p>The second is almost more subtle though. Here, we are separating the same concern, caching, into different places. because the cache logic is internal, you can&rsquo;t see it from where it is used. That is fine, since that is not your concern where you use it. But to configure it, you rely on the container for your IOC framework to be configured correctly. It is not clear from the cache code what the lifetime is, and not clear from the lifetime that it relates to caching.  We need to bring these two pieces of information closer together. Luckily, by pulling out the cache concern from the service, we almost get that for fee. Lets see how.</p>
<h3 id="solution-implementation-the-right-way">Solution Implementation: the right way</h3>
<p>We start by going back to our original implementation.</p>
<pre><code class="language-cs">public class FooService : IFooService
{
    public Foo GetFoo(CustomerId id)
    {
        Foo foo;
        ... //Actual implementation logic
        return foo
    }
}
</code></pre>
<p>Instead of writing the caching inside the existing class, we create a new <em>wrapper</em> class instead.</p>
<pre><code class="language-cs">public class FooServiceCacheWrapper : IFooService
{
    private IFooService _actual;

    public FooServiceCacheWrapper(IFooService actual)
    {
    	_actual = actual;
    }

    public Foo GetFoo(CustomerId id)
    {
        Foo foo;

        if(_cache.ContainsKey(id){
            return _cache[id];
        }

        foo = _actual.GetFoo(id);

        _cache[id] = foo;

        return foo
    }
}
</code></pre>
<p>There are three key parts to point out in this implementation. It adds almost exactly the same code as we were going to add (no extra work was required to go this alternate root). We didn&rsquo;t have to change the existing code to do it. And third, we are implementing the same interface as the original, and wrapping around it a sort of caching layer. This is almost <a href="https://en.wikipedia.org/wiki/Aspect-oriented_programming">AOP</a>, and is making use of the <a href="https://en.wikipedia.org/?title=Proxy_pattern">Proxy Pattern</a>.</p>
<p>The second part is in our IOC config:</p>
<pre><code class="language-cs">Bind&lt;IFooService&gt;()
    .To&lt;FooServiceCacheWrapper&gt;()
    .UsingConstructorParameter&lt;FooService&gt;()
    .InRequestScope();
</code></pre>
<p>or</p>
<pre><code class="language-cs">Bind&lt;IFooService&gt;()
    .To(c=&gt; new FooServiceCacheWrapper(c.Resolve&lt;FooService&gt;))
    .InRequestScope();
</code></pre>
<p>The syntaxes are made up, but the concept is there, and hopefully one looks familiar enough for you to implement in your IOC of choice. We Resolve our existing interface to our new Wrapper class instead. And part of resolving our wrapper class, is to use the concrete version of the service that will do the actual work. This is a simplistic approach similar to the idea of the <a href="https://en.wikipedia.org/wiki/Chain-of-responsibility_pattern">Chain of responsibility pattern</a>. We are now composing together our classes to achieve the desired result.</p>
<p>As a bonus, we see now that the place where we configure our caching around the service, we also define the scope of the cache class. Much nicer to see these two concepts in the same place now, don&rsquo;t you think?</p>
<p>Hopefully this opens your eyes and starts you thinking. Keep looking out for places where you have been ignoring the single responsibility pattern, and make <strong>more small classes</strong>.</p>
</section>
        
        <section class="share">
            Share: 
            <a class="icon-twitter" href="https://twitter.com/share?text=More%20small%20classes&url=https%3a%2f%2fblogmigration.csmac.nz%2fpost%2fmore-small-classes%2f"
                onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                <span>Twitter</span>
            </a>
            |
            <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fblogmigration.csmac.nz%2fpost%2fmore-small-classes%2f"
                onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                <span>Facebook</span>
            </a>
        </section>
    </div>
    <div class="content-box">
        
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            var disqus_shortname = d_id; 
            var disqus_title = 'More small classes';
            
             
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    
    </div>
</article>

<!--Page Content Ends-->

            </div><aside class="sidebar-area">

<!--Sidebar Content Begins-->

                <div class="header-bar-parent sidebar-item">
                    <div class="header-bar header-bar-twitter">Twitter</div>
                    
                    <a class="twitter-timeline" data-lang="en" data-height="510" data-dnt="true" href="https://twitter.com/csMACnz?ref_src=twsrc%5Etfw">Tweets by csMACnz</a> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
                    
                </div>


                <div class="header-bar-parent sidebar-item">
                    <div class="header-bar header-bar-rss">Subscribe</div>
                    
                    <a href="/rssfeeds/" title="csMACnz's Blog">RSS Feeds</a>
                    <a href="https://feedly.com/i/subscription/feed%2Fhttps%3A%2F%2Ffeeds.feedburner.com%2FcsmacnzBlog" target="_blank" title="csMACnz&amp;#039;s Blog"><img src="https://s3.feedly.com/feedburner/feedly.png" alt="" style="border:0"/></a>
                    <a href="https://feeds.feedburner.com/csmacnzBlog" target="_blank"><img src="https://feeds.feedburner.com/~fc/csmacnzBlog?bg=fabb45&amp;fg=4B4B4B&amp;anim=1" height="26" width="88" style="border:0" alt="" /></a>
                    <br />
                    <a href="https://www.patreon.com/csMACnz" target="_blank"><img src="/images/patreon.png" /></a>
                    
                    
                </div>


                <div class="header-bar-parent sidebar-item">
                    <div class="header-bar header-bar-xbox">Gamercard</div>
                    

                    <div>
                        <a href="https://www.exophase.com/xbox/user/csMACnz/"><img width="288px" src="https://card.exophase.com/1/1476805.png"></a>
                        <a href="http://steamcommunity.com/id/csMACnz/" target="_blank"><img src="https://www.steamsignature.com/status/english/76561197994712512.png" alt="" title="csMACnz's Steam Profile" /></a>
                    </div>
                    
                </div>


                <div class="header-bar-parent sidebar-item">
                    <div class="header-bar header-bar-ads">Advertisement</div>
                    
                    <div>
                        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4517187877737982"
                            crossorigin="anonymous"></script>
                        
                        <ins class="adsbygoogle"
                            style="display:block"
                            data-ad-client="ca-pub-4517187877737982"
                            data-ad-slot="3618449993"
                            data-ad-format="auto"
                            data-full-width-responsive="true"></ins>
                        <script>
                            (adsbygoogle = window.adsbygoogle || []).push({});
                        </script>
                    </div>
                    
                </div>

<!--Sidebar Content Ends-->

            </aside>

            <footer class="footer-area">

            <p>
                Designed and Maintained by Mark Clearwater; Last updated August 2021.
                <!-- This used to be something useful, now it is just a hack I left it to make layout easier but also as a fun reminder for me of what it used to be -->
                <br /><a class="footer-link" >¯\_(ツ)_/¯</a>
            </p>

            </footer>
        </div>

<!--body scripts Begins-->

        
        <script src="/js/highlight.pack.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>

        <script src="/js/codetoggle.js"></script> 

        
        <script>
            var _gaq = [['_setAccount', g_id], ['_trackPageview']];
            (function (d, t) {
                var g = d.createElement(t), s = d.getElementsByTagName(t)[0];
                g.src = ('https:' == location.protocol ? '//ssl' : '//www') + '.google-analytics.com/ga.js';
                s.parentNode.insertBefore(g, s);
            }(document, 'script'));
        </script>

        <script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>

<!--body scripts Ends-->


<!-------------------------------->
<!--                            -->
<!--  _(\    |@@|               -->
<!-- (__/\__ \--/ __            -->
<!--    \___|----|  |   __      -->
<!--        \ }{ /\ )_ / _\     -->
<!--        /\__/\ \__O (__     -->
<!--       (--/\--)    \__/     -->
<!--       _)(  )(_             -->
<!--      `---''---`            -->
<!--                            -->
<!-- https://github.com/csMACnz -->
<!-------------------------------->

    </body>
</html>
