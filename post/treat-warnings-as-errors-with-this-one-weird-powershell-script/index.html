<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Treat Warnings As Errors with this one weird PowerShell Script... - csMacnz&#39;s Blog</title><link rel="apple-touch-icon" href="https://csmacnzblog.github.io/images/favicons/apple-touch-icon.png" sizes="180x180">
<link rel="icon" href="https://csmacnzblog.github.io/images/favicons/favicon-32x32.png" sizes="32x32" type="image/png">
<link rel="icon" href="https://csmacnzblog.github.io/images/favicons/favicon-16x16.png" sizes="16x16" type="image/png">
<link rel="manifest" href="https://csmacnzblog.github.io/images/favicons/manifest.json">
<link rel="icon" href="https://csmacnzblog.github.io/images/favicons/favicon.ico">
<meta name="keywords" content="" />
<meta name="description" content="" /><meta itemprop="name" content="Treat Warnings As Errors with this one weird PowerShell Script...">
<meta itemprop="description" content="There is this great feature in Visual Studio that lets you really dial up the quality of your code. It has been there forever it seems, but very few people use it.
The compiler spits out errors, which stop your app compiling. You fix your errors and move on. But the compiler also spits out a lot of warnings too. And many of these are to do with the quality of your code, and possible code errors you have introduced that could cause you issues later on."><meta itemprop="datePublished" content="2016-05-09T08:30:59+00:00" />
<meta itemprop="dateModified" content="2016-05-09T08:30:59+00:00" />
<meta itemprop="wordCount" content="641">
<meta itemprop="keywords" content="Visual Studio,PowerShell," /><meta property="og:title" content="Treat Warnings As Errors with this one weird PowerShell Script..." />
<meta property="og:description" content="There is this great feature in Visual Studio that lets you really dial up the quality of your code. It has been there forever it seems, but very few people use it.
The compiler spits out errors, which stop your app compiling. You fix your errors and move on. But the compiler also spits out a lot of warnings too. And many of these are to do with the quality of your code, and possible code errors you have introduced that could cause you issues later on." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://csmacnzblog.github.io/post/treat-warnings-as-errors-with-this-one-weird-powershell-script/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2016-05-09T08:30:59+00:00" />
<meta property="article:modified_time" content="2016-05-09T08:30:59+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Treat Warnings As Errors with this one weird PowerShell Script..."/>
<meta name="twitter:description" content="There is this great feature in Visual Studio that lets you really dial up the quality of your code. It has been there forever it seems, but very few people use it.
The compiler spits out errors, which stop your app compiling. You fix your errors and move on. But the compiler also spits out a lot of warnings too. And many of these are to do with the quality of your code, and possible code errors you have introduced that could cause you issues later on."/>
<link rel=stylesheet href="https://csmacnzblog.github.io/css/bundle.min.ce383e7297312216c2d2ced30574d5a9ae83c451db9f064a454509955ae2462d.css" integrity="sha256-zjg&#43;cpcxIhbC0s7TBXTVqa6DxFHbnwZKRUUJlVriRi0=" crossorigin="anonymous"><script src="https://csmacnzblog.github.io/js/bundle.min.ad6d83537f5b4374c837a12a76422496582e04d1dde91bbb443641ec12c506c6.js" integrity="sha256-rW2DU39bQ3TIN6EqdkIkllguBNHd6Ru7RDZB7BLFBsY=" crossorigin="anonymous"></script>
</head><body><header><nav class="navbar navbar-expand-xl fixed-top">
  <div class="container">
    <a class="navbar-brand" href="https://csmacnzblog.github.io">
      <img class="logo" alt="Logo" src="https://csmacnzblog.github.io/images/logo.webp" loading="lazy"></a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav me-1 mb-2 mb-lg-0"><form class="search-bar d-flex ms-1" action="https://csmacnzblog.github.io/search">
  <div class="input-group input-group-sm">
    <button class="btn btn-search disabled position-absolute left-0" type="submit"><i class="fas fa-fw fa-search"></i></button>
    <input class="form-control rounded-pill" id="searchQuery" name="q" type="search" aria-label="Search">
  </div>
</form></ul><ul class="navbar-nav me-1 mb-2 mb-lg-0 me-1 ms-auto"><li class="nav-item">
  <a class="nav-link" data-bs-toggle="offcanvas" href="#offcanvasSettings" role="button"
    aria-controls="offcanvasSettings">
    <i class="fas fa-fw fa-sliders-h"></i> Settings
  </a>
</li>

<div class="offcanvas offcanvas-end surface h-100" tabindex="-1" id="offcanvasSettings"
  aria-labelledby="offcanvasSettingsLabel">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title" w id="offcanvasSettingsLabel"><i class="fas fa-fw fa-sliders-h"></i> Settings</h5>
    <a role="button" data-bs-dismiss="offcanvas" aria-label="Close">
      <span class="fas fa-2x fa-fw fa-times"></span>
    </a>
  </div>
  <div class="offcanvas-body"><section class="setting">
  <form class="row">
    <div class="col-auto">
      <label><i class="fas fa-fw fa-adjust"></i> Mode</label>
    </div>
    <div class="col-auto ms-auto">
      <div class="form-check form-switch">
        <input class="form-check-input" type="checkbox" id="modeSwitcher">
      </div>
    </div>
  </form>
</section>
<section class="setting palettes">
  <form class="row">
    <div class="col-auto">
      <label><i class="fas fa-fw fa-palette"></i> Palette</label>
    </div>
    <div class="col-auto ms-auto">
      <span id="btnPalette" class="btn btn-sm"><i class="fas fa-eye-dropper"></i></span>
    </div>
  </form>
  <div class="container mt-2 visually-hidden" id="palettePicker">
    <div class="btn-group"><button type="button" id="palette-blue" title="Blue" 
          class="btn btn-sm palette bg-blue d-flex align-items-center justify-content-center">
        </button><button type="button" id="palette-blue-gray" title="Blue Gray" 
          class="btn btn-sm palette bg-blue-gray d-flex align-items-center justify-content-center">
        </button><button type="button" id="palette-brown" title="Brown" 
          class="btn btn-sm palette bg-brown d-flex align-items-center justify-content-center">
        </button><button type="button" id="palette-cyan" title="Cyan" 
          class="btn btn-sm palette bg-cyan d-flex align-items-center justify-content-center">
        </button><button type="button" id="palette-green" title="Green" 
          class="btn btn-sm palette bg-green d-flex align-items-center justify-content-center">
        </button><button type="button" id="palette-indigo" title="Indigo" 
          class="btn btn-sm palette bg-indigo d-flex align-items-center justify-content-center">
        </button><button type="button" id="palette-orange" title="Orange" 
          class="btn btn-sm palette bg-orange d-flex align-items-center justify-content-center">
        </button><button type="button" id="palette-pink" title="Pink" 
          class="btn btn-sm palette bg-pink d-flex align-items-center justify-content-center">
        </button><button type="button" id="palette-purple" title="Purple" 
          class="btn btn-sm palette bg-purple d-flex align-items-center justify-content-center">
        </button><button type="button" id="palette-red" title="Red" 
          class="btn btn-sm palette bg-red d-flex align-items-center justify-content-center">
        </button><button type="button" id="palette-teal" title="Teal" 
          class="btn btn-sm palette bg-teal d-flex align-items-center justify-content-center">
        </button><button type="button" id="palette-yellow" title="Yellow" 
          class="btn btn-sm palette bg-yellow d-flex align-items-center justify-content-center">
        </button></button>
    </div>
  </div>
</section></div>
</div></ul>
    </div>
  </div>
</nav>
</header>
<main role="main" class="container">
      <div class="row content">
<div class="col-lg-8">
  <div class="container"><nav class="row" aria-label="breadcrumb">
  <ol class="breadcrumb surface"><li class="breadcrumb-item"><a href="https://csmacnzblog.github.io/">Home</a></li><li class="breadcrumb-item"><a href="https://csmacnzblog.github.io/post/">Posts</a></li><li class="breadcrumb-item active">Treat Warnings As Errors with this one weird PowerShell Script...</li></ol>
</nav><article class="post row surface"><div class="post-toolbox">
  <div class="col-12 d-none d-lg-block">
    <a id="sidebarToggler" class="fas fa-fw fa-2x fa-expand-alt" role="button"></a>
  </div>
</div>
<h1 class="post-title my-3">Treat Warnings As Errors with this one weird PowerShell Script...</h1><div class="post-meta mb-3">
  <span class="post-date me-2">
    <i class="fas fa-fw fa-calendar-alt"></i>May 9, 2016
  </span>
  <span class="post-reading-time me-2">
    <i class="fas fa-fw fa-coffee"></i>4 min read
  </span>
<a href="https://csmacnzblog.github.io/categories/visual-studio/" class="post-taxonomy">#Visual Studio</a><a href="https://csmacnzblog.github.io/categories/powershell/" class="post-taxonomy">#PowerShell</a><a href="https://csmacnzblog.github.io/tags/visual-studio/" class="post-taxonomy">#Visual Studio</a><a href="https://csmacnzblog.github.io/tags/powershell/" class="post-taxonomy">#PowerShell</a></div>
<a id="btnTOC" class="fas fa-fw fa-2x fa-list-alt position-fixed" data-bs-toggle="offcanvas" href="#offcanvasTOC" aria-controls="offcanvasTOC" role="button">
</a>

<div class="offcanvas offcanvas-end surface" tabindex="-1" id="offcanvasTOC" aria-labelledby="offcanvasTOCLabel">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title" id="offcanvasTOCLabel">Table Of Contents</h5>
    <a role="button" data-bs-dismiss="offcanvas" aria-label="Close">
      <span class="fas fa-2x fa-fw fa-times"></span>
    </a>
  </div>
  <div class="offcanvas-body">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#treat-warnings-as-errors">Treat Warnings As Errors</a></li>
        <li><a href="#-one-weird-trick">&hellip; One weird trick</a></li>
        <li><a href="#caveats">Caveats</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div><div class="post-content mb-3"><p>There is this great feature in Visual Studio that lets you really dial up the quality of your code. It has been there forever it seems, but very few people use it.</p>
<p>The compiler spits out errors, which stop your app compiling. You fix your errors and move on.  But the compiler also spits out a lot of warnings too. And many of these are to do with the quality of your code, and possible code errors you have introduced that could cause you issues later on.</p>
<p>Did you know you can get the builds to actually fail to compile from these warnings?</p>
<h3 id="treat-warnings-as-errors">Treat Warnings As Errors</h3>
<p>If you head to the properties dialog of a project, you will see the following under the Build menu.</p>
<p><img class="img-fluid" src="http://res.cloudinary.com/csmacnz/image/upload/v1462825696/TreatWarningsAsErrors_vzev9g.png" alt="Visual Studio Build Config Settings"  loading="lazy" />
</p>
<p>See that radio button? Treat warnings as errors. You wanna set that baby to All. Do it now! While you are in here, set the Warning level to 4 as well.</p>
<p>That&rsquo;s it! You are all set to start failing your builds, for this project anyway. In fact, go ahead and try to build. There is a better than normal chance that you probably already have some warnings and now have a failing build. Well done.</p>
<p>Actually, you probably only turned that on for Debug builds, so go repeat those steps after changing the Configuration dropdown to Release. And any others you have where this applies.</p>
<p>The nice thing about <code>TreatWarningsAsErrors</code> is that it is in the *.csproj file XML, and is actually an MSBuild command.  This means that it will use the same settings when you build at command line using either devenv or MSBuild tools.  So your CI server will apply this too.</p>
<p>As well as the <code>TreatWarningsAsErrors</code> command, there is this <code>WarningLevel</code>. Just turn it up to <code>4</code> and move on, it is the option you want, trust me.</p>
<h3 id="-one-weird-trick">&hellip; One weird trick</h3>
<p>So, I mentioned one weird script right?</p>
<p>If you have an existing solution with lots of projects, you won&rsquo;t want to turn these all on one by one manually. You also don&rsquo;t want to fuss around making sure that if you or someone else has added a bunch of new projects, that these rules are turned on correctly.</p>
<p>To solve these issues, I have a PowerShell script that runs over a directory, finds all the *.csproj files, and updates their Debug and Release configurations with <code>TreatWarningsAsErrors</code> set to <code>true</code>, and <code>WarningLevel</code> to `4'.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">get-childitem . -include *.csproj -recurse -ErrorAction SilentlyContinue | %{
    $_.FullName
    <span style="color:#66d9ef">[xml]</span>$proj = get-content $_.FullName
    $modified = 0
    $proj.Project.PropertyGroup | 
    where-object { $_.Condition <span style="color:#f92672">-match</span> <span style="color:#e6db74">&#39;Configuration.*Platform.*(Debug|Release)&#39;</span> } | %{
        <span style="color:#66d9ef">if</span> (<span style="color:#f92672">-not</span> $_.TreatWarningsAsErrors) {
            $node = $proj.CreateElement(<span style="color:#e6db74">&#39;TreatWarningsAsErrors&#39;</span>, $proj.Project.NamespaceURI)
            $node.InnerText = <span style="color:#e6db74">&#39;true&#39;</span>
            $node = $_.AppendChild($node)
            $modified = 1
        }
        <span style="color:#66d9ef">if</span> ($_.TreatWarningsAsErrors <span style="color:#f92672">-ne</span> <span style="color:#e6db74">&#39;true&#39;</span>) {
            $_.TreatWarningsAsErrors = <span style="color:#e6db74">&#39;true&#39;</span>
            $modified = 1
        }
        <span style="color:#66d9ef">if</span> (<span style="color:#f92672">-not</span> $_.WarningLevel) {
            $node = $proj.CreateElement(<span style="color:#e6db74">&#39;WarningLevel&#39;</span>, $proj.Project.NamespaceURI)
            $node.InnerText = <span style="color:#e6db74">&#34;4&#34;</span>
            $node = $_.AppendChild($node)
            $modified = 1
        }
        <span style="color:#66d9ef">if</span> ($_.WarningLevel <span style="color:#f92672">-ne</span> <span style="color:#e6db74">&#34;4&#34;</span>) {
            $_.WarningLevel.InnerText = <span style="color:#e6db74">&#34;4&#34;</span>
            $modified = 1
        }
    }
    <span style="color:#66d9ef">if</span> ($modified <span style="color:#f92672">-eq</span> 1) {
        $proj.Save($_.FullName)
    }
}
</code></pre></div><p>This is also up on <a href="https://gist.github.com/csMACnz/6b736c9109023af4c09f6f0b9405081b" target="_blank">a gist</a>
 if you prefer.</p>
<p>That is it. Run that in your solution directory and you should be sorted.  Don&rsquo;t forget to fix the compiler errors before checking your changes back in though.</p>
<h3 id="caveats">Caveats</h3>
<p>There is always one project that disobeys with the strict rules. That&rsquo;s ok, just leave it off and come back and fix the issues when you have a spare few moments. Perhaps in a quiet Friday afternoon, or the day after ship day while you wait for those bug reports to come in. Once the problem is fixed, run the script again and hey presto it will be turned on again.</p>
<p>There are other ways to filter and ignore specific issues but I will leave that as an exercise for the reader if they really want to go down that path.</p>
</div><hr /><div class="post-navs d-flex mb-3 justify-content-between">
  <div class="post-nav w-50"><div class="prev-post btn btn-sm">
      <a href="https://csmacnzblog.github.io/post/guess-whos-back/">Guess Who&#39;s Back?</a>
    </div></div>
  <div class="post-nav flex-row-reverse"><div class="next-post btn btn-sm">
      <a href="https://csmacnzblog.github.io/post/on-passion-in-it/">On Passion in IT</a>
    </div></div>
</div><section class="related-posts">
    <h3>Related Posts</h3>
    <ul class="related-posts"><li><a href="https://csmacnzblog.github.io/post/make-me-a-sandwich/">Make me a sandwich</a></li><li><a href="https://csmacnzblog.github.io/post/visual-studio-2015-vs-visual-studio-2013/">Visual Studio 2015 vs Visual Studio 2013</a></li><li><a href="https://csmacnzblog.github.io/post/using-c5-with-visual-studio-2015/">Using C# 5.0 with Visual Studio 2015</a></li><li><a href="https://csmacnzblog.github.io/post/code-demoing-with-visual-studio/">Code Demoing with Visual Studio</a></li><li><a href="https://csmacnzblog.github.io/post/aliasing-your-git-status/">Aliasing your &#39;git status&#39;</a></li></ul>
  </section></article><div class="post-comments surface row"></div></div>
</div><aside class="col-lg-4 sidebar d-flex">
  <div class="container"><section class="recent-posts row surface">
  <h4>Recent Posts</h4>
  <ul><li><a href="https://csmacnzblog.github.io/post/terraform-newrelic-provider-facepalm/">Failed to query available provider packages - Terraform NewRelic Provider :facepalm:</a></li><li><a href="https://csmacnzblog.github.io/post/kotlin-teamcity-and-reflection/">Kotlin, TeamCity and reflection</a></li><li><a href="https://csmacnzblog.github.io/post/bluetooth-devices-keep-disconnecting/">Bluetooth Devices keep disconnecting</a></li><li><a href="https://csmacnzblog.github.io/post/nullable-and-notnull-serialisation-properties/">Nullable and notnull Serialisation Properties</a></li><li><a href="https://csmacnzblog.github.io/post/we-are-all-10x/">We are all 10x engineers, but I don&#39;t think it means what you think it means</a></li></ul>
</section><section class="taxonomy-categories row surface">
      <h4>
        <a href="https://csmacnzblog.github.io/categories">Categories</a>
      </h4>
      <div><a href="https://csmacnzblog.github.io/categories/c#/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="c#">
          c# <span class="badge rounded-pill">37</span>
        </a><a href="https://csmacnzblog.github.io/categories/dotnetcore/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="dotnetcore">
          dotnetcore <span class="badge rounded-pill">35</span>
        </a><a href="https://csmacnzblog.github.io/categories/tips-and-tricks/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="Tips and Tricks">
          Tips and Tricks <span class="badge rounded-pill">30</span>
        </a><a href="https://csmacnzblog.github.io/categories/editorial/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="Editorial">
          Editorial <span class="badge rounded-pill">26</span>
        </a><a href="https://csmacnzblog.github.io/categories/continuous-delivery/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="Continuous Delivery">
          Continuous Delivery <span class="badge rounded-pill">13</span>
        </a><a href="https://csmacnzblog.github.io/categories/software-development/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="software development">
          software development <span class="badge rounded-pill">13</span>
        </a><a href="https://csmacnzblog.github.io/categories/projects/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="Projects">
          Projects <span class="badge rounded-pill">12</span>
        </a><a href="https://csmacnzblog.github.io/categories/conference/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="Conference">
          Conference <span class="badge rounded-pill">9</span>
        </a><a href="https://csmacnzblog.github.io/categories/git/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="git">
          git <span class="badge rounded-pill">8</span>
        </a><a href="https://csmacnzblog.github.io/categories/visual-studio/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="Visual Studio">
          Visual Studio <span class="badge rounded-pill">8</span>
        </a></div>
    </section><section class="taxonomy-tags row surface">
      <h4>
        <a href="https://csmacnzblog.github.io/tags">Tags</a>
      </h4>
      <div><a href="https://csmacnzblog.github.io/tags/c#/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="c#">
          c# <span class="badge rounded-pill">37</span>
        </a><a href="https://csmacnzblog.github.io/tags/dotnetcore/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="dotnetcore">
          dotnetcore <span class="badge rounded-pill">35</span>
        </a><a href="https://csmacnzblog.github.io/tags/tips-and-tricks/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="Tips and Tricks">
          Tips and Tricks <span class="badge rounded-pill">30</span>
        </a><a href="https://csmacnzblog.github.io/tags/editorial/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="Editorial">
          Editorial <span class="badge rounded-pill">26</span>
        </a><a href="https://csmacnzblog.github.io/tags/continuous-delivery/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="Continuous Delivery">
          Continuous Delivery <span class="badge rounded-pill">13</span>
        </a><a href="https://csmacnzblog.github.io/tags/software-development/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="software development">
          software development <span class="badge rounded-pill">13</span>
        </a><a href="https://csmacnzblog.github.io/tags/projects/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="Projects">
          Projects <span class="badge rounded-pill">12</span>
        </a><a href="https://csmacnzblog.github.io/tags/conference/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="Conference">
          Conference <span class="badge rounded-pill">9</span>
        </a><a href="https://csmacnzblog.github.io/tags/git/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="git">
          git <span class="badge rounded-pill">8</span>
        </a><a href="https://csmacnzblog.github.io/tags/visual-studio/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="Visual Studio">
          Visual Studio <span class="badge rounded-pill">8</span>
        </a></div>
    </section></div>
</aside>
</div>
    </main><footer class="footer mt-auto py-3 text-center container"><nav class="social-links nav my-2 justify-content-center"></nav>
<div class="copyright mb-2">
  
</div>
<div class="powered-by mb-2">
  Powered by <a href="https://gohugo.io" target="_blank">Hugo</a> and the <a href="https://github.com/razonyang/hugo-theme-bootstrap" target="_blank">Bootstrap</a> theme.
</div></footer>
<a id="btnScrollToTop" class="btn-scroll-to-top">
  <i class="fas fa-fw fa-chevron-circle-up fa-2x"></i>
</a>
</body>
</html>
