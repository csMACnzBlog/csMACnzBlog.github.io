<!DOCTYPE html>
<html lang="en">
    <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name='author' content='Mark Clearwater, csmacnz@csmac.co.nz'>
    <meta name='language' content='EN'>
    <meta name='medium' content='blog'>


    <title>.Net Core SDK 2.* Series - Self-contained Applications - csMACnz&#39;s Blog</title>
    <meta name="description" content="This is a series on the latest 2.* .Net Core bits, Following on from the original .Net Core Series  Getting Started What&rsquo;s in the box Using Multiple Projects Testing NuGet Multi-targeting Publishing Portable …">
    <meta name='keywords' content='csMACnz, dotnetcore'>

    
    <meta property="og:type" content="article"/>
    <meta property="og:title" content=".Net Core SDK 2.* Series - Self-contained Applications"/>
    <meta property="og:description" content="This is a series on the latest 2.* .Net Core bits, Following on from the original .Net Core Series  Getting Started What&rsquo;s in the box Using Multiple Projects Testing NuGet Multi-targeting Publishing Portable …"/>
    <meta property="og:site_name" content="csMACnz&#39;s Blog"/>
    <meta property="og:url" content="https://csmacnzblog.github.io/post/dotnetcore2-self-contained-applications/"/>
    <meta property="og:image" content="http://csmac.nz/Content/icon/icon.png"/>

    
    <meta name="twitter:card" content="summary"/>
    <meta name="twitter:title" content=".Net Core SDK 2.* Series - Self-contained Applications"/>
    <meta name="twitter:description" content="This is a series on the latest 2.* .Net Core bits, Following on from the original .Net Core Series  Getting Started What&rsquo;s in the box Using Multiple Projects Testing NuGet Multi-targeting Publishing Portable …"/>
    <meta name="twitter:image" content="http://csmac.nz/Content/icon/icon.png"/>
    <meta name="twitter:site" content="@csMACnz"/>
    <meta name="twitter:creator" content="@csMACnz"/>


    <link rel="apple-touch-icon-precomposed" href="/images/icon/apple-touch-icon-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/icon/apple-touch-icon-72x72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/icon/apple-touch-icon-114x114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/icon/apple-touch-icon-144x144-precomposed.png">
    <link rel="icon" type="image/png" href="/images/icon/icon.png" />
    <link rel='me' type='text/html' href='https://github.com/csMACnz'>

    <script>
        var d_id  = 'csmacnz',
            g_id  = 'UA-18464866-2',
            g_url = 'auto';
    </script>

    <link rel="stylesheet" type="text/css" href="/css/style.css" />
    <link rel="stylesheet" type="text/css" href="/css/blogstyle.css" />

    <link rel="alternate stylesheet" title="dark-code" type="text/css" href="/css/solarized_dark.css" disabled>
    <link rel="stylesheet" title="light-code" type="text/css" href="/css/github-gist.css" disabled>

    <!-- ENTERING partial seo-schema.html -->
    
    
    <script type="application/ld+json">
    {
        "@context" : "https://schema.org",
        "@type" : "Article",
        "publisher": {
            "@type": "Organization",
            "name": "csMACnz&#x27;s Blog",
            "logo": "https://blog.csmac.nz/content/images/2014/10/apple-touch-icon-144x144-precomposed.png"
        },
        "author": {
            "@type": "Person",
            "name": "Mark Clearwater",
            "image": {
                "@type": "ImageObject",
                "url": "//www.gravatar.com/avatar/c97410951ec3738a3fd4a2dfb17a5d9c?d=404&s=250",
                "width": 440,
                "height": 295
            },
            "url": "https://blog.csmac.nz/author/csmacnz/",
            "sameAs": [
                "http://csmac.nz"
            ]
        },
        "articleSection" : "post",
        "name" : ".Net Core SDK 2.* Series - Self-contained Applications",
        "headline" : ".Net Core SDK 2.* Series - Self-contained Applications",
        "url" : "https:\/\/csmacnzblog.github.io\/post\/dotnetcore2-self-contained-applications\/",
        "datePublished": "2018-03-18T20:18:22.000Z",
        "dateModified" : "2018-03-18T20:18:22.000Z",
        "keywords" : [ "dotnetcore" ]
        "description" : "This is a series on the latest 2.* .Net Core bits, Following on from the original .Net Core Series\n Getting Started What\u0026rsquo;s in the box Using Multiple Projects Testing NuGet Multi-targeting Publishing Portable Applications Self-contained Applications \u0026lt;=(We are here)  (At the time of writing, 2.1.4. I use windows, you don\u0026rsquo;t have to!)\nThe Problem Distributing the fruits of your labour is one of the rewarding parts of building any kind of software.",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https://blog.csmac.nz/"
        }
        "inLanguage" : "en-US",
        "author" : "Mark Clearwater",
        "creator" : "Mark Clearwater",
        "accountablePerson" : "Mark Clearwater",
        "copyrightHolder" : "Mark Clearwater",
        "copyrightYear" : "2018",
        "wordCount" : "2530",
    }
    </script>
    
    
    <!-- LEAVING partial seo-schema.html -->

    <link rel="alternate" type="application/rss+xml" title="csMACnz&#x27;s Blog" href="https://blog.csmac.nz/rss/" />
    <style>
        .post-content img {
            max-width: 500px;
        }
    </style>
    </head>
    <body class="blog">
        <div class="page-area"><header class="header-area">
    <h1 class="header-area-title">csMACnz</h1>
</header>
<nav class="navigation-area header-bar-parent">
    <div class="header-bar header-bar-blog">
        <ul class="menu">
            <li class="menu-item"><a class="menu-item-content" href="http://csmac.nz">Home</a></li>
            <li class="menu-item"><a class="menu-item-content" href="http://csmac.nz/BaconVaders">Bacon Vaders</a></li>
            <li class="menu-item"><a class="menu-item-content CurrentButton" href="/">Blog</a></li>
        </ul>
    </div>
</nav><div id="content" class="content-area">
            
<article>
    <div class="content-box" itemscope itemtype="http://schema.org/Article">
    
        <span class="post-meta"><time datetime="2018-03-18"  itemprop="datePublished">18 Mar 18</time> on
            <a href="https://csmacnzblog.github.iotags/dotnetcore">dotnetcore</a>
        </span>
    
        <h1 class="post-title" itemprop="headline">.Net Core SDK 2.* Series - Self-contained Applications</h1>
    
        <section class="post-content"  itemprop="articleBody">
            <p>This is a series on the latest 2.* .Net Core bits, Following on from the original <a href="https://blog.csmac.nz/dotnetcore-getting-started">.Net Core Series</a></p>
<ul>
<li><a href="/dotnetcore2-getting-started">Getting Started</a></li>
<li><a href="/dotnetcore2-whats-in-the-box">What&rsquo;s in the box</a></li>
<li><a href="/dotnetcore2-using-multiple-projects">Using Multiple Projects</a></li>
<li><a href="/dotnetcore2-testing">Testing</a></li>
<li><a href="/dotnetcore2-nuget">NuGet</a></li>
<li><a href="/dotnetcore2-multi-targeting">Multi-targeting</a></li>
<li><a href="/dotnetcore2-publishing-portable-applications">Publishing Portable Applications</a></li>
<li>Self-contained Applications &lt;=(We are here)</li>
</ul>
<p>(At the time of writing, 2.1.4. I use windows, you don&rsquo;t have to!)</p>
<h3 id="the-problem">The Problem</h3>
<p>Distributing the fruits of your labour is one of the rewarding parts of building any kind of software. People actually start to use it!  But distribution is never as easy as it should be. With .Net Core Applications, the story can be a similar one.</p>
<p>Traditionally, distributing a .Net Application means requiring a runtime on the target machine. While .Net isn&rsquo;t the only platform to work this way, It has meant a bit of dependency wrangling on the target machine before you can run your app. Again, by no means is this as terrible an experience, or as painful as other platforms &amp; runtimes can be, but you need to be aware of it.</p>
<p>With <code>netcoreapp*</code> applications this is no different. While using the latest SDK can target multiple runtime versions and platforms (including older versions), and can pull down the right files for building against, you may find that unless you install the correct runtime, you won&rsquo;t be able to run what you build. This is true even with the SDKs for the same major version are installed.</p>
<p>Let&rsquo;s first take a look at how we can install different target runtime versions, then we can see how we can remove the need for this altogether.</p>
<h3 id="installing-multiple-platforms">Installing Multiple Platforms</h3>
<p>One option on your development machine is to install everything.</p>
<p><a href="https://www.microsoft.com/net/download/all">This page</a> has all the download links for all the different versions of .Net Core. You could download all these installers and install all the SDKs and runtimes.</p>
<p>If you do that, you can then run any version of .Net Core applications, and also build using any version of the SDK.  You will have to install them in order from oldest to newest (especially true of the sdks) or some might not install properly. (All I mean is that installing oldest to newest will install everything as intended, but doing so out of order may not produce the desired result.)</p>
<p>But who has time for that? Automation anyone?</p>
<p>There are a set of <a href="https://docs.microsoft.com/en-us/dotnet/core/tools/dotnet-install-script">dotnet-install scripts</a>, both in Bash and PowerShell formats, that allow you to script the installation of dotnet runtimes. By default, these scripts will install the latest version into your user profile, but there are a tonne of options you can choose from.</p>
<p>There are a couple of ways to run the script, either download and execute as one command, or save the file, then execute it. (Shown below in PowerShell command format.)</p>
<pre><code class="language-ps"># Download and Execute the script in one command
&quot;&amp;([scriptblock]::Create((Invoke-WebRequest -useb 'https://dot.net/v1/dotnet-install.ps1'))) -DryRun&quot;

#Alternatively save the script, then execute it
Invoke-WebRequest -useb 'https://dot.net/v1/dotnet-install.ps1' -OutFile &quot;dotn
et-install.ps1&quot;
.\dotnet-install.ps1 -DryRun
</code></pre>
<p>(I&rsquo;ve used <code>-DryRun</code> argument to test the script parameters, before actually making changes.)</p>
<p>Let&rsquo;s see how to use the script in two ways: First to install the equivalent of the way the installers would onto your machine. (You will need an Administrator Prompt for this.)</p>
<pre><code># This assumes your ${Env:ProgramFiles(x86)} is set to &quot;C:\Program Files (x86)&quot;
# Your default Program Files directory might be different otherwise.

.\dotnet-install.ps1 -Version 2.1.4 -InstallDir &quot;C:\Program Files (x86)\dotnet&quot;

# You can do this for other SDK versions
.\dotnet-install.ps1 -Version 2.0.3 -InstallDir &quot;C:\Program Files (x86)\dotnet&quot;
.\dotnet-install.ps1 -Version 1.1.7 -InstallDir &quot;C:\Program Files (x86)\dotnet&quot;
.\dotnet-install.ps1 -Version 1.1.5 -InstallDir &quot;C:\Program Files (x86)\dotnet&quot;
.\dotnet-install.ps1 -Version 1.0.4 -InstallDir &quot;C:\Program Files (x86)\dotnet&quot;

# And for other runtimes
.\dotnet-install.ps1 -Version 2.0.5 -InstallDir &quot;C:\Program Files (x86)\dotnet&quot; -SharedRuntime
.\dotnet-install.ps1 -Version 2.0.3 -InstallDir &quot;C:\Program Files (x86)\dotnet&quot; -SharedRuntime
.\dotnet-install.ps1 -Version 2.0.0 -InstallDir &quot;C:\Program Files (x86)\dotnet&quot; -SharedRuntime
.\dotnet-install.ps1 -Version 1.1.6 -InstallDir &quot;C:\Program Files (x86)\dotnet&quot; -SharedRuntime
.\dotnet-install.ps1 -Version 1.1.5 -InstallDir &quot;C:\Program Files (x86)\dotnet&quot; -SharedRuntime
.\dotnet-install.ps1 -Version 1.0.9 -InstallDir &quot;C:\Program Files (x86)\dotnet&quot; -SharedRuntime
.\dotnet-install.ps1 -Version 1.0.8 -InstallDir &quot;C:\Program Files (x86)\dotnet&quot; -SharedRuntime

</code></pre>
<p>If you haven&rsquo;t already run an installer for any versions of dotnet SDK, you will probably have to manually add <code>C:\Program Files (x86)\dotnet</code> to your PATH Environment Variable. By default it will be made immediately available for the current console window session.</p>
<p>Next let&rsquo;s look at doing the same thing into a stand-alone folder on your machine instead.</p>
<pre><code># Install the latest/current stable SDK first
.\dotnet-install.ps1 -Channel Current -InstallDir C:\dotnet-cli

# Now other required SDKs
.\dotnet-install.ps1 -Version 2.1.4 -InstallDir C:\dotnet-cli # Should be the same as Current at the time of writing
.\dotnet-install.ps1 -Version 2.0.3 -InstallDir C:\dotnet-cli
.\dotnet-install.ps1 -Version 1.1.7 -InstallDir C:\dotnet-cli
.\dotnet-install.ps1 -Version 1.1.5 -InstallDir C:\dotnet-cli
.\dotnet-install.ps1 -Version 1.0.4 -InstallDir C:\dotnet-cli
.\dotnet-install.ps1 -Version 1.0.1 -InstallDir C:\dotnet-cli

# Now all the required runtimes
.\dotnet-install.ps1 -Version 2.0.5 -InstallDir C:\dotnet-cli -SharedRuntime
.\dotnet-install.ps1 -Version 2.0.3 -InstallDir C:\dotnet-cli -SharedRuntime
.\dotnet-install.ps1 -Version 2.0.0 -InstallDir C:\dotnet-cli -SharedRuntime
.\dotnet-install.ps1 -Version 1.1.6 -InstallDir C:\dotnet-cli -SharedRuntime
.\dotnet-install.ps1 -Version 1.1.5 -InstallDir C:\dotnet-cli -SharedRuntime
.\dotnet-install.ps1 -Version 1.1.2 -InstallDir C:\dotnet-cli -SharedRuntime
.\dotnet-install.ps1 -Version 1.1.1 -InstallDir C:\dotnet-cli -SharedRuntime
.\dotnet-install.ps1 -Version 1.1.0 -InstallDir C:\dotnet-cli -SharedRuntime
.\dotnet-install.ps1 -Version 1.0.9 -InstallDir C:\dotnet-cli -SharedRuntime
.\dotnet-install.ps1 -Version 1.0.8 -InstallDir C:\dotnet-cli -SharedRuntime
.\dotnet-install.ps1 -Version 1.0.4 -InstallDir C:\dotnet-cli -SharedRuntime
.\dotnet-install.ps1 -Version 1.0.3 -InstallDir C:\dotnet-cli -SharedRuntime

</code></pre>
<p>As mentioned before, for the current session you will find the newly installed <code>dotnet.exe</code> set in your path pointing at the new folders, but You will also need to manually put this into your PATH Environment variable to make this version always available as the default <code>dotnet</code> command.</p>
<h3 id="but-why-a-runtime">But why a Runtime?</h3>
<p>Why do we need to install the target runtime? Well, mainly it is because we want to keep our application distribution small. We do this by leaving out a bunch of common framework executable code, that we entrust to a runtime distribution to deliver to the target machine for us.  This runtime can be shared across applications and so they will all get the benefit of being smaller.</p>
<p>But what if we don&rsquo;t want to share? Traditionally this hasn&rsquo;t been much of an option. For certain <code>dll</code> files, we can distribute them with our app to ensure the correct one is chosen, rather than relying on the system to find them for us. But this isn&rsquo;t generally true for all parts of the framework, especially more crucial low-level system details. (And sometimes the installed framework will override us anyway - &ldquo;GAC DLL hell&rdquo; or &ldquo;dee el hell&rdquo; is what we called it.)</p>
<h3 id="look-mum-no-runtime">Look Mum, No Runtime!</h3>
<p>But .Net Core&hellip;</p>
<p>Yes, now with .Net Core, there is a way to bundle the entire (yes all!) specific (exact version!) runtime with your application.</p>
<p>This has two main benefits:</p>
<ul>
<li>We do not require anything* to be pre-installed on the target machine.</li>
<li>We can ensure exactly the right set of libraries and code is running with our application, down to the framework bugs at the time of packaging.</li>
</ul>
<p>Just so this doesn&rsquo;t sound too Silver-Bullet-y, a few quick drawbacks, too:</p>
<ul>
<li>Your distributable won&rsquo;t be small anymore. (~60mb to start, just for the runtime)</li>
<li>You will be distributing against a specific platform (Operating System), and may need multiple packages, one per Operating System target.</li>
</ul>
<p>It is up to you to decide the trade-offs that make the most sense for your application.</p>
<h3 id="show-me-the-code">Show me the Code!</h3>
<pre><code>mkdir MySelfContainedApp
cd MySelfContainedApp
mkdir MyApp
cd MyApp
dotnet new console
cd ../
dotnet new sln
dotnet sln add .\MyApp\MyApp.csproj
dotnet build
</code></pre>
<p>Once we have an app to use, this is how we package it with its own runtime:</p>
<pre><code>dotnet publish --self-contained --runtime win7-x64
</code></pre>
<p>(Not using Windows? Other runtime values include <code>osx.10.12-x64</code> and <code>ubuntu.16.04-x64</code>. A full list and description of them all can be found in the <a href="https://docs.microsoft.com/en-nz/dotnet/core/rid-catalog">rid catalog</a>)</p>
<p>The runtime identifier <code>win7-x64</code> means we will package with a runtime compatible with the Windows 7(&amp; Windows Server 2008 R2) Operating System, 64-bit Architecture. This means that it will run on those Operating Systems, and should be forward-compatible to newer systems (compatibility). (It also means there may be performance optimisations from newer systems like <code>Win8</code> and <code>Win10</code> that won&rsquo;t be taken advantage of when it runs in Compatability mode on the newer OS versions.)  It also states that it requires a 64-bit Architecture. no 32-bit Architecture machines will be able to run the application. (You may recall building apps in the past that could target <code>AnyCPU</code>. This isn&rsquo;t it.)</p>
<p>In general, you can identify Operating System, OS Version, and architecture from the parts of an rid. This is representative, and should not be relied on as a composition of any OS/Version/Arch into an rid. Use the reference guide to ensure you are using valid identifiers.</p>
<p>As well as specific runtimes, SDK 2.0 introduces Portable rids. <code>Win-x64</code>, <code>linux-x64</code> and <code>osx-x64</code> give you version-agnostic Operating System Targets. (Most useful for Linux, since it is across multiple distros - Ubuntu, Tizen, Red Hat, Fedora etc etc.) This doesn&rsquo;t necessarily affect the size, mostly just the compatibility. (Affects Performance/Optimisations? Possibly. Perf test if you want to find out! 😉 )</p>
<p>Let&rsquo;s take a look at the output from our publish command:</p>
<pre><code>MySelfContainedApp
|-- MySelfContainedApp.sln
+---MyApp
    |-- MyApp.csproj
    |-- Program.cs
    +-- bin
        +-- Debug
            +-- netcoreapp2.0
                |-- MyApp.deps.json
                |-- MyApp.dll
                |-- MyApp.pdb
                |-- MyApp.runtimeconfig.dev.json
                |-- MyApp.runtimeconfig.json
                +-- win7-x64
                    |-- hostfxr.dll
                    |-- hostpolicy.dll
                    |-- MyApp.deps.json
                    |-- MyApp.dll
                    |-- MyApp.exe
                    |-- MyApp.pdb
                    |-- MyApp.runtimeconfig.dev.json
                    |-- MyApp.runtimeconfig.json
                    |--
                    +-- publish
                        |-- api-ms-win-core-console-l1-1-0.dll
                        |-- api-ms-win-core-datetime-l1-1-0.dll
                        |-- api-ms-win-core-debug-l1-1-0.dll
                        |-- api-ms-win-core-errorhandling-l1-1-0.dll
                        |-- api-ms-win-core-file-l1-1-0.dll
                        |-- api-ms-win-core-file-l1-2-0.dll
                        |-- api-ms-win-core-file-l2-1-0.dll
                        |-- api-ms-win-core-handle-l1-1-0.dll
                        |-- api-ms-win-core-heap-l1-1-0.dll
                        |-- api-ms-win-core-interlocked-l1-1-0.dll
                        |-- api-ms-win-core-libraryloader-l1-1-0.dll
                        |-- api-ms-win-core-localization-l1-2-0.dll
                        |-- api-ms-win-core-memory-l1-1-0.dll
                        |-- api-ms-win-core-namedpipe-l1-1-0.dll
                        |-- api-ms-win-core-processenvironment-l1-1-0.dll
                        |-- api-ms-win-core-processthreads-l1-1-0.dll
                        |-- api-ms-win-core-processthreads-l1-1-1.dll
                        |-- api-ms-win-core-profile-l1-1-0.dll
                        |-- api-ms-win-core-rtlsupport-l1-1-0.dll
                        |-- api-ms-win-core-string-l1-1-0.dll
                        |-- api-ms-win-core-synch-l1-1-0.dll
                        |-- api-ms-win-core-synch-l1-2-0.dll
                        |-- api-ms-win-core-sysinfo-l1-1-0.dll
                        |-- api-ms-win-core-timezone-l1-1-0.dll
                        |-- api-ms-win-core-util-l1-1-0.dll
                        |-- api-ms-win-crt-conio-l1-1-0.dll
                        |-- api-ms-win-crt-convert-l1-1-0.dll
                        |-- api-ms-win-crt-environment-l1-1-0.dll
                        |-- api-ms-win-crt-filesystem-l1-1-0.dll
                        |-- api-ms-win-crt-heap-l1-1-0.dll
                        |-- api-ms-win-crt-locale-l1-1-0.dll
                        |-- api-ms-win-crt-math-l1-1-0.dll
                        |-- api-ms-win-crt-multibyte-l1-1-0.dll
                        |-- api-ms-win-crt-private-l1-1-0.dll
                        |-- api-ms-win-crt-process-l1-1-0.dll
                        |-- api-ms-win-crt-runtime-l1-1-0.dll
                        |-- api-ms-win-crt-stdio-l1-1-0.dll
                        |-- api-ms-win-crt-string-l1-1-0.dll
                        |-- api-ms-win-crt-time-l1-1-0.dll
                        |-- api-ms-win-crt-utility-l1-1-0.dll
                        |-- clrcompression.dll
                        |-- clretwrc.dll
                        |-- clrjit.dll
                        |-- coreclr.dll
                        |-- dbgshim.dll
                        |-- hostfxr.dll
                        |-- hostpolicy.dll
                        |-- Microsoft.CSharp.dll
                        |-- Microsoft.DiaSymReader.Native.amd64.dll
                        |-- Microsoft.VisualBasic.dll
                        |-- Microsoft.Win32.Primitives.dll
                        |-- Microsoft.Win32.Registry.dll
                        |-- mscordaccore.dll
                        |-- mscordaccore_amd64_amd64_4.6.00001.0.dll
                        |-- mscordbi.dll
                        |-- mscorlib.dll
                        |-- mscorrc.debug.dll
                        |-- mscorrc.dll
                        |-- MyApp.deps.json
                        |-- MyApp.dll
                        |-- MyApp.exe
                        |-- MyApp.pdb
                        |-- MyApp.runtimeconfig.json
                        |-- netstandard.dll
                        |-- sos.dll
                        |-- SOS.NETCore.dll
                        |-- sos_amd64_amd64_4.6.00001.0.dll
                        |-- System.AppContext.dll
                        |-- System.Buffers.dll
                        |-- System.Collections.Concurrent.dll
                        |-- System.Collections.dll
                        |-- System.Collections.Immutable.dll
                        |-- System.Collections.NonGeneric.dll
                        |-- System.Collections.Specialized.dll
                        |-- System.ComponentModel.Annotations.dll
                        |-- System.ComponentModel.Composition.dll
                        |-- System.ComponentModel.DataAnnotations.dll
                        |-- System.ComponentModel.dll
                        |-- System.ComponentModel.EventBasedAsync.dll
                        |-- System.ComponentModel.Primitives.dll
                        |-- System.ComponentModel.TypeConverter.dll
                        |-- System.Configuration.dll
                        |-- System.Console.dll
                        |-- System.Core.dll
                        |-- System.Data.Common.dll
                        |-- System.Data.dll
                        |-- System.Diagnostics.Contracts.dll
                        |-- System.Diagnostics.Debug.dll
                        |-- System.Diagnostics.DiagnosticSource.dll
                        |-- System.Diagnostics.FileVersionInfo.dll
                        |-- System.Diagnostics.Process.dll
                        |-- System.Diagnostics.StackTrace.dll
                        |-- System.Diagnostics.TextWriterTraceListener.dll
                        |-- System.Diagnostics.Tools.dll
                        |-- System.Diagnostics.TraceSource.dll
                        |-- System.Diagnostics.Tracing.dll
                        |-- System.dll
                        |-- System.Drawing.dll
                        |-- System.Drawing.Primitives.dll
                        |-- System.Dynamic.Runtime.dll
                        |-- System.Globalization.Calendars.dll
                        |-- System.Globalization.dll
                        |-- System.Globalization.Extensions.dll
                        |-- System.IO.Compression.dll
                        |-- System.IO.Compression.FileSystem.dll
                        |-- System.IO.Compression.ZipFile.dll
                        |-- System.IO.dll
                        |-- System.IO.FileSystem.AccessControl.dll
                        |-- System.IO.FileSystem.dll
                        |-- System.IO.FileSystem.DriveInfo.dll
                        |-- System.IO.FileSystem.Primitives.dll
                        |-- System.IO.FileSystem.Watcher.dll
                        |-- System.IO.IsolatedStorage.dll
                        |-- System.IO.MemoryMappedFiles.dll
                        |-- System.IO.Pipes.dll
                        |-- System.IO.UnmanagedMemoryStream.dll
                        |-- System.Linq.dll
                        |-- System.Linq.Expressions.dll
                        |-- System.Linq.Parallel.dll
                        |-- System.Linq.Queryable.dll
                        |-- System.Net.dll
                        |-- System.Net.Http.dll
                        |-- System.Net.HttpListener.dll
                        |-- System.Net.Mail.dll
                        |-- System.Net.NameResolution.dll
                        |-- System.Net.NetworkInformation.dll
                        |-- System.Net.Ping.dll
                        |-- System.Net.Primitives.dll
                        |-- System.Net.Requests.dll
                        |-- System.Net.Security.dll
                        |-- System.Net.ServicePoint.dll
                        |-- System.Net.Sockets.dll
                        |-- System.Net.WebClient.dll
                        |-- System.Net.WebHeaderCollection.dll
                        |-- System.Net.WebProxy.dll
                        |-- System.Net.WebSockets.Client.dll
                        |-- System.Net.WebSockets.dll
                        |-- System.Numerics.dll
                        |-- System.Numerics.Vectors.dll
                        |-- System.ObjectModel.dll
                        |-- System.Private.CoreLib.dll
                        |-- System.Private.DataContractSerialization.dll
                        |-- System.Private.Uri.dll
                        |-- System.Private.Xml.dll
                        |-- System.Private.Xml.Linq.dll
                        |-- System.Reflection.DispatchProxy.dll
                        |-- System.Reflection.dll
                        |-- System.Reflection.Emit.dll
                        |-- System.Reflection.Emit.ILGeneration.dll
                        |-- System.Reflection.Emit.Lightweight.dll
                        |-- System.Reflection.Extensions.dll
                        |-- System.Reflection.Metadata.dll
                        |-- System.Reflection.Primitives.dll
                        |-- System.Reflection.TypeExtensions.dll
                        |-- System.Resources.Reader.dll
                        |-- System.Resources.ResourceManager.dll
                        |-- System.Resources.Writer.dll
                        |-- System.Runtime.CompilerServices.VisualC.dll
                        |-- System.Runtime.dll
                        |-- System.Runtime.Extensions.dll
                        |-- System.Runtime.Handles.dll
                        |-- System.Runtime.InteropServices.dll
                        |-- System.Runtime.InteropServices.RuntimeInformation.dll
                        |-- System.Runtime.InteropServices.WindowsRuntime.dll
                        |-- System.Runtime.Loader.dll
                        |-- System.Runtime.Numerics.dll
                        |-- System.Runtime.Serialization.dll
                        |-- System.Runtime.Serialization.Formatters.dll
                        |-- System.Runtime.Serialization.Json.dll
                        |-- System.Runtime.Serialization.Primitives.dll
                        |-- System.Runtime.Serialization.Xml.dll
                        |-- System.Security.AccessControl.dll
                        |-- System.Security.Claims.dll
                        |-- System.Security.Cryptography.Algorithms.dll
                        |-- System.Security.Cryptography.Cng.dll
                        |-- System.Security.Cryptography.Csp.dll
                        |-- System.Security.Cryptography.Encoding.dll
                        |-- System.Security.Cryptography.OpenSsl.dll
                        |-- System.Security.Cryptography.Primitives.dll
                        |-- System.Security.Cryptography.X509Certificates.dll
                        |-- System.Security.dll
                        |-- System.Security.Principal.dll
                        |-- System.Security.Principal.Windows.dll
                        |-- System.Security.SecureString.dll
                        |-- System.ServiceModel.Web.dll
                        |-- System.ServiceProcess.dll
                        |-- System.Text.Encoding.dll
                        |-- System.Text.Encoding.Extensions.dll
                        |-- System.Text.RegularExpressions.dll
                        |-- System.Threading.dll
                        |-- System.Threading.Overlapped.dll
                        |-- System.Threading.Tasks.Dataflow.dll
                        |-- System.Threading.Tasks.dll
                        |-- System.Threading.Tasks.Extensions.dll
                        |-- System.Threading.Tasks.Parallel.dll
                        |-- System.Threading.Thread.dll
                        |-- System.Threading.ThreadPool.dll
                        |-- System.Threading.Timer.dll
                        |-- System.Transactions.dll
                        |-- System.Transactions.Local.dll
                        |-- System.ValueTuple.dll
                        |-- System.Web.dll
                        |-- System.Web.HttpUtility.dll
                        |-- System.Windows.dll
                        |-- System.Xml.dll
                        |-- System.Xml.Linq.dll
                        |-- System.Xml.ReaderWriter.dll
                        |-- System.Xml.Serialization.dll
                        |-- System.Xml.XDocument.dll
                        |-- System.Xml.XmlDocument.dll
                        |-- System.Xml.XmlSerializer.dll
                        |-- System.Xml.XPath.dll
                        |-- System.Xml.XPath.XDocument.dll
                        |-- ucrtbase.dll
                        \-- WindowsBase.dll
</code></pre>
<p>That publish folder is 62.7 MB! Compare that to the size of the files in <code>MySelfContainedApp\MyApp\bin\Debug\netcoreapp2.0</code>, which are only 5.76 KB. Compared to the app, that is a lot of Runtime to carry around. (The application is less than a percent of the total distributable size)</p>
<p>This is a considerable tradeoff and should be considered carefully when making the decision between packing portable or distributing the runtime.</p>
<h3 id="the-cake-is-a-lie">The Cake is a Lie</h3>
<p>I said earlier that one of the benefits of distributing the runtime was <code>We do not require anything* to be pre-installed on the target machine.</code></p>
<p>The * was &ldquo;with a few exceptions&rdquo;.</p>
<p>Windows being Windows, you still actually need one more thing. <a href="https://www.microsoft.com/download/details.aspx?id=52685">Microsoft Visual C++ 2015 Redistributable Update 3</a> is needed for the packaged runtime to work on windows. This gets installed if required by the dotnet installer, but won&rsquo;t be in your self-contained package. (It also isn&rsquo;t installed if you use the <code>dotnet-install.ps1</code> script from earlier, either.) It is likely that something else will require this Redistributable on windows anyway, so this isn&rsquo;t a big deal, really.</p>
<p>You can take a look at <a href="https://docs.microsoft.com/en-nz/dotnet/core/windows-prerequisites">Prerequisites for .NET Core on Windows</a> for more information on this.</p>
<p>Linux doesn&rsquo;t escape unscathed either. Dependency graphs on Linux distros can get a bit overwhelming at the best of times. That is why we have package managers and installers. Due to the variance of distros, I can&rsquo;t tell you what you will or won&rsquo;t need here. First, see <a href="https://docs.microsoft.com/en-nz/dotnet/core/linux-prerequisites">Prerequisites for .NET Core on Linux</a> for more information in general. Then specifically you will want to check out the <a href="https://github.com/dotnet/core/blob/master/Documentation/self-contained-linux-apps.md">Self-contained Linux applications</a> documentation.</p>
<p>For some reason, MacOS is fine? Apart from a minimum version (macOS 10.12 &ldquo;Sierra&rdquo; and later) and something about <a href="https://docs.microsoft.com/en-nz/dotnet/core/macos-prerequisites?tabs=netcore2x#increase-the-maximum-open-file-limit">increasing the open file limit</a>, there isn&rsquo;t much else you need to do. Something to be said for standard software and hardware, I suppose.</p>
<h3 id="wrap-up">Wrap up</h3>
<p>So there you have it. You have the choice available to you. You can package one ~5kb portable application (in reality maybe ~5mb) and distribute it, requiring the correct runtime version to be already installed, or you can package in the correct runtime with you app for an extra ~60mb, and build and package at least 3 times to cover windows, Linux and Mac operating systems. (And still require some dependencies anyway).</p>
<p>IF you are bundling an app(game?) that includes a lot of assets and is already distributing 2GB of software, that extra 60Mb is not a big deal, but in general that ratio is rather large.</p>
<p>Of course, this is more than about size, because we can guarantee the compatibility as well because we will have tested our application with exactly the right runtime version that we distribute with.</p>
<p>The choice is yours.</p>
<p>At some point, I will have to experiment and write about how we might get that size down (there are a few ways I am aware of) so we may still get the best of both worlds.</p>
<h2 id="the-end">The End</h2>
<p>Thank you so much for getting this far. It has been a long journey from <a href="/dotnetcore-getting-started">Getting Started with 1.0</a> almost 2 years ago to get here across these new 8 articles. Thanks for sticking with it. I hope you look forward to more .Net Core blog articles to come. Maybe even a revised 3.* version? (Take your time, MS)</p>
<p>You can find related articles using the <a href="https://blog.csmac.nz/tag/dotnetcore/">dotnetcore tag</a>.</p>
</section>
        
        <section class="share">
            Share: 
            <a class="icon-twitter" href="http://twitter.com/share?text=.Net%20Core%20SDK%202.%2a%20Series%20-%20Self-contained%20Applications&url=https%3a%2f%2fcsmacnzblog.github.io%2fpost%2fdotnetcore2-self-contained-applications%2f"
                onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                <span>Twitter</span>
            </a>
            |
            <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fcsmacnzblog.github.io%2fpost%2fdotnetcore2-self-contained-applications%2f"
                onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                <span>Facebook</span>
            </a>
        </section>
    </div>
    <div class="content-box">
        
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            var disqus_shortname = d_id; 
            var disqus_title = '.Net Core SDK 2.* Series - Self-contained Applications';
            
             
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    
    </div>
</article>

        </div><aside class="sidebar-area">
            <div class="header-bar-parent sidebar-item">
                <div class="header-bar header-bar-twitter">Twitter</div>
                
                <a class="twitter-timeline" style="display: block; text-align: center;" href="https://twitter.com/csmacnz" data-widget-id="523634688984772608">Tweets by @@csmacnz</a>
                <script>!function (d, s, id) { var js, fjs = d.getElementsByTagName(s)[0], p = /^http:/.test(d.location) ? 'http' : 'https'; if (!d.getElementById(id)) { js = d.createElement(s); js.id = id; js.src = p + "://platform.twitter.com/widgets.js"; fjs.parentNode.insertBefore(js, fjs); } }(document, "script", "twitter-wjs");</script>
                
            </div>
            <div class="header-bar-parent sidebar-item">
                <div class="header-bar header-bar-rss">Subscribe</div>
                
                <a class="email-subscribe-link" href="https://feedburner.google.com/fb/a/mailverify?uri=csmacnzBlog&amp;loc=en_US">Subscribe to csMACnz's Blog by Email</a>
                <a href="http://add.my.yahoo.com/rss?url=http://feeds.feedburner.com/csmacnzBlog" title="csMACnz&amp;#039;s Blog"><img src="http://us.i1.yimg.com/us.yimg.com/i/us/my/addtomyyahoo4.gif" alt="" style="border:0"/></a>
                <a href="http://feedly.com/#subscription/feed/http://feeds.feedburner.com/csmacnzBlog" title="csMACnz&amp;#039;s Blog"><img src="http://s3.feedly.com/feedburner/feedly.png" alt="" style="border:0"/></a>
                <a href="http://www.netvibes.com/subscribe.php?url=http://feeds.feedburner.com/csmacnzBlog"><img src="http://www.netvibes.com/img/add2netvibes.gif" width="91" height="17" alt="Add to netvibes" style="border:0" /></a>
                <a href="http://feeds.feedburner.com/csmacnzBlog"><img src="http://feeds.feedburner.com/~fc/csmacnzBlog?bg=fabb45&amp;fg=4B4B4B&amp;anim=1" height="26" width="88" style="border:0" alt="" /></a>
                <br />
                <a href="https://www.patreon.com/csMACnz" target="_blank"><img src="/images/patreon.png" /></a>
                
                
            </div>
            <div class="header-bar-parent sidebar-item">
                <div class="header-bar header-bar-xbox">Gamercard</div>
                

                <div style="margin: 0 auto; width:201px;">
                    <iframe src="//gamercard.xbox.com/csMACnz.card" scrolling="no" frameborder="0" height="136px" width="201px">AutomatonMan</iframe>
                </div>
                <a href="http://steamcommunity.com/id/csMACnz/" target="_blank"><img src="http://steamsignature.com/status/english/76561197994712512.png" alt="" title="csMACnz's Steam Profile" /></a>
                
            </div>
            <div class="header-bar-parent sidebar-item">
                <div class="header-bar header-bar-ads">Advertisement</div>
                
                <div>
                    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
                    
                    <ins class="adsbygoogle"
                         style="display:block"
                         data-ad-client="ca-pub-4517187877737982"
                         data-ad-slot="7632444699"
                         data-ad-format="auto"></ins>
                    <script>
                    (adsbygoogle = window.adsbygoogle || []).push({});
                    </script>
                </div>
                
            </div>
        </aside>
        
        <footer class="footer-area"><p>
    Designed and Maintained by Mark Clearwater; Last updated June 2015.
    <br /><a class="footer-link" >Hi</a>
</p></footer>
    </div>
    
    
    <script src="/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    
    <script src="/js/codetoggle.js"></script> 

    
    <script>
        var _gaq = [['_setAccount', g_id], ['_trackPageview']];
        (function (d, t) {
            var g = d.createElement(t), s = d.getElementsByTagName(t)[0];
            g.src = ('https:' == location.protocol ? '//ssl' : '//www') + '.google-analytics.com/ga.js';
            s.parentNode.insertBefore(g, s);
        }(document, 'script'));
    </script>

    <script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
    </body>
</html>
