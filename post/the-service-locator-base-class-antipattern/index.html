<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>The Service Locator base class anti-pattern - csMacnz&#39;s Blog</title><link rel="apple-touch-icon" href="https://csmacnzblog.github.io/images/favicons/apple-touch-icon.png" sizes="180x180">
<link rel="icon" href="https://csmacnzblog.github.io/images/favicons/favicon-32x32.png" sizes="32x32" type="image/png">
<link rel="icon" href="https://csmacnzblog.github.io/images/favicons/favicon-16x16.png" sizes="16x16" type="image/png">
<link rel="manifest" href="https://csmacnzblog.github.io/images/favicons/manifest.json">
<link rel="icon" href="https://csmacnzblog.github.io/images/favicons/favicon.ico">
<meta name="keywords" content="" />
<meta name="description" content="" /><meta itemprop="name" content="The Service Locator base class anti-pattern">
<meta itemprop="description" content="Something I have seen a lot of over the last few years is a lot of service location, particularly in base classes, particularly in Controllers. But not limited to there, it can happen anywhere we see base classes.
Short rant about inheritance The longer I do this, the more I find that base classes are not meant to be overused. I find that if we are pumping base classes full of code, we should probably be breaking them out into smaller classes, and including them in the derived versions that actually use that functionality."><meta itemprop="datePublished" content="2015-07-05T18:04:40+00:00" />
<meta itemprop="dateModified" content="2015-07-05T18:04:40+00:00" />
<meta itemprop="wordCount" content="2196">
<meta itemprop="keywords" content="Tips and Tricks,Patterns," /><meta property="og:title" content="The Service Locator base class anti-pattern" />
<meta property="og:description" content="Something I have seen a lot of over the last few years is a lot of service location, particularly in base classes, particularly in Controllers. But not limited to there, it can happen anywhere we see base classes.
Short rant about inheritance The longer I do this, the more I find that base classes are not meant to be overused. I find that if we are pumping base classes full of code, we should probably be breaking them out into smaller classes, and including them in the derived versions that actually use that functionality." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://csmacnzblog.github.io/post/the-service-locator-base-class-antipattern/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2015-07-05T18:04:40+00:00" />
<meta property="article:modified_time" content="2015-07-05T18:04:40+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="The Service Locator base class anti-pattern"/>
<meta name="twitter:description" content="Something I have seen a lot of over the last few years is a lot of service location, particularly in base classes, particularly in Controllers. But not limited to there, it can happen anywhere we see base classes.
Short rant about inheritance The longer I do this, the more I find that base classes are not meant to be overused. I find that if we are pumping base classes full of code, we should probably be breaking them out into smaller classes, and including them in the derived versions that actually use that functionality."/>
<link rel=stylesheet href="https://csmacnzblog.github.io/css/bundle.min.ce383e7297312216c2d2ced30574d5a9ae83c451db9f064a454509955ae2462d.css" integrity="sha256-zjg&#43;cpcxIhbC0s7TBXTVqa6DxFHbnwZKRUUJlVriRi0=" crossorigin="anonymous"><script src="https://csmacnzblog.github.io/js/bundle.min.ad6d83537f5b4374c837a12a76422496582e04d1dde91bbb443641ec12c506c6.js" integrity="sha256-rW2DU39bQ3TIN6EqdkIkllguBNHd6Ru7RDZB7BLFBsY=" crossorigin="anonymous"></script>
</head><body><header><nav class="navbar navbar-expand-xl fixed-top">
  <div class="container">
    <a class="navbar-brand" href="https://csmacnzblog.github.io">
      <img class="logo" alt="Logo" src="https://csmacnzblog.github.io/images/logo.webp" loading="lazy"></a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav me-1 mb-2 mb-lg-0"><form class="search-bar d-flex ms-1" action="https://csmacnzblog.github.io/search">
  <div class="input-group input-group-sm">
    <button class="btn btn-search disabled position-absolute left-0" type="submit"><i class="fas fa-fw fa-search"></i></button>
    <input class="form-control rounded-pill" id="searchQuery" name="q" type="search" aria-label="Search">
  </div>
</form></ul><ul class="navbar-nav me-1 mb-2 mb-lg-0 me-1 ms-auto"><li class="nav-item">
  <a class="nav-link" data-bs-toggle="offcanvas" href="#offcanvasSettings" role="button"
    aria-controls="offcanvasSettings">
    <i class="fas fa-fw fa-sliders-h"></i> Settings
  </a>
</li>

<div class="offcanvas offcanvas-end surface h-100" tabindex="-1" id="offcanvasSettings"
  aria-labelledby="offcanvasSettingsLabel">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title" w id="offcanvasSettingsLabel"><i class="fas fa-fw fa-sliders-h"></i> Settings</h5>
    <a role="button" data-bs-dismiss="offcanvas" aria-label="Close">
      <span class="fas fa-2x fa-fw fa-times"></span>
    </a>
  </div>
  <div class="offcanvas-body"><section class="setting">
  <form class="row">
    <div class="col-auto">
      <label><i class="fas fa-fw fa-adjust"></i> Mode</label>
    </div>
    <div class="col-auto ms-auto">
      <div class="form-check form-switch">
        <input class="form-check-input" type="checkbox" id="modeSwitcher">
      </div>
    </div>
  </form>
</section>
<section class="setting palettes">
  <form class="row">
    <div class="col-auto">
      <label><i class="fas fa-fw fa-palette"></i> Palette</label>
    </div>
    <div class="col-auto ms-auto">
      <span id="btnPalette" class="btn btn-sm"><i class="fas fa-eye-dropper"></i></span>
    </div>
  </form>
  <div class="container mt-2 visually-hidden" id="palettePicker">
    <div class="btn-group"><button type="button" id="palette-blue" title="Blue" 
          class="btn btn-sm palette bg-blue d-flex align-items-center justify-content-center">
        </button><button type="button" id="palette-blue-gray" title="Blue Gray" 
          class="btn btn-sm palette bg-blue-gray d-flex align-items-center justify-content-center">
        </button><button type="button" id="palette-brown" title="Brown" 
          class="btn btn-sm palette bg-brown d-flex align-items-center justify-content-center">
        </button><button type="button" id="palette-cyan" title="Cyan" 
          class="btn btn-sm palette bg-cyan d-flex align-items-center justify-content-center">
        </button><button type="button" id="palette-green" title="Green" 
          class="btn btn-sm palette bg-green d-flex align-items-center justify-content-center">
        </button><button type="button" id="palette-indigo" title="Indigo" 
          class="btn btn-sm palette bg-indigo d-flex align-items-center justify-content-center">
        </button><button type="button" id="palette-orange" title="Orange" 
          class="btn btn-sm palette bg-orange d-flex align-items-center justify-content-center">
        </button><button type="button" id="palette-pink" title="Pink" 
          class="btn btn-sm palette bg-pink d-flex align-items-center justify-content-center">
        </button><button type="button" id="palette-purple" title="Purple" 
          class="btn btn-sm palette bg-purple d-flex align-items-center justify-content-center">
        </button><button type="button" id="palette-red" title="Red" 
          class="btn btn-sm palette bg-red d-flex align-items-center justify-content-center">
        </button><button type="button" id="palette-teal" title="Teal" 
          class="btn btn-sm palette bg-teal d-flex align-items-center justify-content-center">
        </button><button type="button" id="palette-yellow" title="Yellow" 
          class="btn btn-sm palette bg-yellow d-flex align-items-center justify-content-center">
        </button></button>
    </div>
  </div>
</section></div>
</div></ul>
    </div>
  </div>
</nav>
</header>
<main role="main" class="container">
      <div class="row content">
<div class="col-lg-8">
  <div class="container"><nav class="row" aria-label="breadcrumb">
  <ol class="breadcrumb surface"><li class="breadcrumb-item"><a href="https://csmacnzblog.github.io/">Home</a></li><li class="breadcrumb-item"><a href="https://csmacnzblog.github.io/post/">Posts</a></li><li class="breadcrumb-item active">The Service Locator base class anti-pattern</li></ol>
</nav><article class="post row surface"><div class="post-toolbox">
  <div class="col-12 d-none d-lg-block">
    <a id="sidebarToggler" class="fas fa-fw fa-2x fa-expand-alt" role="button"></a>
  </div>
</div>
<h1 class="post-title my-3">The Service Locator base class anti-pattern</h1><div class="post-meta mb-3">
  <span class="post-date me-2">
    <i class="fas fa-fw fa-calendar-alt"></i>Jul 5, 2015
  </span>
  <span class="post-reading-time me-2">
    <i class="fas fa-fw fa-coffee"></i>11 min read
  </span>
<a href="https://csmacnzblog.github.io/categories/tips-and-tricks/" class="post-taxonomy">#Tips and Tricks</a><a href="https://csmacnzblog.github.io/categories/patterns/" class="post-taxonomy">#Patterns</a><a href="https://csmacnzblog.github.io/tags/tips-and-tricks/" class="post-taxonomy">#Tips and Tricks</a><a href="https://csmacnzblog.github.io/tags/patterns/" class="post-taxonomy">#Patterns</a></div>
<a id="btnTOC" class="fas fa-fw fa-2x fa-list-alt position-fixed" data-bs-toggle="offcanvas" href="#offcanvasTOC" aria-controls="offcanvasTOC" role="button">
</a>

<div class="offcanvas offcanvas-end surface" tabindex="-1" id="offcanvasTOC" aria-labelledby="offcanvasTOCLabel">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title" id="offcanvasTOCLabel">Table Of Contents</h5>
    <a role="button" data-bs-dismiss="offcanvas" aria-label="Close">
      <span class="fas fa-2x fa-fw fa-times"></span>
    </a>
  </div>
  <div class="offcanvas-body">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#short-rant-about-inheritance">Short rant about inheritance</a></li>
    <li><a href="#short-rant-about-service-location">Short rant about service location</a></li>
    <li><a href="#the-antipattern">The antipattern</a>
      <ul>
        <li><a href="#incorrect-solution-1">(Incorrect) Solution 1</a></li>
        <li><a href="#the-way-things-should-have-been">The way things should have been</a></li>
      </ul>
    </li>
    <li><a href="#reality">Reality</a></li>
    <li><a href="#advanced-topics">Advanced Topics</a>
      <ul>
        <li><a href="#parting-words">Parting words</a></li>
      </ul>
    </li>
    <li><a href="#update">Update</a></li>
  </ul>
</nav>
  </div>
</div><div class="post-content mb-3"><p>Something I have seen a lot of over the last few years is a lot of service location, particularly in base classes, particularly in Controllers. But not limited to there, it can happen anywhere we see base classes.</p>
<h2 id="short-rant-about-inheritance">Short rant about inheritance</h2>
<p>The longer I do this, the more I find that base classes are not meant to be overused. I find that if we are pumping base classes full of code, we should probably be breaking them out into smaller classes, and including them in the derived versions that actually use that functionality. If it is a cross-cutting concern, probably using attributes would be a cleaner solution.  Composition over Inheritance makes testing much simpler IMHO.</p>
<h2 id="short-rant-about-service-location">Short rant about service location</h2>
<p>Containers have no place in Unit Tests. Let me clarify. The application&rsquo;s IOC container has no place in the unit tests. (AutoFixture can be a helpful tool, but is also a smell). The fact that you use a service locator couples your code to <em>that</em> service locator, and now it is required in your tests to get things to run. Using a service locator hides from you, the consumer of that object, the dependencies that your object requires. If these are hidden in a base class or extension method, you have no way to discover that the dependency is there until your tests (or worst case, your application) comes crashing down around you.</p>
<p><strong>&lt;<em>/Rant</em>&gt;</strong></p>
<h2 id="the-antipattern">The antipattern</h2>
<p>So the antipattern goes like this: We have N classes, with N types of functionality. They derive from a base class, which contains many services that are used across all N derived classes. These services are <strong>Service Located</strong>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cs" data-lang="cs"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BaseController</span> : Controller
{
    <span style="color:#66d9ef">public</span> ICustomerService CustomerService
    {
        <span style="color:#66d9ef">get</span>
        {
            <span style="color:#66d9ef">return</span> Service.Locate&lt;ICustomerService&gt;();
        }
    }
    
    <span style="color:#66d9ef">public</span> IOrderService OrderService
    {
        <span style="color:#66d9ef">get</span>
        {
            <span style="color:#66d9ef">return</span> Service.Locate&lt;IOrderService&gt;();
        }
    }
}

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">OrderController</span> : BaseController 
{
    <span style="color:#66d9ef">public</span> Order Get(<span style="color:#66d9ef">int</span> orderId)
    {
        <span style="color:#66d9ef">return</span> OrderService.GetOrderById(orderId);
    }
}

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CustomerController</span> : BaseController 
{
    <span style="color:#66d9ef">public</span> Customer Get(<span style="color:#66d9ef">int</span> customerId)
    {
        <span style="color:#66d9ef">return</span> CustomerService.GetOrderById(orderId);
    }
}

</code></pre></div><p>This is a representative sample of services and controllers. You can imagine that the real number of services in the base class could be anywhere between 5 and 20 services, or more, and that there could be 5 to 20, or more, controllers as well.</p>
<p>Also, I have intentionally used Service.Locate because there are many ways to do this approach. You could use some generic <em>Global Static Method</em> or some container specific <em>Global Static variable</em>. It doesn&rsquo;t matter which, both are just as bad as each other.</p>
<p>So Why is this so bad? Well, when It comes to testing, your Controller now has hidden dependencies. We can no longer tell from the constructor what it requires to be provided to get work done.  But they aren&rsquo;t required right, it is able to resolve them itself?  No, not really.</p>
<p>There is a dependency on the Service Locator class <code>Service</code> that has to be configured just right for the actual dependencies to show up. And what&rsquo;s worse than hidden dependencies? Singleton dependencies that break your ability to run your tests in parallel.  If you try and run two tests against two controller instances (or any other type that shares the singleton dependency) then your test may periodically fail, from a race condition with the other test. It is never fun to have false negatives in your test suite, you lose all trust and won&rsquo;t see a true negative as a real problem.</p>
<h3 id="incorrect-solution-1">(Incorrect) Solution 1</h3>
<p>Ok, so we see the problems, how should we solve them? Let&rsquo;s try fixing the singleton problem with dependency injection through the constructor:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cs" data-lang="cs"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BaseController</span> : Controller
{
    <span style="color:#66d9ef">private</span> ICustomerService <span style="color:#ae81ff">_</span>customerService;
    <span style="color:#66d9ef">public</span> ICustomerService CustomerService
    {
        <span style="color:#66d9ef">get</span>
        {
            <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">_</span>customerService;
        }
    }
    
    <span style="color:#66d9ef">private</span> IOrderService <span style="color:#ae81ff">_</span>orderService;
    <span style="color:#66d9ef">public</span> IOrderService OrderService
    {
        <span style="color:#66d9ef">get</span>
        {
            <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">_</span>orderService;
        }
    }
    
    <span style="color:#66d9ef">protected</span> BaseController(
        ICustomerService customerService,
        IOrderService orderService)
    {
        <span style="color:#ae81ff">_</span>customerService = customerService;
        <span style="color:#ae81ff">_</span>orderService = orderService;
    }
}

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">OrderController</span> : BaseController 
{
    <span style="color:#66d9ef">public</span> OrderController(
        ICustomerService customerService,
        IOrderService orderService)
        : <span style="color:#66d9ef">base</span>(customerService, orderService)
    {
    }
    
    <span style="color:#66d9ef">public</span> Order Get(<span style="color:#66d9ef">int</span> orderId)
    {
        <span style="color:#66d9ef">return</span> OrderService.GetOrderById(orderId);
    }
}

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CustomerController</span> : BaseController 
{
    <span style="color:#66d9ef">public</span> CustomerController(
        ICustomerService customerService,
        IOrderService orderService)
        : <span style="color:#66d9ef">base</span>(customerService, orderService)
    {
    }
    
    <span style="color:#66d9ef">public</span> Customer Get(<span style="color:#66d9ef">int</span> customerId)
    {
        <span style="color:#66d9ef">return</span> CustomerService.GetOrderById(orderId);
    }
}
</code></pre></div><p>By my rough estimate, we doubled the code, but we did expose our dependencies through the constructor right? Again, not really.</p>
<p>If we take a closer look, we have a dependency on the BaseController for the <code>IOrderService</code>, but we never actually use it on the derived CustomerController. With more and more services loaded up on the base class, the worse this gets. The more likely we are that more of the dependencies the base class requires are not used by any particular controller.</p>
<p>If you are using a DI Container, you won&rsquo;t feel the pain of creating one of these either, but the pain is still there. This is one of my Pet Peeves with Containers, they hide a lot of the pain from bad usages that only get worse over time, instead of annoying you enough to fix the problem fast.</p>
<p>And what if we need to add a new dependency?  Well, if we add it to the base class, we have to add it to all (5, or maybe 20) Controllers' constructors so that it will compile.  You might not see this as an issue, you just add it to the one that uses the dependency right? Not so. The base class has become a gravity well, all services go there, whether needed by all, or not. It&rsquo;s only logical that the next person along will put their new service there as well.  If there is code in the base class, it may be the only place to add it to surface the functionality to that code.</p>
<p>This brings me to the next reason base class dependencies are bad.  Not every derived class will use it. So why do they all have it available at all, in the first instance, and have a dependency in their constructor for it in the second instance, if it is not actually a dependency?</p>
<p>This leads into a huge con for this approach over the previous one: <a href="http://stackoverflow.com/questions/1299374/what-is-eager-loading" target="_blank">Over-eager loading</a>
.  At least with the service locator, the instance and all of its dependencies are only loaded when you ask for the service.  With this approach, all dependencies are loaded before they are injected in, which could add a large amount of overhead to creating your controller. And like we said, not every instance is actually even used in this controller at all!  No, don&rsquo;t do this approach if you can help it. (by that I usually mean as a stop-gap solution to a larger refactoring effort. See <a href="#reality">Reality</a>
.)</p>
<h3 id="the-way-things-should-have-been">The way things should have been</h3>
<p>Let&rsquo;s try to implement this solution again, with all of this in mind.  We want our classes to only take dependencies on what they actually use:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cs" data-lang="cs"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">OrderController</span> : Controller 
{
    <span style="color:#66d9ef">private</span> IOrderService <span style="color:#ae81ff">_</span>orderService;

    <span style="color:#66d9ef">public</span> OrderController(IOrderService orderService)
    {
        <span style="color:#ae81ff">_</span>orderService = orderService;
    }
    
    <span style="color:#66d9ef">public</span> Order Get(<span style="color:#66d9ef">int</span> orderId)
    {
        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">_</span>orderService.GetOrderById(orderId);
    }
}

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CustomerController</span> : Controller 
{
    <span style="color:#66d9ef">private</span> ICustomerService <span style="color:#ae81ff">_</span>customerService;

    <span style="color:#66d9ef">public</span> CustomerController(ICustomerService customerService)
    {
         <span style="color:#ae81ff">_</span>customerService = customerService;
    }
    
    <span style="color:#66d9ef">public</span> Customer Get(<span style="color:#66d9ef">int</span> customerId)
    {
        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">_</span>customerService.GetOrderById(orderId);
    }
}
</code></pre></div><p>We can&rsquo;t get away from inheritance completely because of MVC, but we now have one less class to worry about. And in this trivial example, we have the same amount of code. Of course, that bit doesn&rsquo;t necessarily scale, but that&rsquo;s not a problem, really. Have we fixed all our problems? I think so.</p>
<p>Our controller now takes only the dependencies it needs. We don&rsquo;t need to pass so many things to any particular controller, and It is clear what it actually depends on.  In reality, we might have had to pass the same services to multiple controllers, but that&rsquo;s what composition is all about.</p>
<p>We no longer have hidden dependencies. Everything a controller needs is passed in. Much easier for testing. You can even run your tests concurrently without the shared static singleton service locator.</p>
<p>Now since we got rid of the base class, what about any cross-cutting concerns or common code?  Well, it should now become clear that some of that code might need to be a dependency passed into the subset of all controllers that actually use it.  And it that code still needs context-specific knowledge that you can&rsquo;t or don&rsquo;t want to pass in? I suggest looking into Aspect Oriented approaches such as the <a href="https://msdn.microsoft.com/en-us/library/system.web.mvc.filterattribute%28v=vs.118%29.aspx" target="_blank">MVC FilterAttribute</a>
.</p>
<p>But we still have far too many dependencies per controller with this approach right? Well, that depends. I&rsquo;ll hopefully cover this off from the next two sections, but at a high level, you may have mixed concerns in your controller if it still requires many different services. Or perhaps you need to encapsulate some of your business logic out into a new service instead of having it in amongst your MVC logic.  The other option, which is hard to achieve in the existing MVC framework but worth mentioning, is the idea of service injection into methods, as discussed under <a href="#advancedtopics">advanced topics</a>
.</p>
<h2 id="reality">Reality</h2>
<p>In reality, this type of code is probably already in your legacy applications, and It isn&rsquo;t simple to unravel them. It could take several attempts to transform your code to resemble this type of approach.</p>
<p>If you do want to tackle this type of refactoring, you would first want to pick one controller, and transform that one first.  This will require code duplication to move your dependencies in, but you should find that not all of them need to be copied over.</p>
<p>As you refactor out code into attributes and new service classes, think about adding usages from your base class and other controllers at the same time, if the change is small enough to do so.</p>
<p>Another real-world solution to the Service Location problem, especially for testing is to pass these dependencies in a second constructor and use <em>service location</em> from the default constructor instead.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cs" data-lang="cs"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BaseController</span> : Controller
{
    ...
    
    <span style="color:#66d9ef">protected</span> BaseController()
    : <span style="color:#66d9ef">this</span>(Service.Locate&lt;ICustomerService&gt;(),Service.Locate&lt;IOrderService&gt;())
    {
    }
    
    <span style="color:#66d9ef">protected</span> BaseController(
        ICustomerService customerService,
        IOrderService orderService)
    {
        <span style="color:#ae81ff">_</span>customerService = customerService;
        <span style="color:#ae81ff">_</span>orderService = orderService;
    }
}

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">OrderController</span> : BaseController 
{
    <span style="color:#66d9ef">public</span> OrderController(
        ICustomerService customerService,
        IOrderService orderService)
        : <span style="color:#66d9ef">base</span>(customerService, orderService)
    {
    }
    
    <span style="color:#66d9ef">public</span> OrderController() : <span style="color:#66d9ef">base</span>()
    {
    }
    
    ...
}
</code></pre></div><p>This approach allows you to fix your concurrent testing issues, even if you can&rsquo;t fix all of your problems straight away.</p>
<p>If you can&rsquo;t get rid of the base class at all, look for candidates that are only used in some places, and pull these down, so at least new dependencies added will see this approach, and you have a new gravity well approach for others to follow.</p>
<h2 id="advanced-topics">Advanced Topics</h2>
<p>I said I would mention is service injection into methods.  This is something that containers won&rsquo;t do for you, but there are approaches available in other frameworks and libraries that could allow you to follow a similar pattern. Worst-case an <a href="https://en.wikipedia.org/wiki/Adapter_pattern" target="_blank">Adapter</a>
 could be used to achieve this as another layer in your MVC, or use Lazy objects to at least simulate the run-time benefits this creates.</p>
<p>The implementation of the method looks as follows:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cs" data-lang="cs">
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CustomerController</span> : Controller 
{   
    <span style="color:#66d9ef">public</span> Customer Get(<span style="color:#66d9ef">int</span> customerId, ICustomerService customerService)
    {
        <span style="color:#66d9ef">return</span> CustomerService.GetOrderById(orderId);
    }
}
</code></pre></div><p>As well as our parameters, we pass the services along here as well. This way, our controller method only requires the services it really uses, not all the services for all methods in this controller. As I said, you <em>should</em> only have services that most of your actions need anyway, of you have a solid single responsibility in this controller.</p>
<p>The way to simulate some of these benefits, as mentioned before, would look something like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cs" data-lang="cs"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CustomerController</span> : Controller 
{
    <span style="color:#66d9ef">private</span> Lazy&lt;ICustomerService&gt; <span style="color:#ae81ff">_</span>customerService;

    <span style="color:#66d9ef">public</span> CustomerController(Lazy&lt;ICustomerService&gt; customerService)
    {
         <span style="color:#ae81ff">_</span>customerService = customerService;
    }
    
    <span style="color:#66d9ef">public</span> Customer Get(<span style="color:#66d9ef">int</span> customerId)
    {
        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">_</span>customerService.Value.GetOrderById(orderId);
    }
}
</code></pre></div><p>Given we have a container, we now we only actually create a service and all of its dependencies in the method where we actually use it, and not anywhere else.  Slight gain, but if you are trying to tidy up your controllers, this little trick could come in useful.</p>
<h3 id="parting-words">Parting words</h3>
<p>If you&rsquo;ve made it this far, thanks for sticking with me, I know it has been a long one.  What might render this discussion moot, or highly important is this small piece of advice:</p>
<blockquote>
<p>Separate your rendering/routing/MVC style concerns from your implementation details.</p>
</blockquote>
<p>Try to keep your controllers void of logic and stick with transforming user data to a payload, passing the payload to a service, and rendering the results from the service. Authorisation and validation might fit better here as well, but not your actual business logic.  This will serve you well for simplifying testing, and less fighting with the framework to make it handle injection, dependencies, inheritance and HTTP concerns within your business rules.</p>
<p>There are no silver bullets, but if your system is complex, this approach does make testing easier, overall.</p>
<p>I would like to code up a bigger solution showing all three approaches to stick up on GitHub. We will see if time permits later in the month.</p>
<h2 id="update">Update</h2>
<p>The mentioned GitHub solution is now available: <a href="https://github.com/csMacnzBlog/BaseClassAntiPattern">https://github.com/csMacnzBlog/BaseClassAntiPattern</a></p>
</div><hr /><div class="post-navs d-flex mb-3 justify-content-between">
  <div class="post-nav w-50"><div class="prev-post btn btn-sm">
      <a href="https://csmacnzblog.github.io/post/windows-10-phantom-text-fix/">Windows 10 phantom text fix</a>
    </div></div>
  <div class="post-nav flex-row-reverse"><div class="next-post btn btn-sm">
      <a href="https://csmacnzblog.github.io/post/another-layer-of-indirection/">Another layer of indirection</a>
    </div></div>
</div><section class="related-posts">
    <h3>Related Posts</h3>
    <ul class="related-posts"><li><a href="https://csmacnzblog.github.io/post/more-small-classes/">More small classes</a></li><li><a href="https://csmacnzblog.github.io/post/code-demoing-with-visual-studio/">Code Demoing with Visual Studio</a></li><li><a href="https://csmacnzblog.github.io/post/ports-and-adapters/">Ports and Adapters</a></li><li><a href="https://csmacnzblog.github.io/post/console2-console-arrow-keys-acting-wrong-the-fix/">Console2 Console arrow keys acting wrong - The fix</a></li><li><a href="https://csmacnzblog.github.io/post/semantics-vs-implementation-detail/">Semantics vs implementation detail</a></li></ul>
  </section></article><div class="post-comments surface row"></div></div>
</div><aside class="col-lg-4 sidebar d-flex">
  <div class="container"><section class="recent-posts row surface">
  <h4>Recent Posts</h4>
  <ul><li><a href="https://csmacnzblog.github.io/post/terraform-newrelic-provider-facepalm/">Failed to query available provider packages - Terraform NewRelic Provider :facepalm:</a></li><li><a href="https://csmacnzblog.github.io/post/kotlin-teamcity-and-reflection/">Kotlin, TeamCity and reflection</a></li><li><a href="https://csmacnzblog.github.io/post/bluetooth-devices-keep-disconnecting/">Bluetooth Devices keep disconnecting</a></li><li><a href="https://csmacnzblog.github.io/post/nullable-and-notnull-serialisation-properties/">Nullable and notnull Serialisation Properties</a></li><li><a href="https://csmacnzblog.github.io/post/we-are-all-10x/">We are all 10x engineers, but I don&#39;t think it means what you think it means</a></li></ul>
</section><section class="taxonomy-categories row surface">
      <h4>
        <a href="https://csmacnzblog.github.io/categories">Categories</a>
      </h4>
      <div><a href="https://csmacnzblog.github.io/categories/c#/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="c#">
          c# <span class="badge rounded-pill">37</span>
        </a><a href="https://csmacnzblog.github.io/categories/dotnetcore/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="dotnetcore">
          dotnetcore <span class="badge rounded-pill">35</span>
        </a><a href="https://csmacnzblog.github.io/categories/tips-and-tricks/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="Tips and Tricks">
          Tips and Tricks <span class="badge rounded-pill">30</span>
        </a><a href="https://csmacnzblog.github.io/categories/editorial/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="Editorial">
          Editorial <span class="badge rounded-pill">26</span>
        </a><a href="https://csmacnzblog.github.io/categories/continuous-delivery/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="Continuous Delivery">
          Continuous Delivery <span class="badge rounded-pill">13</span>
        </a><a href="https://csmacnzblog.github.io/categories/software-development/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="software development">
          software development <span class="badge rounded-pill">13</span>
        </a><a href="https://csmacnzblog.github.io/categories/projects/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="Projects">
          Projects <span class="badge rounded-pill">12</span>
        </a><a href="https://csmacnzblog.github.io/categories/conference/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="Conference">
          Conference <span class="badge rounded-pill">9</span>
        </a><a href="https://csmacnzblog.github.io/categories/git/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="git">
          git <span class="badge rounded-pill">8</span>
        </a><a href="https://csmacnzblog.github.io/categories/visual-studio/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="Visual Studio">
          Visual Studio <span class="badge rounded-pill">8</span>
        </a></div>
    </section><section class="taxonomy-tags row surface">
      <h4>
        <a href="https://csmacnzblog.github.io/tags">Tags</a>
      </h4>
      <div><a href="https://csmacnzblog.github.io/tags/c#/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="c#">
          c# <span class="badge rounded-pill">37</span>
        </a><a href="https://csmacnzblog.github.io/tags/dotnetcore/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="dotnetcore">
          dotnetcore <span class="badge rounded-pill">35</span>
        </a><a href="https://csmacnzblog.github.io/tags/tips-and-tricks/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="Tips and Tricks">
          Tips and Tricks <span class="badge rounded-pill">30</span>
        </a><a href="https://csmacnzblog.github.io/tags/editorial/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="Editorial">
          Editorial <span class="badge rounded-pill">26</span>
        </a><a href="https://csmacnzblog.github.io/tags/continuous-delivery/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="Continuous Delivery">
          Continuous Delivery <span class="badge rounded-pill">13</span>
        </a><a href="https://csmacnzblog.github.io/tags/software-development/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="software development">
          software development <span class="badge rounded-pill">13</span>
        </a><a href="https://csmacnzblog.github.io/tags/projects/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="Projects">
          Projects <span class="badge rounded-pill">12</span>
        </a><a href="https://csmacnzblog.github.io/tags/conference/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="Conference">
          Conference <span class="badge rounded-pill">9</span>
        </a><a href="https://csmacnzblog.github.io/tags/git/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="git">
          git <span class="badge rounded-pill">8</span>
        </a><a href="https://csmacnzblog.github.io/tags/visual-studio/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="Visual Studio">
          Visual Studio <span class="badge rounded-pill">8</span>
        </a></div>
    </section></div>
</aside>
</div>
    </main><footer class="footer mt-auto py-3 text-center container"><nav class="social-links nav my-2 justify-content-center"></nav>
<div class="copyright mb-2">
  
</div>
<div class="powered-by mb-2">
  Powered by <a href="https://gohugo.io" target="_blank">Hugo</a> and the <a href="https://github.com/razonyang/hugo-theme-bootstrap" target="_blank">Bootstrap</a> theme.
</div></footer>
<a id="btnScrollToTop" class="btn-scroll-to-top">
  <i class="fas fa-fw fa-chevron-circle-up fa-2x"></i>
</a>
</body>
</html>
