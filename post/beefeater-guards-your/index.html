<!DOCTYPE html>
<html lang="en">
    <head>

        <script>
            if(!/blog\.csmac\.nz/.test(window.location.host)) {
                window.location = "https:\/\/blog.csmac.nz\/post\/beefeater-guards-your\/";
            }
        </script>

        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name='author' content='Mark Clearwater, csmacnz@csmac.co.nz'>
        <meta name='language' content='EN'>
        <meta name='medium' content='blog'>

    
        <title>Beefeater - Guard your methods&#39; Ins and Outs. - csMACnz&#39;s Blog</title>
        <meta name="description" content=" A little while back I started paying attention to Rust and got all inspired to have a bit of that it C#. The result was this library I called Beefeater. This library contains helpers to add semantics to the optionality …">
        <meta name='keywords' content='csMACnz'>

        
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Beefeater - Guard your methods&#39; Ins and Outs."/>
        <meta property="og:description" content=" A little while back I started paying attention to Rust and got all inspired to have a bit of that it C#. The result was this library I called Beefeater. This library contains helpers to add semantics to the optionality …"/>
        <meta property="og:site_name" content="csMACnz&#39;s Blog"/>
        <meta property="og:url" content="https://blog.csmac.nz/post/beefeater-guards-your/"/>
        <meta property="og:image" content="https://csmac.nz/Content/icon/icon.png"/>

        
        <meta name="twitter:card" content="summary"/>
        <meta name="twitter:title" content="Beefeater - Guard your methods&#39; Ins and Outs."/>
        <meta name="twitter:description" content=" A little while back I started paying attention to Rust and got all inspired to have a bit of that it C#. The result was this library I called Beefeater. This library contains helpers to add semantics to the optionality …"/>
        <meta name="twitter:image" content="https://csmac.nz/Content/icon/icon.png"/>
        <meta name="twitter:site" content="@csMACnz"/>
        <meta name="twitter:creator" content="@csMACnz"/>
    

        <link rel="apple-touch-icon-precomposed" href="/images/icon/apple-touch-icon-precomposed.png">
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/icon/apple-touch-icon-72x72-precomposed.png">
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/icon/apple-touch-icon-114x114-precomposed.png">
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/icon/apple-touch-icon-144x144-precomposed.png">
        <link rel="icon" type="image/png" href="/images/icon/icon.png" />
        <link rel='me' type='text/html' href='https://github.com/csMACnz'>

        <script>
            var d_id  = 'csmacnz',
                g_id  = 'UA-18464866-2',
                g_url = 'auto';
        </script>

        <link rel="stylesheet" type="text/css" href="/css/style.css" />
        <link rel="stylesheet" type="text/css" href="/css/blogstyle.css" />

        <link rel="alternate stylesheet" title="dark-code" type="text/css" href="/css/solarized_dark.css" disabled>
        <link rel="stylesheet" title="light-code" type="text/css" href="/css/github-gist.css" disabled>

        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4517187877737982"
        crossorigin="anonymous"></script>

        
        
        <script type="application/ld+json">
        {
            "@context" : "https://schema.org",
            "@type" : "Article",
            "publisher": {
                "@type": "Organization",
                "name": "csMACnz&#x27;s Blog",
                "logo": "https:\/\/blog.csmac.nz\/images\/icon\/apple-touch-icon-144x144-precomposed.png"
            },
            "author": {
                "@type": "Person",
                "name": "Mark Clearwater",
                "image": {
                    "@type": "ImageObject",
                    "url": "//www.gravatar.com/avatar/c97410951ec3738a3fd4a2dfb17a5d9c?d=404&s=250",
                    "width": 440,
                    "height": 295
                },
                "url": "https:\/\/blog.csmac.nz",
                "sameAs": [
                    "https://csmac.nz"
                ]
            },
            "articleSection" : "post",
            "name" : "Beefeater - Guard your methods\u0027 Ins and Outs.",
            "headline" : "Beefeater - Guard your methods\u0027 Ins and Outs.",
            "url" : "https:\/\/blog.csmac.nz\/post\/beefeater-guards-your\/",
            "datePublished": "2018-08-06T06:00:00.000Z",
            "dateModified" : "2018-08-06T06:00:00.000Z",
            "keywords" : [  ]
            "description" : "A little while back I started paying attention to Rust and got all inspired to have a bit of that it C#. The result was this library I called Beefeater.\nThis library contains helpers to add semantics to the optionality of your parameters and results from method calls. I built it on NetStandard1.0 for maximum compatibility.\nSome of this will soon become obsolete with C# 8 features such as the C# 8 nullable reference types, but much of it gives you the power you need right now.",
            "mainEntityOfPage": {
                "@type": "WebPage",
                "@id": "https:\/\/blog.csmac.nz"
            }
            "inLanguage" : "en-US",
            "author" : "Mark Clearwater",
            "creator" : "Mark Clearwater",
            "accountablePerson" : "Mark Clearwater",
            "copyrightHolder" : "Mark Clearwater",
            "copyrightYear" : "2018",
            "wordCount" : "1480",
        }
        </script>
        
        
        
    </head>
    <body class="blog">
        <div class="page-area">

            <header class="header-area">
                <h1 class="header-area-title">csMACnz</h1>
            </header>
            <nav class="navigation-area header-bar-parent">
                <div class="header-bar header-bar-blog">
                    <ul class="menu">
                        <li class="menu-item"><a class="menu-item-content" href="https://csmac.nz">Home</a></li>
                        <li class="menu-item"><a class="menu-item-content" href="https://csmac.nz/BaconVaders">Bacon Vaders</a></li>
                        <li class="menu-item"><a class="menu-item-content CurrentButton" href="/">Blog</a></li>
                    </ul>
                </div>
            </nav>

            <div id="content" class="content-area">

<!--Page Content Begins-->

<article>
    <div class="content-box" itemscope itemtype=" https://schema.org/Article"><span class="post-meta"><time datetime="2018-08-06"  itemprop="datePublished">06 Aug 18</time> in <a href="/categories/projects">Projects</a>,  <a href="/categories/software-engineering">Software Engineering</a></span>
<h1 class="post-title" itemprop="headline">Beefeater - Guard your methods&#39; Ins and Outs.</h1>
    
        <section class="post-content"  itemprop="articleBody">
            <img align="right" width="256px" height="256px" src="http://img.csmac.nz/Beefeater-256.svg">
<p>A little while back I started paying attention to Rust and got all inspired to have a bit of that it C#. The result was this library I called Beefeater.</p>
<p>This library contains helpers to add semantics to the optionality of your parameters and results from method calls. I built it on <code>NetStandard1.0</code> for maximum compatibility.</p>
<p>Some of this will soon become obsolete with C# 8 features such as the C# 8 nullable reference types, but much of it gives you the power you need right now.</p>
<p>You can install the NuGet package using <code>Install-Package Beefeater</code> or by heading to the <a href="https://www.nuget.org/packages/Beefeater">Nuget Package Page</a>.</p>
<p>Last week I released version 0.5.0.</p>
<p>The basic idea is similar to the <code>Nullable&lt;T&gt;</code> type that exists for value types. But extend this into semantic markup around method arguments and return types.</p>
<p>The approach is to allow you to write declarative code, and let the library determine which part gets called.</p>
<p>To make this seamless, I&rsquo;ve leveraged a few features of C#, namely the Implicit Casts, and Generics.</p>
<p>But just declaring optionality isn&rsquo;t enough, so the goal is to go further and provide functions to write better safer code using these types.</p>
<h3 id="the-bits">The bits</h3>
<p>The library is made up of a few different utilities and ideas.</p>
<ul>
<li><code>Option&lt;T&gt;</code> - declare a reference type as possibly null (C# 8 makes this obsolete, but implicit casts to/from the new syntax might work)</li>
<li><code>NotNull&lt;T&gt;</code> - so you can declare something is certainly never null (or crash immediately rather than on dereference)</li>
<li><code>Result&lt;TValue, TError&gt;</code> - Represents either a success result or an error (Modelled after <a href="https://doc.rust-lang.org/std/result/">Rust&rsquo;s std::result</a>)</li>
<li><code>Either&lt;TValue, TError&gt;</code> - a more generic concept of a two-part Union type</li>
</ul>
<p>There are implicit casts to and from (where sensible) these types when they are in use, so you only need to explicitly declare them in contracts, and occasionally in return types. Although, a bunch of work has been put in to avoid return types most of the type.</p>
<p>These classes have some consistent methods to help out:</p>
<ul>
<li>Match - a function or action that is provided lambda <code>Func</code>s/<code>Action</code>s  respectively to cover both known states of the object.</li>
<li>HasValue - similar to the <code>Nullable&lt;T&gt;</code></li>
<li>ValueOrDefault - to ensure you certainly get back a value</li>
<li>IsSuccess - a similar pattern to <code>Nullable&lt;T&gt;</code> applied to <code>Result&lt;,&gt;</code></li>
</ul>
<p>There was a theory of making an enum match but it wasn&rsquo;t achievable. However again C# 8 might solve this with new pattern matching too.</p>
<p>There is also Resharper definitions provided to work with and be trusted by the Resharper Null static analysis.</p>
<h3 id="show-me-the-code">Show me the code!</h3>
<h4 id="optiont">Option<T></h4>
<p>As a simple example you may have a method like this:</p>
<pre tabindex="0"><code>public string Modify(string first, string second)
{
    if (first == null)
    {
        throw new ArgumentNullException(nameof(first));
    }
    if (second == null)
    {
        return null;
    }
    return first + second;
}
</code></pre><p>Typical code. A bit of error checking, and some switch logic based on an optional argument.</p>
<p>I don&rsquo;t know about you, but it is hard for me to know that <code>first</code> is required, but <code>second</code> is optional. At least not without comments, or a thorough inspection of the code. Shouldn&rsquo;t the signature tell me this? (C# 8 says it will.)</p>
<p>Lets take a look at this using Beefeater:</p>
<pre tabindex="0"><code>public Option&lt;string&gt; Modify(NotNull&lt;string&gt; first, Option&lt;string&gt; second)
{
    return second.Match(
        v =&gt; first + v,
        () =&gt; Option&lt;string&gt;.None);
}

var x = Modify(&#34;Hello&#34;, &#34;World&#34;);
var y = Modify(&#34;Hello&#34;, null);
</code></pre><p>That is very clean to me. First, the signature tells us everything we need to know.</p>
<p>And when we look at the calling syntax, it is seamless. it works exactly as you expect. With one difference.</p>
<p><code>x</code> and <code>y</code> in the example are both <code>Option&lt;string&gt;</code> type. This means you cannot pass this to a method that requires <code>NotNull&lt;string&gt;</code>, or even <code>string</code> itself.</p>
<p>Why? Well, clearly you have no idea if that result is safe. You know it is either a Nothing or a non-null string. (Is it both?  Schrodinger&rsquo;s <code>Option&lt;T&gt;</code>?)</p>
<p>The only sensible thing to do is to check, right? It would be unsafe not to.  Thus the value of the library is revealed.</p>
<p>That check can use the <code>Match</code> method, too.</p>
<pre tabindex="0"><code>var x = Modify(&#34;Hello&#34;, &#34;World&#34;);

var outputMessage = x.Match(
  some: value =&gt; $&#34;The result is {value}&#34;,
  none: () =&gt; &#34;There wasn&#39;t anything to report&#34;);

Console.WriteLine(outputMessage);
</code></pre><p>Your code will start to become very functional, but you will also get compile-type checks to ensure you are handling error cases correctly.</p>
<p>If you really want to live dangerously, though, there is an explicit cast back to the original type, that will throw a <code>PanicException</code>. This is basically the library equivalent to the <code>NullReferenceException</code>, but should normally throw earlier in your code when the Null is first observed, rather than late at dereference.</p>
<p>Much like async/await, this library is contagious and will ripple through your code, just FYI.</p>
<h4 id="resulttvalue-terror">Result&lt;TValue, TError&gt;</h4>
<p>Apart from <code>Option&lt;T&gt;</code>, the other most useful is the <code>Result&lt;TValue, TError&gt;</code>.</p>
<p>Again, you might have written:</p>
<pre tabindex="0"><code>public bool Create(string filePath, string second)
{
    if (filePath == null)
    {
        throw new ArgumentNullException(nameof(filePath));
    }
    if(second == null)
    {
        return false;
    }
    using (FileStream stream = File.OpenWrite(filePath))
    {
        using (var writer = new StreamWriter(stream))
        {
            writer.WriteLine(second);
        }
    }
    return true;
}
</code></pre><p>Again, a little cruft. Optionality unclear. But there is more.  This method can and will throw a bunch of exceptions. FileNotFound, UnauthorizedAccess, and others. Your calling code is either going to handle many exceptions, or the app will crash. We could put the logic into the method, and the code would get complex. But how do we handle the return? returns <code>true</code>, <code>false</code> or Throws exception, how do you translate that into a concise return type of <code>true</code>, <code>false</code> or FileNotFound or Unauthorized or Other?</p>
<p>Beefeater says like this:
(Rust too, actually&hellip;)</p>
<pre tabindex="0"><code>public enum ErrorResult
{
    UnknownError,
    FileNotFound,
    Unauthorized
}
public Result&lt;bool, ErrorResult&gt; Create(NotNull&lt;string&gt; filePath, Option&lt;string&gt; second)
{
    FileStream stream;
    try
    {
        stream = File.OpenWrite(filePath);
    }
    catch (UnauthorizedAccessException ex)
    {
        return ErrorResult.Unauthorized;
    }
    catch (FileNotFoundException ex)
    {
        return ErrorResult.FileNotFound;
    }
    catch (Exception ex)
    {
        return ErrorResult.UnknownError;
    }
    using (stream)
    {
        return second.Match(
            v =&gt;
            {
                using (var writer = new StreamWriter(stream))
                {
                    writer.WriteLine(v);
                }
                return true;
            },
            () =&gt; false);
    }
}
</code></pre><p>To me, the business logic is very easy to read from this code. Again the signature is clear what to expect and how to use the result.</p>
<pre tabindex="0"><code>var result = Create(&#34;myfile.txt&#34;, someVar);
var outputMessage = result.Match(
  isCreated =&gt; isCreated
    ? &#34;The file was created with someVar&#34;
    : &#34;The file was not created because someVar&#34;,
  error =&gt; 
  {
      switch(error)
      {
          case FileNotFound:
              return &#34;File Not Found&#34;;
          case Unauthorized:
              return &#34;The file is secure and you can&#39;t get it.&#34;;
          case UnknownError:
          default:
              return &#34;An unknown Error occurred&#34;;
      }
  });

Console.WriteLine(outputMessage);
</code></pre><p>Just like that, every code-branch/edge-case has to be covered, or it will not compile. (Enum notwithstanding.)</p>
<h4 id="either">Either</h4>
<p><code>Either&lt;T1, T2&gt;</code> is very similar to Result, except the semantic meaning differs. It allows a method to return either one type or another type.</p>
<pre tabindex="0"><code>public Either&lt;long, double&gt; DivideByTwo(int aNumber)
{
    if (aNumber % 2 == 0)
        return aNumber / 2;
    return aNumber / (double)2;
}

var x = DivideByTwo(10);
var x = DivideByTwo(5);
</code></pre><h4 id="recursion">Recursion?</h4>
<p>You could even nest these things:</p>
<pre tabindex="0"><code>Either&lt;Option&lt;string&gt;, NotNull&lt;int&gt;&gt;
Option&lt;Either&lt;Foo, Bar&gt;&gt;
Result&lt;Option&lt;string&gt;,CustomError&gt;
Result&lt;Unit,string&gt;
</code></pre><p>Different combinations will provide different value in different situations.</p>
<p><code>Unit</code>? Yeah. When you go functional, representing <code>void</code> as a type is much helpful. I have another library where I get my Unit from, but there are literally dozens on Nuget.</p>
<h3 id="c-8">C# 8</h3>
<p>I&rsquo;ve hung a lot of stuff on C# 8 in this article. At some point, I should cover what is coming (though at this stage nothing is certain). Basically, though, this library has been hanging around for a while, before nullable reference types was even being discussed publicly. So whether nullable reference types happens in 8, 8.1 or C# 9, this library is here today and can get you started thinking about different states of optionality in your code today.</p>
<h3 id="performance">Performance?</h3>
<p>About that&hellip;.</p>
<p>So I haven&rsquo;t actually spent any time profiling to see if this is damaging your code. For most LOB apps, this will not be the bottleneck compared to IO. But it is a valid point and does need further investigation and optimisation.</p>
<p>From a development performance point of view, I do go slower to go faster. I think about and code up the edge cases up front, rather than doubling back when something goes wrong.</p>
<h3 id="attention">Attention!</h3>
<p>So that&rsquo;s Beefeater. I&rsquo;ve started using it slowly on utilities and simple console apps. Hopefully, you find it interesting and it inspires you to think about how you handle your code yourself.</p>
<p>If you don&rsquo;t like the ideas in this library, remember a <code>Result&lt;,&gt;</code> is just a tuple, a <code>(string, ErrorEnum)</code> if you wish. The rest is just boilerplate code you could write yourself. (Though I do handle all the error and state checking for you so you can just provide the Actions 😉 )</p>
</section>
        
        <section class="share">
            Share: 
            <a class="icon-twitter" href="https://twitter.com/share?text=Beefeater%20-%20Guard%20your%20methods%27%20Ins%20and%20Outs.&url=https%3a%2f%2fblog.csmac.nz%2fpost%2fbeefeater-guards-your%2f"
                onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                <span>Twitter</span>
            </a>
            |
            <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.csmac.nz%2fpost%2fbeefeater-guards-your%2f"
                onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                <span>Facebook</span>
            </a>
        </section>
    </div>
    <div class="content-box">
        
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            var disqus_shortname = d_id; 
            var disqus_title = 'Beefeater - Guard your methods\u0027 Ins and Outs.';
            
             
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    
    </div>
</article>

<!--Page Content Ends-->

            </div><aside class="sidebar-area">

<!--Sidebar Content Begins-->

                <div class="header-bar-parent sidebar-item">
                    <div class="header-bar header-bar-twitter">Twitter</div>
                    
                    <a class="twitter-timeline" data-lang="en" data-height="510" data-dnt="true" href="https://twitter.com/csMACnz?ref_src=twsrc%5Etfw">Tweets by csMACnz</a> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
                    
                </div>


                <div class="header-bar-parent sidebar-item">
                    <div class="header-bar header-bar-rss">Subscribe</div>
                    
                    <a href="/rssfeeds/" title="csMACnz's Blog">RSS Feeds</a>
                    <a href="https://feedly.com/i/subscription/feed%2Fhttps%3A%2F%2Ffeeds.feedburner.com%2FcsmacnzBlog" target="_blank" title="csMACnz&amp;#039;s Blog"><img src="https://s3.feedly.com/feedburner/feedly.png" alt="" style="border:0"/></a>
                    <a href="https://feeds.feedburner.com/csmacnzBlog" target="_blank"><img src="https://feeds.feedburner.com/~fc/csmacnzBlog?bg=fabb45&amp;fg=4B4B4B&amp;anim=1" height="26" width="88" style="border:0" alt="" /></a>
                    <br />
                    <a href="https://www.patreon.com/csMACnz" target="_blank"><img src="/images/patreon.png" /></a>
                    
                    
                </div>


                <div class="header-bar-parent sidebar-item">
                    <div class="header-bar header-bar-xbox">Gamercard</div>
                    

                    <div>
                        <a href="https://www.exophase.com/xbox/user/csMACnz/"><img width="288px" src="https://card.exophase.com/1/1476805.png"></a>
                        <a href="http://steamcommunity.com/id/csMACnz/" target="_blank"><img src="https://www.steamsignature.com/status/english/76561197994712512.png" alt="" title="csMACnz's Steam Profile" /></a>
                    </div>
                    
                </div>


                <div class="header-bar-parent sidebar-item">
                    <div class="header-bar header-bar-ads">Advertisement</div>
                    
                    <div>
                        
                        <ins class="adsbygoogle"
                            style="display:block"
                            data-ad-client="ca-pub-4517187877737982"
                            data-ad-slot="3618449993"
                            data-ad-format="auto"
                            data-full-width-responsive="true"></ins>
                        <script>
                            (adsbygoogle = window.adsbygoogle || []).push({});
                        </script>
                    </div>
                    
                </div>

<!--Sidebar Content Ends-->

            </aside>

            <footer class="footer-area">

            <p>
                Designed and Maintained by Mark Clearwater; Last updated August 2021.
                <!-- This used to be something useful, now it is just a hack I left it to make layout easier but also as a fun reminder for me of what it used to be -->
                <br /><a class="footer-link" >¯\_(ツ)_/¯</a>
            </p>

            </footer>
        </div>

<!--body scripts Begins-->

        
        <script src="/js/highlight.pack.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>

        <script src="/js/codetoggle.js"></script> 

        
        <script>
            var _gaq = [['_setAccount', g_id], ['_trackPageview']];
            (function (d, t) {
                var g = d.createElement(t), s = d.getElementsByTagName(t)[0];
                g.src = ('https:' == location.protocol ? '//ssl' : '//www') + '.google-analytics.com/ga.js';
                s.parentNode.insertBefore(g, s);
            }(document, 'script'));
        </script>

        <script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>

<!--body scripts Ends-->


<!-------------------------------->
<!--                            -->
<!--  _(\    |@@|               -->
<!-- (__/\__ \--/ __            -->
<!--    \___|----|  |   __      -->
<!--        \ }{ /\ )_ / _\     -->
<!--        /\__/\ \__O (__     -->
<!--       (--/\--)    \__/     -->
<!--       _)(  )(_             -->
<!--      `---''---`            -->
<!--                            -->
<!-- https://github.com/csMACnz -->
<!-------------------------------->

    </body>
</html>
