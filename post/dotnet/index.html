<!DOCTYPE html>
<html lang="en">
    <head>

        <script>
            if(!/blog\.csmac\.nz/.test(window.location.host)) {
                window.location = "https:\/\/blog.csmac.nz\/post\/dotnet\/";
            }
        </script>

        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name='author' content='Mark Clearwater, csmacnz@csmac.co.nz'>
        <meta name='language' content='EN'>
        <meta name='medium' content='blog'>

    
        <title>dotnet &#43; nunit3 &#43; TeamCity success - csMACnz&#39;s Blog</title>
        <meta name="description" content="The new .Net Core CLI has the ability to use xunit or nunit. Which is great. For running tests locally. I use TeamCity, so I like to see test results showing up, track testing count over time etc. There is a built in way …">
        <meta name='keywords' content='csMACnz, dotnetcore, Testing, TeamCity'>

        
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="dotnet &#43; nunit3 &#43; TeamCity success"/>
        <meta property="og:description" content="The new .Net Core CLI has the ability to use xunit or nunit. Which is great. For running tests locally. I use TeamCity, so I like to see test results showing up, track testing count over time etc. There is a built in way …"/>
        <meta property="og:site_name" content="csMACnz&#39;s Blog"/>
        <meta property="og:url" content="https://blog.csmac.nz/post/dotnet/"/>
        <meta property="og:image" content="https://csmac.nz/Content/icon/icon.png"/>

        
        <meta name="twitter:card" content="summary"/>
        <meta name="twitter:title" content="dotnet &#43; nunit3 &#43; TeamCity success"/>
        <meta name="twitter:description" content="The new .Net Core CLI has the ability to use xunit or nunit. Which is great. For running tests locally. I use TeamCity, so I like to see test results showing up, track testing count over time etc. There is a built in way …"/>
        <meta name="twitter:image" content="https://csmac.nz/Content/icon/icon.png"/>
        <meta name="twitter:site" content="@csMACnz"/>
        <meta name="twitter:creator" content="@csMACnz"/>
    

        <link rel="apple-touch-icon-precomposed" href="/images/icon/apple-touch-icon-precomposed.png">
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/icon/apple-touch-icon-72x72-precomposed.png">
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/icon/apple-touch-icon-114x114-precomposed.png">
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/icon/apple-touch-icon-144x144-precomposed.png">
        <link rel="icon" type="image/png" href="/images/icon/icon.png" />
        <link rel='me' type='text/html' href='https://github.com/csMACnz'>

        <script>
            var d_id  = 'csmacnz',
                g_id  = 'UA-18464866-2',
                g_url = 'auto';
        </script>

        <link rel="stylesheet" type="text/css" href="/css/style.css" />
        <link rel="stylesheet" type="text/css" href="/css/blogstyle.css" />

        <link rel="alternate stylesheet" title="dark-code" type="text/css" href="/css/solarized_dark.css" disabled>
        <link rel="stylesheet" title="light-code" type="text/css" href="/css/github-gist.css" disabled>

        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4517187877737982"
        crossorigin="anonymous"></script>

        
        
        <script type="application/ld+json">
        {
            "@context" : "https://schema.org",
            "@type" : "Article",
            "publisher": {
                "@type": "Organization",
                "name": "csMACnz&#x27;s Blog",
                "logo": "https:\/\/blog.csmac.nz\/images\/icon\/apple-touch-icon-144x144-precomposed.png"
            },
            "author": {
                "@type": "Person",
                "name": "Mark Clearwater",
                "image": {
                    "@type": "ImageObject",
                    "url": "//www.gravatar.com/avatar/c97410951ec3738a3fd4a2dfb17a5d9c?d=404&s=250",
                    "width": 440,
                    "height": 295
                },
                "url": "https:\/\/blog.csmac.nz",
                "sameAs": [
                    "https://csmac.nz"
                ]
            },
            "articleSection" : "post",
            "name" : "dotnet \u002b nunit3 \u002b TeamCity success",
            "headline" : "dotnet \u002b nunit3 \u002b TeamCity success",
            "url" : "https:\/\/blog.csmac.nz\/post\/dotnet\/",
            "datePublished": "2016-10-25T00:54:19.000Z",
            "dateModified" : "2016-10-25T00:54:19.000Z",
            "image" : {
                "@type": "ImageObject",
                "url": "http:\/\/res.cloudinary.com\/csmacnz\/image\/upload\/c_scale,w_440\/v1477242881\/Laboratory_e3mfzu.jpg",
                "width": 440,
                "height": 295
            },
            "keywords" : [ "dotnetcore", "Testing", "TeamCity" ]
            "description" : "The new .Net Core CLI has the ability to use xunit or nunit. Which is great. For running tests locally.\nI use TeamCity, so I like to see test results showing up, track testing count over time etc. There is a built in way to import xml reports which supports junit (which is xunit-compatible) and nunit. But choosing nunit means support for the nunit2 xml format. And guess what? The new .",
            "mainEntityOfPage": {
                "@type": "WebPage",
                "@id": "https:\/\/blog.csmac.nz"
            }
            "inLanguage" : "en-US",
            "author" : "Mark Clearwater",
            "creator" : "Mark Clearwater",
            "accountablePerson" : "Mark Clearwater",
            "copyrightHolder" : "Mark Clearwater",
            "copyrightYear" : "2016",
            "wordCount" : "450",
        }
        </script>
        
        
        
    </head>
    <body class="blog">
        <div class="page-area">

            <header class="header-area">
                <h1 class="header-area-title">csMACnz</h1>
            </header>
            <nav class="navigation-area header-bar-parent">
                <div class="header-bar header-bar-blog">
                    <ul class="menu">
                        <li class="menu-item"><a class="menu-item-content" href="https://csmac.nz">Home</a></li>
                        <li class="menu-item"><a class="menu-item-content" href="https://csmac.nz/baconvaders">Bacon Vaders</a></li>
                        <li class="menu-item"><a class="menu-item-content CurrentButton" href="/">Blog</a></li>
                    </ul>
                </div>
            </nav>

            <div id="content" class="content-area">

<!--Page Content Begins-->

<article>
    <div class="content-box" itemscope itemtype=" https://schema.org/Article"><span class="post-meta"><time datetime="2016-10-25"  itemprop="datePublished">25 Oct 16</time> in <a href="/categories/software-engineering">Software Engineering</a> on <a href="/tags/dotnetcore">dotnetcore</a>,  <a href="/tags/testing">Testing</a>,  <a href="/tags/teamcity">TeamCity</a></span>
<h1 class="post-title" itemprop="headline">dotnet &#43; nunit3 &#43; TeamCity success</h1>
    
        <section class="post-content"  itemprop="articleBody">
            <img class="post-image" src="http://res.cloudinary.com/csmacnz/image/upload/c_scale,w_440/v1477242881/Laboratory_e3mfzu.jpg"><p>The new .Net Core CLI has the ability to use <a href="http://xunit.github.io/docs/getting-started-dotnet-core.html">xunit</a> or <a href="https://github.com/nunit/dotnet-test-nunit">nunit</a>. Which is great. For running tests locally.</p>
<p>I use TeamCity, so I like to see test results showing up, track testing count over time etc. There is a built in way to <a href="https://confluence.jetbrains.com/display/TCD10/Build+Script+Interaction+with+TeamCity#BuildScriptInteractionwithTeamCity-ImportingXMLReports">import xml reports</a> which supports <code>junit</code> (which is xunit-compatible) and <code>nunit</code>. But choosing <code>nunit</code> means support for the nunit2 xml format. And guess what? The new .Net Core test runner for nunit <a href="https://github.com/nunit/dotnet-test-nunit/issues/75">only outputs in nunit3 format</a>.</p>
<p>Now, the decision makes perfect sense to me. The new format is more expressive, gives more information and is the future. And vendors need to start using it and move away from the old format. But as you can imagine, JetBrains just hasn&rsquo;t gotten around to <a href="https://youtrack.jetbrains.com/issue/TW-46195">getting it right yet</a>. (There is some support in TC 10.0.2 but it seems there might be some teething issues and many of us are still on TC 9.X anyway.)</p>
<p>So what do I do about this? Solve it with code of course! And the solution is xslt (Hey! it gets the job done ok?)</p>
<p>Thanks to <a href="https://issues.jenkins-ci.org/browse/JENKINS-32999">some notes on this related Jenkins issue</a> from <a href="https://issues.jenkins-ci.org/secure/ViewProfile.jspa?name=tenwit">Paul Hicks</a>, I have this xslt page (with a small tweak to fix a value casing issue):</p>
<pre tabindex="0"><code>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;
&lt;xsl:stylesheet version=&#34;2.0&#34; xmlns:xsl=&#34;http://www.w3.org/1999/XSL/Transform&#34;&gt;
  &lt;xsl:output method=&#34;xml&#34; indent=&#34;yes&#34;/&gt;

  &lt;xsl:template match=&#34;/test-run&#34;&gt;
    &lt;testsuites tests=&#34;{@testcasecount}&#34; failures=&#34;{@failed}&#34; disabled=&#34;{@skipped}&#34; time=&#34;{@duration}&#34;&gt;
      &lt;xsl:apply-templates/&gt;
    &lt;/testsuites&gt;
  &lt;/xsl:template&gt;

  &lt;xsl:template match=&#34;test-suite&#34;&gt;
    &lt;xsl:if test=&#34;test-case&#34;&gt;
      &lt;testsuite tests=&#34;{@testcasecount}&#34; time=&#34;{@duration}&#34; errors=&#34;{@testcasecount - @passed - @skipped - @failed}&#34; failures=&#34;{@failed}&#34; skipped=&#34;{@skipped}&#34; timestamp=&#34;{@start-time}&#34;&gt;
        &lt;xsl:attribute name=&#34;name&#34;&gt;
          &lt;xsl:for-each select=&#34;ancestor-or-self::test-suite/@name&#34;&gt;
            &lt;xsl:value-of select=&#34;concat(., &#39;.&#39;)&#34;/&gt;
          &lt;/xsl:for-each&gt;
        &lt;/xsl:attribute&gt;
        &lt;xsl:apply-templates select=&#34;test-case&#34;/&gt;
      &lt;/testsuite&gt;
      &lt;xsl:apply-templates select=&#34;test-suite&#34;/&gt;
    &lt;/xsl:if&gt;
    &lt;xsl:if test=&#34;not(test-case)&#34;&gt;
      &lt;xsl:apply-templates/&gt;
    &lt;/xsl:if&gt;
  &lt;/xsl:template&gt;

  &lt;xsl:template match=&#34;test-case&#34;&gt;
    &lt;xsl:variable name=&#34;lowerResult&#34; select=&#34;translate(@result,&#39;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#39;, &#39;abcdefghijklmnopqrstuvwxyz&#39;)&#34;/&gt;
    &lt;testcase name=&#34;{@name}&#34; assertions=&#34;{@asserts}&#34; time=&#34;{@duration}&#34; status=&#34;{$lowerResult}&#34; classname=&#34;{@classname}&#34;&gt;
      &lt;xsl:if test=&#34;@runstate = &#39;Skipped&#39; or @runstate = &#39;Ignored&#39;&#34;&gt;
        &lt;skipped/&gt;
      &lt;/xsl:if&gt;
      
      &lt;xsl:apply-templates/&gt;
    &lt;/testcase&gt;
  &lt;/xsl:template&gt;

  &lt;xsl:template match=&#34;command-line&#34;/&gt;
  &lt;xsl:template match=&#34;settings&#34;/&gt;

  &lt;xsl:template match=&#34;output&#34;&gt;
    &lt;system-out&gt;
      &lt;xsl:value-of select=&#34;output&#34;/&gt;
    &lt;/system-out&gt;
  &lt;/xsl:template&gt;

  &lt;xsl:template match=&#34;stack-trace&#34;&gt;
  &lt;/xsl:template&gt;

  &lt;xsl:template match=&#34;test-case/failure&#34;&gt;
    &lt;failure message=&#34;{./message}&#34;&gt;
      &lt;xsl:value-of select=&#34;./stack-trace&#34;/&gt;
    &lt;/failure&gt;
  &lt;/xsl:template&gt;

  &lt;xsl:template match=&#34;test-suite/failure&#34;/&gt;

  &lt;xsl:template match=&#34;test-case/reason&#34;&gt;
    &lt;skipped message=&#34;{./message}&#34;/&gt;
  &lt;/xsl:template&gt;

  &lt;xsl:template match=&#34;test-suite/reason&#34;/&gt;

  &lt;xsl:template match=&#34;properties&#34;/&gt;
&lt;/xsl:stylesheet&gt;
</code></pre><p>And we can use this in a TeamCity runner:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>$xslt = new-object system.xml.xsl.xslcompiledtransform
</span></span><span style="display:flex;"><span>$xslt.load(<span style="color:#e6db74">&#39;%system.teamcity.build.workingDir%\nunit3-junit.xslt&#39;</span>)
</span></span><span style="display:flex;"><span>$xslt.Transform(<span style="color:#e6db74">&#39;%system.teamcity.build.workingDir%\TestResult.xml&#39;</span>, <span style="color:#e6db74">&#39;%system.teamcity.build.workingDir%\TransformedTestResult.xml&#39;</span>)
</span></span><span style="display:flex;"><span>Write-Host <span style="color:#e6db74">&#34;##teamcity[importData type=&#39;junit&#39; path=&#39;TransformedTestResult.xml&#39;]&#34;</span>
</span></span></code></pre></div><p>Which is PowerShell, and so this works well under windows.</p>
<p>But our latest thing is .Net Core in Docker containers on Linux, right? (right?) So we don&rsquo;t have PowerShell available. And it also seems that <a href="https://github.com/dotnet/corefx/issues/5593">there is currently no xslt support in .Net Core</a>, so that option is out. But there is another way:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>apt-get install libsaxon-java
</span></span><span style="display:flex;"><span>saxon-xslt -o TransformedTestResult.xml TestResult.xml nunit3-junit.xslt
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;##teamcity[importData type=&#39;junit&#39; path=&#39;TransformedTestResult.xml&#39;]&#34;</span>
</span></span></code></pre></div><p>You may want to just run the <code>apt-get</code> command on all your agents, rather than putting it into your build step.</p>
<p>And with that, we can publish our test results to TeamCity on Windows and on Linux build agents.</p>
</section>
        
        <section class="share">
            Share: 
            <a class="icon-twitter" href="https://twitter.com/share?text=dotnet%20%2b%20nunit3%20%2b%20TeamCity%20success&url=https%3a%2f%2fblog.csmac.nz%2fpost%2fdotnet%2f"
                onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                <span>Twitter</span>
            </a>
            |
            <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.csmac.nz%2fpost%2fdotnet%2f"
                onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                <span>Facebook</span>
            </a>
        </section>
    </div>
    <div class="content-box">
        
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            var disqus_shortname = d_id; 
            var disqus_title = 'dotnet \u002b nunit3 \u002b TeamCity success';
            
             
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    
    </div>
</article>

<!--Page Content Ends-->

            </div><aside class="sidebar-area">

<!--Sidebar Content Begins-->

                <div class="header-bar-parent sidebar-item">
                    <div class="header-bar header-bar-mastodon">Mastodon</div>
                    
                    
                    <iframe allowfullscreen sandbox="allow-top-navigation allow-scripts" width="280" height="400" src="https://maplefeed.bihlink.com/apiv2/feed?userurl=https%3A%2F%2Fmastodon.nz%2F%2Fusers%2Fcsmacnz&theme=modern-light&size=80&header=true&replies=false&boosts=false"></iframe>
                    
                </div>


                <div class="header-bar-parent sidebar-item">
                    <div class="header-bar header-bar-rss">Subscribe</div>
                    
                    <a href="/rssfeeds/" title="csMACnz's Blog">RSS Feeds</a>
                    <a href="https://feedly.com/i/subscription/feed%2Fhttps%3A%2F%2Ffeeds.feedburner.com%2FcsmacnzBlog" target="_blank" title="csMACnz&amp;#039;s Blog"><img src="https://s3.feedly.com/feedburner/feedly.png" alt="" style="border:0"/></a>
                    <br />
                    <a href="https://www.patreon.com/csMACnz" target="_blank"><img src="/images/patreon.png" /></a>
                    
                    
                </div>


                <div class="header-bar-parent sidebar-item">
                    <div class="header-bar header-bar-xbox">Gamercard</div>
                    

                    <div>
                        <a href="https://www.exophase.com/xbox/user/csMACnz/"><img width="288px" src="https://card.exophase.com/1/1476805.png"></a>
                        <a href="http://steamcommunity.com/id/csMACnz/" target="_blank"><img src="https://www.steamsignature.com/status/english/76561197994712512.png" alt="" title="csMACnz's Steam Profile" /></a>
                    </div>
                    
                </div>


                <div class="header-bar-parent sidebar-item">
                    <div class="header-bar header-bar-ads">Advertisement</div>
                    
                    <div>
                        
                        <ins class="adsbygoogle"
                            style="display:block"
                            data-ad-client="ca-pub-4517187877737982"
                            data-ad-slot="3618449993"
                            data-ad-format="auto"
                            data-full-width-responsive="true"></ins>
                        <script>
                            (adsbygoogle = window.adsbygoogle || []).push({});
                        </script>
                    </div>
                    
                </div>

<!--Sidebar Content Ends-->

            </aside>

            <footer class="footer-area">

            <p>
                Designed and Maintained by Mark Clearwater; Last updated August 2021.
                <!-- This used to be something useful, now it is just a hack I left it to make layout easier but also as a fun reminder for me of what it used to be -->
                <br /><a class="footer-link" >¯\_(ツ)_/¯</a>
            </p>

            </footer>
        </div>

<!--body scripts Begins-->

        
        <script src="/js/highlight.pack.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>

        <script src="/js/codetoggle.js"></script> 

        
        <script src="/js/htmx.min.js"></script>

        
        <script>
            var _gaq = [['_setAccount', g_id], ['_trackPageview']];
            (function (d, t) {
                var g = d.createElement(t), s = d.getElementsByTagName(t)[0];
                g.src = ('https:' == location.protocol ? '//ssl' : '//www') + '.google-analytics.com/ga.js';
                s.parentNode.insertBefore(g, s);
            }(document, 'script'));
        </script>

        <script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>

<!--body scripts Ends-->


<!-------------------------------->
<!--                            -->
<!--  _(\    |@@|               -->
<!-- (__/\__ \--/ __            -->
<!--    \___|----|  |   __      -->
<!--        \ }{ /\ )_ / _\     -->
<!--        /\__/\ \__O (__     -->
<!--       (--/\--)    \__/     -->
<!--       _)(  )(_             -->
<!--      `---''---`            -->
<!--                            -->
<!-- https://github.com/csMACnz -->
<!-------------------------------->

    </body>
</html>
