<!DOCTYPE html>
<html lang="en">
    <head>

        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name='author' content='Mark Clearwater, csmacnz@csmac.co.nz'>
        <meta name='language' content='EN'>
        <meta name='medium' content='blog'>

    
        <title>Thoughts on Testing - csMACnz&#39;s Blog</title>
        <meta name="description" content="I&rsquo;ve gone through the regular evolution when it comes to writing tests.  At first there was no time, didnt bother. This was mostly down to the fact I was building demo apps and samples that got less use than it …">
        <meta name='keywords' content='csMACnz, Editorial, Testing'>

        
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Thoughts on Testing"/>
        <meta property="og:description" content="I&rsquo;ve gone through the regular evolution when it comes to writing tests.  At first there was no time, didnt bother. This was mostly down to the fact I was building demo apps and samples that got less use than it …"/>
        <meta property="og:site_name" content="csMACnz&#39;s Blog"/>
        <meta property="og:url" content="https://blogmigration.csmac.nz/post/thoughts-on-testing/"/>
        <meta property="og:image" content="https://csmac.nz/Content/icon/icon.png"/>

        
        <meta name="twitter:card" content="summary"/>
        <meta name="twitter:title" content="Thoughts on Testing"/>
        <meta name="twitter:description" content="I&rsquo;ve gone through the regular evolution when it comes to writing tests.  At first there was no time, didnt bother. This was mostly down to the fact I was building demo apps and samples that got less use than it …"/>
        <meta name="twitter:image" content="https://csmac.nz/Content/icon/icon.png"/>
        <meta name="twitter:site" content="@csMACnz"/>
        <meta name="twitter:creator" content="@csMACnz"/>
    

        <link rel="apple-touch-icon-precomposed" href="/images/icon/apple-touch-icon-precomposed.png">
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/icon/apple-touch-icon-72x72-precomposed.png">
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/icon/apple-touch-icon-114x114-precomposed.png">
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/icon/apple-touch-icon-144x144-precomposed.png">
        <link rel="icon" type="image/png" href="/images/icon/icon.png" />
        <link rel='me' type='text/html' href='https://github.com/csMACnz'>

        <script>
            var d_id  = 'csmacnz',
                g_id  = 'UA-18464866-2',
                g_url = 'auto';
        </script>

        <link rel="stylesheet" type="text/css" href="/css/style.css" />
        <link rel="stylesheet" type="text/css" href="/css/blogstyle.css" />

        <link rel="alternate stylesheet" title="dark-code" type="text/css" href="/css/solarized_dark.css" disabled>
        <link rel="stylesheet" title="light-code" type="text/css" href="/css/github-gist.css" disabled>

        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4517187877737982"
        crossorigin="anonymous"></script>

        
        
        <script type="application/ld+json">
        {
            "@context" : "https://schema.org",
            "@type" : "Article",
            "publisher": {
                "@type": "Organization",
                "name": "csMACnz&#x27;s Blog",
                "logo": "https:\/\/blogmigration.csmac.nz\/images\/icon\/apple-touch-icon-144x144-precomposed.png"
            },
            "author": {
                "@type": "Person",
                "name": "Mark Clearwater",
                "image": {
                    "@type": "ImageObject",
                    "url": "//www.gravatar.com/avatar/c97410951ec3738a3fd4a2dfb17a5d9c?d=404&s=250",
                    "width": 440,
                    "height": 295
                },
                "url": "https:\/\/blogmigration.csmac.nz",
                "sameAs": [
                    "https://csmac.nz"
                ]
            },
            "articleSection" : "post",
            "name" : "Thoughts on Testing",
            "headline" : "Thoughts on Testing",
            "url" : "https:\/\/blogmigration.csmac.nz\/post\/thoughts-on-testing\/",
            "datePublished": "2015-01-04T19:57:02.000Z",
            "dateModified" : "2015-01-04T19:57:02.000Z",
            "keywords" : [ "Editorial", "Testing" ]
            "description" : "I\u0026rsquo;ve gone through the regular evolution when it comes to writing tests. At first there was no time, didnt bother. This was mostly down to the fact I was building demo apps and samples that got less use than it took to build them, working with senior devs who had made their name making said apps.\nThe next stage is reluctant acceptance. The team I was put on wrote tests, so I guess I should too.",
            "mainEntityOfPage": {
                "@type": "WebPage",
                "@id": "https:\/\/blogmigration.csmac.nz"
            }
            "inLanguage" : "en-US",
            "author" : "Mark Clearwater",
            "creator" : "Mark Clearwater",
            "accountablePerson" : "Mark Clearwater",
            "copyrightHolder" : "Mark Clearwater",
            "copyrightYear" : "2015",
            "wordCount" : "1170",
        }
        </script>
        
        
        
    </head>
    <body class="blog">
        <div class="page-area">

            <header class="header-area">
                <h1 class="header-area-title">csMACnz</h1>
            </header>
            <nav class="navigation-area header-bar-parent">
                <div class="header-bar header-bar-blog">
                    <ul class="menu">
                        <li class="menu-item"><a class="menu-item-content" href="https://csmac.nz">Home</a></li>
                        <li class="menu-item"><a class="menu-item-content" href="https://csmac.nz/BaconVaders">Bacon Vaders</a></li>
                        <li class="menu-item"><a class="menu-item-content CurrentButton" href="/">Blog</a></li>
                    </ul>
                </div>
            </nav>

            <div id="content" class="content-area">

<!--Page Content Begins-->

<article>
    <div class="content-box" itemscope itemtype=" https://schema.org/Article">
    
        <span class="post-meta"><time datetime="2015-01-04"  itemprop="datePublished">04 Jan 15</time> on <a href="/tags/editorial">Editorial</a>,  <a href="/tags/testing">Testing</a></span>
    
        <h1 class="post-title" itemprop="headline">Thoughts on Testing</h1>
    
        <section class="post-content"  itemprop="articleBody">
            <p>I&rsquo;ve gone through the regular evolution when it comes to writing tests.  At first there was no time, didnt bother. This was mostly down to the fact I was building demo apps and samples that got less use than it took to build them, working with senior devs who had made their name making said apps.</p>
<p>The next stage is reluctant acceptance. The team I was put on wrote tests, so I guess I should too. In fact, it was more of a requirement, with code coverage metrics driving how many tests we write.  The tests written at this stage were horrible, too many dependancies, lots of mocks, lots of setup, and code deplication. Very fragile tests, some even depended on databases, real-world time, all that crazy stuff.</p>
<p>Finally after a while the penny dropped, and testing is making sense.  Some of the big lessons that had to be realised where the following:</p>
<ul>
<li>Tests need to assert one atomic thing.</li>
<li>Test names need to explain what is being tested.</li>
<li>Arrange, Act, Assert.</li>
<li>Tests are code. Refactor it, remove duplication.</li>
<li>Unit Tests have no external dependancies.</li>
<li>Integration Tests compliment unit tests.</li>
<li>User Automation tests are valuable and catch different issues.</li>
<li>TDD is not about writing tests.</li>
</ul>
<p>So let&rsquo;s take a look at some of these points in details.</p>
<h4 id="what-is-a-unit-test">What is a &lsquo;unit&rsquo; test?</h4>
<p>At first, I thought out tests were too big, they seemed to be testing a lot in one test. Then I realised most of the code in the test class in question was mocking, setup and preparation.  Why?  Well the main reason is the object we are testing has several dependencies, and they all needed to be mocked and faked, so that we could test this class as a unit.</p>
<p>for example, lets say we have a class, and it takes 4 services (should be enough to make a point).</p>
<pre><code class="language-cs">public class CustomerService {
    ...
    public CustomerService(IEmployeeRepository employeeRepository,
                           ICustomerRepository customerRepository,
                           ISecurityProvider securityProvider,
                           IInternationalisationProvider internationalisationProvider)
    {
    ...
    }

    public void Process(Customer newCustomer) {
    ...
    }
}
</code></pre>
<p>We want to test this method, with mocking, we might end up with a setup like:</p>
<pre><code class="language-cs">[TestInitialise]
public void Setup() 
{
    _employeeRepositoryMock = new Mock&lt;IEmployeeRepository&gt;();
    _employeeRepositoryMock
        .Setup(er =&gt; er.FindEmployeeRecord(It.Is&lt;Guid&gt;(TEST_USER_ID)))
        .Returns(CreateTestCustomerEmployeeRecord());
	_employeeRepositoryMock
        .Setup(er =&gt; er.LoadEmployeeTypes())
        .Returns(CreateEmployeeTypeData());
	_employeeRepositoryMock
        .Setup(er =&gt; er.CreateNewEmployeeRecord(It.Is&lt;Guid&gt;(TEST_USER_ID), It.IsAny&lt;CustomerEmployeeRecord&gt;()))
        .Returns(CreateDefaultSuccessResultForCreateEmployeeRecord());

    _customerRepositoryMock = new Mock&lt;ICustomerRepository&gt;();
    _customerRepositoryMock
        .Setup(er =&gt; er.GetCustomer(It.Is&lt;Guid&gt;(TEST_USER_ID)))
        .Returns(CreateTestCustomer());
     ...        
    _customerServiceMock = new Mock&lt;ISecurityProvider&gt;();
     ...
    _internationalisationProviderMock = new Mock&lt;IInternationalisationProvider&gt;()
     ...
}
</code></pre>
<p>And you could imagine with more dependencies what else could crop up, not to mention the code that appears inside the tests themselves.</p>
<p>This is where the lesson is. Well, two lessons:</p>
<ul>
<li>Try to minimise your dependencies so they are easier to mock, stub and fake.</li>
<li>If several classes are heavily dependent for testing, they might make up a single unit.</li>
</ul>
<p>The trick seems to be defining the size of testable units, and clearly defining the unit dependency boundaries.  Sometimes the bulk of the actual logic can pull pulled out completely and tested in a more functional way, with data passed in, data returned. A lot less of these internal dependencies that you have to mock, the retrieval of data is all through the inputs of the function or class instead.</p>
<h4 id="the-three-as">The three A&rsquo;s</h4>
<p>Tests need to be made up of three steps. each step should try and be only one or two actions.</p>
<p><em>Arrange</em>: coordinate some setup for your test. This might be in the test method itself, creating an instance of the unit under test. This might be in the constructor, or per-test setup method. Having a lot of setup for a test is a code smell.</p>
<p><em>Act</em>: perform the task that is being tested. Maybe a static method, or method on your unit under test. This should be a single atomic action, from your system code would be expected.</p>
<p><em>Assert</em>: confirm that the state of play after acting is what is expected. Check the result of the method has the correct state, or check the state of the unit under test has been modified correctly.  Again, assert one thing. It might take multiple assert statements, but they should represent a single atomic state.</p>
<pre><code class="language-cs">[Test]
public void CustomerService_CreateNewCalledWithValidCustomer_NoProblemsOccur()
{
    //Arrange
    var sut = CreateService();
    var newCustomer = GetValidCustomer();
    
    //Act
    var saveResponse = sut.CreateNew(newCustomer);
    
    //Assert
    Assert.True(saveResponse.Successful);
    Assert.Empty(saveResponse.Warnings);
}
</code></pre>
<p>Personally I don&rsquo;t like having the comments in there, but spacing my test methods into the three sections make it much clearer to read what is happening at each stage, and what is the Act part.</p>
<h4 id="test-code-is-code">Test code is code</h4>
<p>The quality of test code is appalling.  Yeah, this is an over-generalisation. I should be clearer and say, the quality of the code people write when they start writing tests is appalling.  I&rsquo;m guilty of it, and I&rsquo;ve seen it with other people when they start out writing tests.  Now this could be a localised issue and be related to the testing and mocking frameworks &lsquo;éxperienced&rsquo; testers use in .Net, and the inherent complexity they introduce. The other thing it could be, and the one I&rsquo;m conscious of, is that people don&rsquo;t seem to treat test code with the same respect they do the rest of the code in their application.  Quality, standards and best practice goes out the window, it seems, when they write their test code. Follow the rules and everything gets better fast. SOLID anyone?</p>
<h4 id="automated-ui-testing">Automated UI Testing</h4>
<p>This is a whole topic in itself, so I will have to post something more in depth about this later, but the punchline is Automated UI Tests abstract functionality from implementation detail.  Yes, we couple to design decisions still, but done right UI test can abstract over the design and still focus on the functionality.  This makes these tests less fragile and prone to change based on refactoring implementations.  Something that unit and integration tests often struggle with (albeit because of the way we probably architect that test code in the first place). Having these tests in place gives you the most bang for your buck, since we know that the UI does (or doesn&rsquo;t if the tests fail) allow the user to perform the operation/task the test runs through. This covers all the moving parts involved in that action from client application code all the way to persistence.  Yes, these are integration tests in a way, but the Black-Box nature gives them their most value, not to mention they do exactly what the user does, not an approximation of it. Of course you should still complement this with unit tests over logic and integration tests at other points in your system as well (APIs, modules/components etc).</p>
<h4 id="conclusion">Conclusion</h4>
<p>So what have I learned? Well, the main thing is that there is much more to learn.  And like becoming a better developer in general, it&rsquo;s all about practice, observe, improve. Everyone takes their own journey, but the lessons learned take us all to a similar destination in the end:  write more tests, improve the quality of your code and applications.</p>
<p>Thanks <a href="https://twitter.com/saramgsilva">@saramgsilva</a> for <a href="https://twitter.com/saramgsilva/status/552031440607920129">suggesting I add some code samples</a> to this post.</p>
</section>
        
        <section class="share">
            Share: 
            <a class="icon-twitter" href="https://twitter.com/share?text=Thoughts%20on%20Testing&url=https%3a%2f%2fblogmigration.csmac.nz%2fpost%2fthoughts-on-testing%2f"
                onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                <span>Twitter</span>
            </a>
            |
            <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fblogmigration.csmac.nz%2fpost%2fthoughts-on-testing%2f"
                onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                <span>Facebook</span>
            </a>
        </section>
    </div>
    <div class="content-box">
        
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            var disqus_shortname = d_id; 
            var disqus_title = 'Thoughts on Testing';
            
             
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    
    </div>
</article>

<!--Page Content Ends-->

            </div><aside class="sidebar-area">

<!--Sidebar Content Begins-->

                <div class="header-bar-parent sidebar-item">
                    <div class="header-bar header-bar-twitter">Twitter</div>
                    
                    <a class="twitter-timeline" data-lang="en" data-height="510" data-dnt="true" href="https://twitter.com/csMACnz?ref_src=twsrc%5Etfw">Tweets by csMACnz</a> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
                    
                </div>


                <div class="header-bar-parent sidebar-item">
                    <div class="header-bar header-bar-rss">Subscribe</div>
                    
                    <a href="/rssfeeds/" title="csMACnz's Blog">RSS Feeds</a>
                    <a href="https://feedly.com/i/subscription/feed%2Fhttps%3A%2F%2Ffeeds.feedburner.com%2FcsmacnzBlog" target="_blank" title="csMACnz&amp;#039;s Blog"><img src="https://s3.feedly.com/feedburner/feedly.png" alt="" style="border:0"/></a>
                    <a href="https://feeds.feedburner.com/csmacnzBlog" target="_blank"><img src="https://feeds.feedburner.com/~fc/csmacnzBlog?bg=fabb45&amp;fg=4B4B4B&amp;anim=1" height="26" width="88" style="border:0" alt="" /></a>
                    <br />
                    <a href="https://www.patreon.com/csMACnz" target="_blank"><img src="/images/patreon.png" /></a>
                    
                    
                </div>


                <div class="header-bar-parent sidebar-item">
                    <div class="header-bar header-bar-xbox">Gamercard</div>
                    

                    <div>
                        <a href="https://www.exophase.com/xbox/user/csMACnz/"><img width="288px" src="https://card.exophase.com/1/1476805.png"></a>
                        <a href="http://steamcommunity.com/id/csMACnz/" target="_blank"><img src="https://www.steamsignature.com/status/english/76561197994712512.png" alt="" title="csMACnz's Steam Profile" /></a>
                    </div>
                    
                </div>


                <div class="header-bar-parent sidebar-item">
                    <div class="header-bar header-bar-ads">Advertisement</div>
                    
                    <div>
                        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4517187877737982"
                            crossorigin="anonymous"></script>
                        
                        <ins class="adsbygoogle"
                            style="display:block"
                            data-ad-client="ca-pub-4517187877737982"
                            data-ad-slot="3618449993"
                            data-ad-format="auto"
                            data-full-width-responsive="true"></ins>
                        <script>
                            (adsbygoogle = window.adsbygoogle || []).push({});
                        </script>
                    </div>
                    
                </div>

<!--Sidebar Content Ends-->

            </aside>

            <footer class="footer-area">

            <p>
                Designed and Maintained by Mark Clearwater; Last updated August 2021.
                <!-- This used to be something useful, now it is just a hack I left it to make layout easier but also as a fun reminder for me of what it used to be -->
                <br /><a class="footer-link" >¯\_(ツ)_/¯</a>
            </p>

            </footer>
        </div>

<!--body scripts Begins-->

        
        <script src="/js/highlight.pack.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>

        <script src="/js/codetoggle.js"></script> 

        
        <script>
            var _gaq = [['_setAccount', g_id], ['_trackPageview']];
            (function (d, t) {
                var g = d.createElement(t), s = d.getElementsByTagName(t)[0];
                g.src = ('https:' == location.protocol ? '//ssl' : '//www') + '.google-analytics.com/ga.js';
                s.parentNode.insertBefore(g, s);
            }(document, 'script'));
        </script>

        <script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>

<!--body scripts Ends-->


<!-------------------------------->
<!--                            -->
<!--  _(\    |@@|               -->
<!-- (__/\__ \--/ __            -->
<!--    \___|----|  |   __      -->
<!--        \ }{ /\ )_ / _\     -->
<!--        /\__/\ \__O (__     -->
<!--       (--/\--)    \__/     -->
<!--       _)(  )(_             -->
<!--      `---''---`            -->
<!--                            -->
<!-- https://github.com/csMACnz -->
<!-------------------------------->

    </body>
</html>
