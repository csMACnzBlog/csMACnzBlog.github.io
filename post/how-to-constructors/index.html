<!DOCTYPE html>
<html lang="en">
    <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name='author' content='Mark Clearwater, csmacnz@csmac.co.nz'>
    <meta name='language' content='EN'>
    <meta name='medium' content='blog'>


    <title>How to Constructors - csMACnz&#39;s Blog</title>
    <meta name="description" content="Constructors for services are a really handy way to pass in configuration, variation and dependencies. Here are some ways I have learned to use Constructors and some ideas on testing. What shouldn&rsquo;t be in a …">
    <meta name='keywords' content='csMACnz, c#, software development'>

    
    <meta property="og:type" content="article"/>
    <meta property="og:title" content="How to Constructors"/>
    <meta property="og:description" content="Constructors for services are a really handy way to pass in configuration, variation and dependencies. Here are some ways I have learned to use Constructors and some ideas on testing. What shouldn&rsquo;t be in a …"/>
    <meta property="og:site_name" content="csMACnz&#39;s Blog"/>
    <meta property="og:url" content="https://csmacnzblog.github.io/post/how-to-constructors/"/>
    <meta property="og:image" content="http://csmac.nz/Content/icon/icon.png"/>

    
    <meta name="twitter:card" content="summary"/>
    <meta name="twitter:title" content="How to Constructors"/>
    <meta name="twitter:description" content="Constructors for services are a really handy way to pass in configuration, variation and dependencies. Here are some ways I have learned to use Constructors and some ideas on testing. What shouldn&rsquo;t be in a …"/>
    <meta name="twitter:image" content="http://csmac.nz/Content/icon/icon.png"/>
    <meta name="twitter:site" content="@csMACnz"/>
    <meta name="twitter:creator" content="@csMACnz"/>


    <link rel="apple-touch-icon-precomposed" href="/images/icon/apple-touch-icon-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/icon/apple-touch-icon-72x72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/icon/apple-touch-icon-114x114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/icon/apple-touch-icon-144x144-precomposed.png">
    <link rel="icon" type="image/png" href="/images/icon/icon.png" />
    <link rel='me' type='text/html' href='https://github.com/csMACnz'>

    <script>
        var d_id  = 'csmacnz',
            g_id  = 'UA-18464866-2',
            g_url = 'auto';
    </script>

    <link rel="stylesheet" type="text/css" href="/css/style.css" />
    <link rel="stylesheet" type="text/css" href="/css/blogstyle.css" />

    <link rel="alternate stylesheet" title="dark-code" type="text/css" href="/css/solarized_dark.css" disabled>
    <link rel="stylesheet" title="light-code" type="text/css" href="/css/github-gist.css" disabled>

    <!-- ENTERING partial seo-schema.html -->
    
    
    <script type="application/ld+json">
    {
        "@context" : "https://schema.org",
        "@type" : "Article",
        "publisher": {
            "@type": "Organization",
            "name": "csMACnz&#x27;s Blog",
            "logo": "https://blog.csmac.nz/content/images/2014/10/apple-touch-icon-144x144-precomposed.png"
        },
        "author": {
            "@type": "Person",
            "name": "Mark Clearwater",
            "image": {
                "@type": "ImageObject",
                "url": "//www.gravatar.com/avatar/c97410951ec3738a3fd4a2dfb17a5d9c?d=404&s=250",
                "width": 440,
                "height": 295
            },
            "url": "https://blog.csmac.nz/author/csmacnz/",
            "sameAs": [
                "http://csmac.nz"
            ]
        },
        "articleSection" : "post",
        "name" : "How to Constructors",
        "headline" : "How to Constructors",
        "url" : "https:\/\/csmacnzblog.github.io\/post\/how-to-constructors\/",
        "datePublished": "2017-01-16T02:44:32.000Z",
        "dateModified" : "2017-01-16T02:44:32.000Z",
        "image" : {
            "@type": "ImageObject",
            "url": "http:\/\/res.cloudinary.com\/csmacnz\/image\/upload\/c_scale,w_440\/v1484323800\/pexels-photo-209177_engogw.jpg",
            "width": 440,
            "height": 295
        },
        "keywords" : [ "c#", "software development" ]
        "description" : "Constructors for services are a really handy way to pass in configuration, variation and dependencies. Here are some ways I have learned to use Constructors and some ideas on testing.\nWhat shouldn\u0026rsquo;t be in a Constructor Execution. Any complex execution of code should not be in a constructor. This includes asynchronous method calls (which either has to block synchronously, or runs off to nowhere), web requests, and complex calculations.\nWhy? Why not run your whole application in a constructor?",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https://blog.csmac.nz/"
        }
        "inLanguage" : "en-US",
        "author" : "Mark Clearwater",
        "creator" : "Mark Clearwater",
        "accountablePerson" : "Mark Clearwater",
        "copyrightHolder" : "Mark Clearwater",
        "copyrightYear" : "2017",
        "wordCount" : "1144",
    }
    </script>
    
    
    <!-- LEAVING partial seo-schema.html -->

    <link rel="alternate" type="application/rss+xml" title="csMACnz&#x27;s Blog" href="https://blog.csmac.nz/rss/" />
    <style>
        .post-content img {
            max-width: 500px;
        }
    </style>
    </head>
    <body class="blog">
        <div class="page-area"><header class="header-area">
    <h1 class="header-area-title">csMACnz</h1>
</header>
<nav class="navigation-area header-bar-parent">
    <div class="header-bar header-bar-blog">
        <ul class="menu">
            <li class="menu-item"><a class="menu-item-content" href="http://csmac.nz">Home</a></li>
            <li class="menu-item"><a class="menu-item-content" href="http://csmac.nz/BaconVaders">Bacon Vaders</a></li>
            <li class="menu-item"><a class="menu-item-content CurrentButton" href="/">Blog</a></li>
        </ul>
    </div>
</nav><div id="content" class="content-area">
            
<article>
    <div class="content-box" itemscope itemtype="http://schema.org/Article">
    
        <span class="post-meta"><time datetime="2017-01-16"  itemprop="datePublished">16 Jan 17</time> on
            <a href="https://csmacnzblog.github.iotags/c">c#</a><a href="https://csmacnzblog.github.iotags/software-development">software development</a>
        </span>
    
        <h1 class="post-title" itemprop="headline">How to Constructors</h1>
    
        <section class="post-content"  itemprop="articleBody">
            <img class="post-image" src="http://res.cloudinary.com/csmacnz/image/upload/c_scale,w_440/v1484323800/pexels-photo-209177_engogw.jpg"><p>Constructors for services are a really handy way to pass in configuration, variation and dependencies. Here are some ways I have learned to use Constructors and some ideas on testing.</p>
<h3 id="what-shouldnt-be-in-a-constructor">What shouldn&rsquo;t be in a Constructor</h3>
<p><strong>Execution.</strong>  Any complex execution of code should not be in a constructor. This includes asynchronous method calls (which either has to block synchronously, or runs off to nowhere), web requests, and complex calculations.</p>
<p>Why? Why not run your whole application in a constructor?  Well, when you are reading code, you wouldn&rsquo;t expect much work to be done in a constructor. So the reality wouldn&rsquo;t match your expectations. Stick with the conventions of the language so that you do not surprise the reader of your code. Another reason is that the object initialisation phase may happen outside of your application code. If you are following IOC or using a DI container, you may find you have no control over the construction of your objects, where it runs or what gets provided.</p>
<p><strong>Parsing.</strong>
You probably also want to keep complex parsing out of constructors too. Don&rsquo;t pass in a string and deserialise as <code>XML</code> or <code>json</code>, but instead parse first, and then pass in the resulting data object. This will make it easier to use and test parsing separate from the responsibilities of this class.</p>
<p><strong>Constructors.</strong> What else shouldn&rsquo;t be in constructors? Well, potentially other constructors. If you want to adjust how that object is constructed, or use the <a href="https://en.wikipedia.org/wiki/Liskov_substitution_principle">liskov substitution principle</a> to swap dependencies out for different implementations, you would be stuck. This is less of a strict rule, and I will cover the exceptions to it later on.</p>
<h3 id="so-what-should">So what should?</h3>
<p>Constructors work well having the general dependencies(other services) of the object passed in (if it is a service) and any settings values the object requires (or mandatory values in the case of a data object). With the services, it often helps when they are interfaces rather than concrete types, too.</p>
<p>I said general. If there are one or two actions that need a particular service, and there are 15 others that do not, I might suggest that those one or two methods should either be part of another class, should take that dependency as a method parameter instead, or better yet, they may just need to return a calculated result, and let the caller use that result to make its own call, removing the need for the dependency at all.</p>
<p>That last bit probably needs an example.</p>
<h3 id="an-example">An Example</h3>
<p>Suppose we have the following code:</p>
<pre><code>public class WidgetService
{
    private readonly IReviewSubmitService _rss;
    public WidgetService(IReviewSubmitService rss)
    {
        _rss = rss;
    }

    //15 other methods that do not use _rss

    public void PostUsageReport()
    {
        DataPackage data;
        //Some code generating a DataPackage
        _rss.PostReport(data);
    }
}
</code></pre>
<p>A better solution would be to refactor to the following:</p>
<pre><code>public class WidgetService
{
    public WidgetService()
    {
        //No more need to pass a ReviewSubmitService
    }

    //15 other methods that do not use _rss

    public DataPackage GenerateUsageReport()
    {
        DataPackage data;
        //Some code generating a DataPackage
        //no longer call _rss;
        return data;
    }
}

var dataReport = _widgetService.GenerateUsageReport();
_rss.PostReport(dataReport);
</code></pre>
<p>For those paying attention, this is also a more functional way of programming. More generally, we refactor code flow so instead of <code>A=&gt;B=&gt;C=&gt;D</code> we have <code>A=&gt;B, A=&gt;C, A=&gt;D</code>. The dependencies are much less coupled from either other.</p>
<h3 id="the-servicelocator-pattern">The ServiceLocator Pattern</h3>
<p>Myself (and many others) absolutely hate the ServiceLocator pattern. But it is often thrust upon us as we work on legacy applications or with mis-informed technical leads. But that is another article. In this instance, I will take the stance that you have to use ServiceLocator.  Here is a typical (in my opinion WRONG) example of a constructor:</p>
<pre><code>public class WidgetService
{
    private readonly IReviewSubmitService _rss;
    private readonly IRepositoryServiceFactory _rsf;
    private readonly IOptimisedMarkupGenerator _omg;

    public WidgetService()
    {
        _rss = ServiceLocator.Resolve&lt;IReviewSubmitService&gt;();
        _rsf = ServiceLocator.Resolve&lt;IRepositoryServiceFactory&gt;();
        _omg = ServiceLocator.Resolve&lt;IOptimisedMarkupGenerator&gt;();
    }
}
</code></pre>
<p>and now the good example:</p>
<pre><code>public class WidgetService
{
    private readonly IReviewSubmitService _reviewSubmitService;
    private readonly IRepositoryServiceFactory _repositoryServiceFactory;
    private readonly IOptimisedMarkupGenerator _optimisedMarkupGenerator;

    public WidgetService()
        this(
            ServiceLocator.Resolve&lt;IReviewSubmitService&gt;(),
            ServiceLocator.Resolve&lt;IRepositoryServiceFactory&gt;(),
            ServiceLocator.Resolve&lt;IOptimisedMarkupGenerator&gt;()
        )
    {
    }

    public WidgetService(
        IReviewSubmitService reviewSubmitService,
        IRepositoryServiceFactory repositoryServiceFactory,
        IOptimisedMarkupGenerator optimisedMarkupGenerator
    )
    {
        _reviewSubmitService = reviewSubmitService;
        _repositoryServiceFactory = repositoryServiceFactory;
        _optimisedMarkupGenerator= optimisedMarkupGenerator
    }
}
</code></pre>
<p>(I know I need another post around that formatting too&hellip;)</p>
<p>So what has changed? The main difference is that you <em>can</em> inject different implementations of the interfaces, without needing to configure a static ServiceLocator. <strong>Big Win.</strong> This dual constructor setup shown in this example has the following benefits:</p>
<ul>
<li>You can pass dependencies into the instance. For example, from Unit Tests.</li>
<li>The ServiceLocator can be still be used at runtime to ensure the right implementation can be resolved.</li>
<li>If you have a container that can inject instances, it will do so for you, picking the more complex constructor to use. This gives you a migration away from ServiceLocator going forward.</li>
<li>This almost makes ServiceLocator, since you can just ignore the default constructor, and the class looks more <a href="https://en.wikipedia.org/wiki/SOLID_(object-oriented_design)">SOLID</a>.</li>
</ul>
<h3 id="validation">Validation</h3>
<p>Something that is also helpful, to avoid the dreaded latent <code>ObjectNullReferenceException</code>, is to validate your inputs. Check they are within the valid range at the first opportunity:</p>
<p>(only showing the constructor for simplicity.)</p>
<pre><code>    public WidgetService(
        IReviewSubmitService reviewSubmitService,
        IRepositoryServiceFactory repositoryServiceFactory,
        IOptimisedMarkupGenerator optimisedMarkupGenerator,
        int someIndex
    )
    {
        if(reviewSubmitService == null) throw new ArgumentNullException(nameof(reviewSubmitService));
        if(repositoryServiceFactory == null) throw new ArgumentNullException(nameof(repositoryServiceFactory));
        if(optimisedMarkupGenerator == null) throw new ArgumentNullException(nameof(optimisedMarkupGenerator));
        if(someIndex &lt; 0) throw new OutOfRangeException($&quot;'{nameof(someIndex)}' must be a positive number.&quot;);

        _reviewSubmitService = reviewSubmitService;
        _repositoryServiceFactory = repositoryServiceFactory;
        _optimisedMarkupGenerator= optimisedMarkupGenerator
    }
</code></pre>
<p>Validate your arguments at construction time, and you will always find your <code>null</code> references and out of range values as soon as they appear and not deep down during a complex method execution, or worse, down the road when invalid data is read back from a database.</p>
<h3 id="multiple-settings">Multiple Settings</h3>
<pre><code>    public WidgetService(
        int index,
        int length,
        string moduleName,
        decimal conversion
    )
    {
        _index = index;
        _length = length;
        _moduleName = moduleName;
        _conversion = conversion;
    }
</code></pre>
<p>We have several values being passed in. During development it is likely we will be adding/removing the types and numbers of variables passed in. Lets encompass these in a datatype so that it is more maintainable, since we can foresee the usefulness of this.</p>
<pre><code>public class WidgetServiceSettings
{
        public int Index { get; set; }
        public int Length { get; set; }
        public string ModuleName { get; set; }
        public decimal Conversion { get; set; }
}
</code></pre>
<pre><code>    public WidgetService(
        WidgetServiceSettings settings,
    )
    {
        _settings = settings;
    }
</code></pre>
<p>Now the constructor won&rsquo;t have to change, as we add and remove extra settings required by the service, and it&rsquo;s various related methods.  Image the benifit this has when you have a mixture of Settings values and Services passed into the constructor if we didn&rsquo;t do this?</p>
<h3 id="wrapup">Wrapup</h3>
<p>A brief overview of my thoughts on Constructors. Hopefully these behaviours help make your code more composable, more testable, and more readable.</p>
<p>Did I miss something? Let me know.</p>
</section>
        
        <section class="share">
            Share: 
            <a class="icon-twitter" href="http://twitter.com/share?text=How%20to%20Constructors&url=https%3a%2f%2fcsmacnzblog.github.io%2fpost%2fhow-to-constructors%2f"
                onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                <span>Twitter</span>
            </a>
            |
            <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fcsmacnzblog.github.io%2fpost%2fhow-to-constructors%2f"
                onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                <span>Facebook</span>
            </a>
        </section>
    </div>
    <div class="content-box">
        
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            var disqus_shortname = d_id; 
            var disqus_title = 'How to Constructors';
            
             
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    
    </div>
</article>

        </div><aside class="sidebar-area">
            <div class="header-bar-parent sidebar-item">
                <div class="header-bar header-bar-twitter">Twitter</div>
                
                <a class="twitter-timeline" style="display: block; text-align: center;" href="https://twitter.com/csmacnz" data-widget-id="523634688984772608">Tweets by @@csmacnz</a>
                <script>!function (d, s, id) { var js, fjs = d.getElementsByTagName(s)[0], p = /^http:/.test(d.location) ? 'http' : 'https'; if (!d.getElementById(id)) { js = d.createElement(s); js.id = id; js.src = p + "://platform.twitter.com/widgets.js"; fjs.parentNode.insertBefore(js, fjs); } }(document, "script", "twitter-wjs");</script>
                
            </div>
            <div class="header-bar-parent sidebar-item">
                <div class="header-bar header-bar-rss">Subscribe</div>
                
                <a class="email-subscribe-link" href="https://feedburner.google.com/fb/a/mailverify?uri=csmacnzBlog&amp;loc=en_US">Subscribe to csMACnz's Blog by Email</a>
                <a href="http://add.my.yahoo.com/rss?url=http://feeds.feedburner.com/csmacnzBlog" title="csMACnz&amp;#039;s Blog"><img src="http://us.i1.yimg.com/us.yimg.com/i/us/my/addtomyyahoo4.gif" alt="" style="border:0"/></a>
                <a href="http://feedly.com/#subscription/feed/http://feeds.feedburner.com/csmacnzBlog" title="csMACnz&amp;#039;s Blog"><img src="http://s3.feedly.com/feedburner/feedly.png" alt="" style="border:0"/></a>
                <a href="http://www.netvibes.com/subscribe.php?url=http://feeds.feedburner.com/csmacnzBlog"><img src="http://www.netvibes.com/img/add2netvibes.gif" width="91" height="17" alt="Add to netvibes" style="border:0" /></a>
                <a href="http://feeds.feedburner.com/csmacnzBlog"><img src="http://feeds.feedburner.com/~fc/csmacnzBlog?bg=fabb45&amp;fg=4B4B4B&amp;anim=1" height="26" width="88" style="border:0" alt="" /></a>
                <br />
                <a href="https://www.patreon.com/csMACnz" target="_blank"><img src="/images/patreon.png" /></a>
                
                
            </div>
            <div class="header-bar-parent sidebar-item">
                <div class="header-bar header-bar-xbox">Gamercard</div>
                

                <div style="margin: 0 auto; width:201px;">
                    <iframe src="//gamercard.xbox.com/csMACnz.card" scrolling="no" frameborder="0" height="136px" width="201px">AutomatonMan</iframe>
                </div>
                <a href="http://steamcommunity.com/id/csMACnz/" target="_blank"><img src="http://steamsignature.com/status/english/76561197994712512.png" alt="" title="csMACnz's Steam Profile" /></a>
                
            </div>
            <div class="header-bar-parent sidebar-item">
                <div class="header-bar header-bar-ads">Advertisement</div>
                
                <div>
                    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
                    
                    <ins class="adsbygoogle"
                         style="display:block"
                         data-ad-client="ca-pub-4517187877737982"
                         data-ad-slot="7632444699"
                         data-ad-format="auto"></ins>
                    <script>
                    (adsbygoogle = window.adsbygoogle || []).push({});
                    </script>
                </div>
                
            </div>
        </aside>
        
        <footer class="footer-area"><p>
    Designed and Maintained by Mark Clearwater; Last updated June 2015.
    <br /><a class="footer-link" >Hi</a>
</p></footer>
    </div>
    
    
    <script src="/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    
    <script src="/js/codetoggle.js"></script> 

    
    <script>
        var _gaq = [['_setAccount', g_id], ['_trackPageview']];
        (function (d, t) {
            var g = d.createElement(t), s = d.getElementsByTagName(t)[0];
            g.src = ('https:' == location.protocol ? '//ssl' : '//www') + '.google-analytics.com/ga.js';
            s.parentNode.insertBefore(g, s);
        }(document, 'script'));
    </script>

    <script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
    </body>
</html>
