<!DOCTYPE html>
<html lang="en">
    <head>

        <script>
            if(!/blog\.csmac\.nz/.test(window.location.host)) {
                window.location = "https:\/\/blog.csmac.nz\/post\/git-housekeeping\/";
            }
        </script>

        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name='author' content='Mark Clearwater, csmacnz@csmac.co.nz'>
        <meta name='language' content='EN'>
        <meta name='medium' content='blog'>
        <meta name="google-adsense-account" content="ca-pub-4517187877737982">

    
        <title>Git Housekeeping - csMACnz&#39;s Blog</title>
        <meta name="description" content="Those who are using Git but still new to the concept will no doubt have realised that files are treated differently to normal source control tools, and that they transition between different known states, according to …">
        <meta name='keywords' content='csMACnz, git'>

        
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Git Housekeeping"/>
        <meta property="og:description" content="Those who are using Git but still new to the concept will no doubt have realised that files are treated differently to normal source control tools, and that they transition between different known states, according to …"/>
        <meta property="og:site_name" content="csMACnz&#39;s Blog"/>
        <meta property="og:url" content="https://blog.csmac.nz/post/git-housekeeping/"/>
        <meta property="og:image" content="https://csmac.nz/Content/icon/icon.png"/>

        
        <meta name="twitter:card" content="summary"/>
        <meta name="twitter:title" content="Git Housekeeping"/>
        <meta name="twitter:description" content="Those who are using Git but still new to the concept will no doubt have realised that files are treated differently to normal source control tools, and that they transition between different known states, according to …"/>
        <meta name="twitter:image" content="https://csmac.nz/Content/icon/icon.png"/>
        <meta name="twitter:site" content="@csMACnz"/>
        <meta name="twitter:creator" content="@csMACnz"/>
    

        <link rel="apple-touch-icon-precomposed" href="/images/icon/apple-touch-icon-precomposed.png">
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/icon/apple-touch-icon-72x72-precomposed.png">
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/icon/apple-touch-icon-114x114-precomposed.png">
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/icon/apple-touch-icon-144x144-precomposed.png">
        <link rel="icon" type="image/png" href="/images/icon/icon.png" />
        <link rel='me' type='text/html' href='https://github.com/csMACnz'>

        <script>
            var d_id  = 'csmacnz';
        </script>

        <link rel="stylesheet" type="text/css" href="/css/style.css" />
        <link rel="stylesheet" type="text/css" href="/css/blogstyle.css" />

        <link rel="alternate stylesheet" title="dark-code" type="text/css" href="/css/solarized_dark.css" disabled>
        <link rel="stylesheet" title="light-code" type="text/css" href="/css/github-gist.css" disabled>

        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4517187877737982"
        crossorigin="anonymous"></script>

        
        
        <script type="application/ld+json">
        {
            "@context" : "https://schema.org",
            "@type" : "Article",
            "publisher": {
                "@type": "Organization",
                "name": "csMACnz&#x27;s Blog",
                "logo": "https:\/\/blog.csmac.nz\/images\/icon\/apple-touch-icon-144x144-precomposed.png"
            },
            "author": {
                "@type": "Person",
                "name": "Mark Clearwater",
                "image": {
                    "@type": "ImageObject",
                    "url": "//www.gravatar.com/avatar/c97410951ec3738a3fd4a2dfb17a5d9c?d=404&s=250",
                    "width": 440,
                    "height": 295
                },
                "url": "https:\/\/blog.csmac.nz",
                "sameAs": [
                    "https://csmac.nz"
                ]
            },
            "articleSection" : "post",
            "name" : "Git Housekeeping",
            "headline" : "Git Housekeeping",
            "url" : "https:\/\/blog.csmac.nz\/post\/git-housekeeping\/",
            "datePublished": "2014-12-29T09:36:45.000Z",
            "dateModified" : "2014-12-29T09:36:45.000Z",
            "keywords" : [ "git" ]
            "description" : "Those who are using Git but still new to the concept will no doubt have realised that files are treated differently to normal source control tools, and that they transition between different known states, according to git. I am going to try and explain these states, and give commands on how to transition between them.\nI needed these commands recently because I wanted to reset my changes and hadn\u0026rsquo;t really thought about how these states affect what it is that gets \u0026lsquo;reset\u0026rsquo;.",
            "mainEntityOfPage": {
                "@type": "WebPage",
                "@id": "https:\/\/blog.csmac.nz"
            }
            "inLanguage" : "en-US",
            "author" : "Mark Clearwater",
            "creator" : "Mark Clearwater",
            "accountablePerson" : "Mark Clearwater",
            "copyrightHolder" : "Mark Clearwater",
            "copyrightYear" : "2014",
            "wordCount" : "1308",
        }
        </script>
        
        
        
    </head>
    <body class="blog">
        <div class="page-area">

            <header class="header-area">
                <h1 class="header-area-title">csMACnz</h1>
            </header>
            <nav class="navigation-area header-bar-parent">
                <div class="header-bar header-bar-blog">
                    <ul class="menu">
                        <li class="menu-item"><a class="menu-item-content" href="https://csmac.nz">Home</a></li>
                        <li class="menu-item"><a class="menu-item-content" href="https://csmac.nz/baconvaders">Bacon Vaders</a></li>
                        <li class="menu-item"><a class="menu-item-content CurrentButton" href="https://blog.csmac.nz">Blog</a></li>
                        <li class="menu-item"><a class="menu-item-content" href="https://csmac.nz/metablog">Meta</a></li>
                    </ul>
                </div>
            </nav>

            <div id="content" class="content-area">

<!--Page Content Begins-->

<article>
    <div class="content-box" itemscope itemtype=" https://schema.org/Article"><span class="post-meta"><time datetime="2014-12-29"  itemprop="datePublished">29 Dec 14</time> in <a href="/categories/software-engineering">Software Engineering</a> on <a href="/tags/git">git</a></span>
<h1 class="post-title" itemprop="headline">Git Housekeeping</h1>
    
        <section class="post-content"  itemprop="articleBody">
            <p>Those who are using Git but still new to the concept will no doubt have realised that files are treated differently to normal source control tools, and that they transition between different known states, according to git.  I am going to try and explain these states, and give commands on how to transition between them.</p>
<p>I needed these commands recently because I wanted to reset my changes and hadn&rsquo;t really thought about how these states affect what it is that gets &lsquo;reset&rsquo;.</p>
<p>TL;DR: you can use these commands to perform different state transitions</p>
<ul>
<li><code>git add &lt;file&gt;</code> - add all changes to a file to stage</li>
<li><code>git rm --cached</code> - unstage a new file/stage a delete for an existing file, keep local filesystem copy</li>
<li><code>git reset &lt;file&gt;</code> - unstage, keep local changes</li>
<li><code>git checkout .</code> - reset unstaged changes, keep staged</li>
<li><code>git reset --hard</code> - reset all staged changes, reset all unstaged changes of tracked files(new unstaged files not removed)</li>
<li><code>git clean -f</code> (use <code>git clean -n</code> to dry run first) - removes all  untracked, unstaged changes</li>
<li><code>git clean -f -x</code> (use <code>git clean -n -x</code> to dry run first) - as above, also removes ignored files</li>
</ul>
<p>Skip to summary for coverage.</p>
<h4 id="the-details">The Details</h4>
<p>Given a file, git will see it as one of several states: Ignored, New-Unstaged, New-PartialStaged, New-Staged, Existing-Clean, Existing-UnstagedChanges, Existing-PartialStaged, and Existing-Staged.  First I will work through the states and some of the transitions, Then ill list the commands to achieve these transitions. (There is also a Deleted-Unstaged and Deleted-Staged, but ill leave those as an exercise for the reader.)</p>
<p>You can think or the file as having 3 versions, one commited, one on the file system, and one in a staging area. The Unstaged/PartialStaged/Staged variations just refect whether or not the file system version or staged version has changes from the commited version. Where a change from the commited version is in both the file system and the stage it is staged. When it is in the filesystem but not the stage it is unstaged. When all changes are staged, we are in the Staged state, when all changes are unstaged we are in the Unstaged State, and when it is a mix, we are in the PartialStaged State. Hopefully that helps when looking at the state transitions below.</p>
<p>A file is in the Ignored state when it is covered by an explicit or wildcard entry in your .gitignore, as long as it isn&rsquo;t already checked in to source control.  To transition into this state, Add a new file that is covered by ignore. If you have have staged changes you need to unstage them but keep the changes on disk. If you have a checked in file, you need to delete the file from git but keep the changes on disk.</p>
<p>When you add a new file, it will start in the New-Unstaged state, as long as it isn&rsquo;t being ignored by .gitignore. By staging the whole file, you get to the New-Staged, or you can stage some of the lines in the file to be in the New-PartialStaged state.</p>
<p>When you have an existing file, it starts in the Existing-Clean state.  making changes puts it into the Existing-UnstagedChanges, and staging these produces the Existing-PartialStaged and Existing-Staged, depending on if some or all changes are staged.</p>
<p>Hopefully by now you have learned how to move changes forward with <code>git add &lt;filename&gt;</code> and how to commit them with <code>git commit</code>, so next we need to get out head about these 3 commands to go the other way.</p>
<p>So with out uncommited changes, we want to do one of 3 things: reset both stage and filesystem files to the commited version(or remove completely if new) or unstage the changes but keep them on the filesystem (or un-add if new), or with untracked files(ignored) we want to delete them completely.</p>
<p>Lets start with the unstaging. We have a new file staged, and we want to unstage, but keep the changes on disk.  Why? well we either want to have it ignored(staged accidentally) or it isn&rsquo;t going in this commit.  Either way, we use <code>git reset &lt;file&gt;</code> or if it a new file we could also use <code>git rm --cached</code> instead. <code>--cached</code> means keep the filesystem changes. Note that if you have a new staged file that is now ignored, or a commited file that you want to become ignored, but deleted, then <code>git rm --cached</code> is the coomand for the job, as long as you already have your .gitignore updated as well.</p>
<p>Now if have unstaged changes and we want to reset them on disk but leave staging alone? We can use the command <code>git checkout .</code>.  This keeps all staged changes but resets any unstaged changes. The only issue with this command, is that if you have new files, but not staged, they stick around, while new staged files get removed.</p>
<p>And if we want to remove all staged and local changes of tracked(unignored, non new) files? <code>git reset --hard</code>. Note that any new unstaged files are kept here also. You could use <code>git add .</code> to stage new files, then <code>git reset --hard</code>, or you could try this next command after reset instead.</p>
<p>To remove unstaged files, you can use <code>git clean -f</code>.  Watch out though, this cannot be undone, so best to run <code>git clean -n</code> to test it first.  This will only remove new unstaged files(basically what the above two commands miss). As a side note, if the add is staged, this won&rsquo;t revert any unstaged changes to the file.</p>
<p>One final category is the ignored files. You know, all those artifacts, bin files, test results, .user files, package artifacts etc.  These don&rsquo;t go away in a hurry, whether its changing branches, or resetting changes, these files stick around, and some of them take up space over time.  These can be removed using <code>git clean -f -x</code>, again remembering to run <code>git clean -n -x</code> first so you don&rsquo;t lose something you didnt mean to.</p>
<p>One last one for good measure: if you want to keep all your changes for later, but still reset your files, use <code>git stash -u</code>. The <code>-u</code> here is shorthand for the <code>--include-untracked</code> command.  This quickly gets rid of all but ignored files in your repo, making it as clean as necessary, and even keeps all your changes stored away to bring them back with <code>git stash pop</code>.  Note though that the staged status of your files might not be the same afterwards. It will collapse together the stages and unstaged changes for each file, and put them all staged or all in unstaged. (This seems to be based on whether it is new or not, but more investigation needed).</p>
<h4 id="summary">Summary</h4>
<p>(TL;DR continued)</p>
<p>So lets summarize all these removals a little simpler based on the way I found it <a href="http://stackoverflow.com/questions/22620393/remove-local-git-changes">somewhere else online</a>:</p>
<ul>
<li>Type 1: Ignored File</li>
<li>Type 2: Unstaged New File</li>
<li>Type 3: Unstaged Changes (on new staged, or existing file)</li>
<li>Type 4: Staged New File(with or without unstaged changes)</li>
<li>Type 5: Staged Changes on Existing File</li>
</ul>
<p>Commands:</p>
<ul>
<li><code>git checkout .</code> - Undo Type 3 only</li>
<li><code>git reset --hard</code> - Undo Types 3, 4 and 5 only</li>
<li><code>git clean -f</code> - Undo Type 2 only</li>
<li><code>git clean -f -x</code> - Undo Types 1 and 2 only</li>
<li><code>git stash -u</code> - Undo Types 2,3,4,5, and creates a stash</li>
<li><code>git stash -all</code> - Undo All types, and creates a stash(stash includes ignored)</li>
</ul>
<p>So to nuke it all?</p>
<ul>
<li><code>git reset --hard</code> then <code>git clean -f -x</code> - All, no recovery</li>
<li><code>git reset --hard</code> then <code>git clean -f</code> - All but ignored, no recovery</li>
<li><code>git stash -all</code> - All gone, with recovery</li>
<li><code>git stash -u</code> - All but ignored with recovery</li>
</ul>
<p>Thanks to <a href="http://stackoverflow.com/users/430885/frederik-sch%c3%b8ning">Frederik Schøning</a> and others for their <a href="http://stackoverflow.com/questions/22620393/remove-local-git-changes">stackoverflow answer</a> which helped me get the commands straight to solve my problem.</p>
</section>
        
        <section class="share">
            Share: 
            <a class="icon-twitter" href="https://twitter.com/share?text=Git%20Housekeeping&url=https%3a%2f%2fblog.csmac.nz%2fpost%2fgit-housekeeping%2f"
                onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                <span>Twitter</span>
            </a>
            |
            <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.csmac.nz%2fpost%2fgit-housekeeping%2f"
                onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                <span>Facebook</span>
            </a>
        </section>
    </div>
    <div class="content-box">
        
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            var disqus_shortname = d_id; 
            var disqus_title = 'Git Housekeeping';
            
             
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    
    </div>
</article>

<!--Page Content Ends-->

            </div><aside class="sidebar-area">

<!--Sidebar Content Begins-->

                <div class="header-bar-parent sidebar-item">
                    <div class="header-bar header-bar-mastodon">Mastodon</div>
                    
                    
                    <iframe allowfullscreen sandbox="allow-top-navigation allow-scripts" width="280" height="400" src="https://maplefeed.bihlink.com/apiv2/feed?userurl=https%3A%2F%2Fmastodon.nz%2F%2Fusers%2Fcsmacnz&theme=modern-light&size=80&header=true&replies=false&boosts=false"></iframe>
                    
                </div>


                <div class="header-bar-parent sidebar-item">
                    <div class="header-bar header-bar-rss">Subscribe</div>
                    
                    <a href="/rssfeeds/" title="csMACnz's Blog">RSS Feeds</a>
                    <a href="https://feedly.com/i/subscription/feed%2Fhttps%3A%2F%2Ffeeds.feedburner.com%2FcsmacnzBlog" target="_blank" title="csMACnz&amp;#039;s Blog"><img src="https://s3.feedly.com/feedburner/feedly.png" alt="" style="border:0"/></a>
                    <br />
                    <a href="https://www.patreon.com/csMACnz" target="_blank"><img src="/images/patreon.png" /></a>
                    
                    
                </div>


                <div class="header-bar-parent sidebar-item">
                    <div class="header-bar header-bar-xbox">Gamercard</div>
                    

                    <div>
                        <a href="https://www.exophase.com/xbox/user/csMACnz/"><img width="288px" src="https://card.exophase.com/1/1476805.png"></a>
                        <a href="http://steamcommunity.com/id/csMACnz/" target="_blank"><img src="https://www.steamsignature.com/status/english/76561197994712512.png" alt="" title="csMACnz's Steam Profile" /></a>
                    </div>
                    
                </div>


                <div class="header-bar-parent sidebar-item">
                    <div class="header-bar header-bar-ads">Advertisement</div>
                    
                    <div>
                        
                        <ins class="adsbygoogle"
                            style="display:block"
                            data-ad-client="ca-pub-4517187877737982"
                            data-ad-slot="3618449993"
                            data-ad-format="auto"
                            data-full-width-responsive="true"></ins>
                        <script>
                            (adsbygoogle = window.adsbygoogle || []).push({});
                        </script>
                    </div>
                    
                </div>

<!--Sidebar Content Ends-->

            </aside>

            <footer class="footer-area">

            <p>
                Designed and Maintained by Mark Clearwater; Last updated August 2021.
                <!-- This used to be something useful, now it is just a hack I left it to make layout easier but also as a fun reminder for me of what it used to be -->
                <br /><a class="footer-link" >¯\_(ツ)_/¯</a>
            </p>

            </footer>
        </div>

<!--body scripts Begins-->

        
        <script src="/js/highlight.pack.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>

        <script src="/js/codetoggle.js"></script> 

        
        <script src="/js/htmx.min.js"></script>

        
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-08VK9VD3ET"></script>
        <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-08VK9VD3ET');
        </script>

        <script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>

<!--body scripts Ends-->


<!-------------------------------->
<!--                            -->
<!--  _(\    |@@|               -->
<!-- (__/\__ \--/ __            -->
<!--    \___|----|  |   __      -->
<!--        \ }{ /\ )_ / _\     -->
<!--        /\__/\ \__O (__     -->
<!--       (--/\--)    \__/     -->
<!--       _)(  )(_             -->
<!--      `---''---`            -->
<!--                            -->
<!-- https://github.com/csMACnz -->
<!-------------------------------->

    </body>
</html>
